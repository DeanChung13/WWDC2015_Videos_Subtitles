UIKitDynamics和視覺效果的最新進展
歡迎參加WWDC和"UIKitDynamics
和視覺效果的最新進展"的最後一天的活動
我是麥克·特納
我將和我的同事大衛·杜漢一起爲大家進行介紹
我們兩個都是Apple在這裏的UIKit開發組成員
所以 在我們開始今天的介紹之前
我要向各位推薦幾場非常好的講座
我只是簡要介紹一下
在過去幾年裏我們進行過幾場非常好的
圍繞UIKitDynamics動態和視覺效果的講座
所以我們今天就從簡要概述
動態動畫模擬系統開始
我們會進行 基本示範 然後
我們直接切入今年UIKit Dynamics的新進展
然後大衛會過來與我們討論視覺效果
以及你怎樣在你的應用程序中運用那些效果
最後 我們會稍稍涉及
一些應用UIKitDynamics的最佳操作範例
和你的應用程序裏的自動佈局
所以我們談論UIKit Dynamics時
我們說的是一個二維的基於物理啓發的
動畫交互系統
它有一個非常易於組合的說明式的API
可以顯示你的應用程序裏的高水平動畫
我們所說的並非核心動畫或用戶界面視圖UIView動畫的
替代程序 而是另一個
能夠幫助你在你的應用程序創建定製的效果的工具
讓我們來看一個示例
這裏有一個基礎的滑動視圖
用戶可以平移視圖但是如果你放開它
它就像受到重力影響一樣落下來
現在 它並不會直接從電話底部消失
相反 它先在底部邊緣停止
再稍稍向上反彈 然後停在那裏
現在 讓我們看一看如何創建這個基本示例
首先你需要先選定一個很好的參考視圖
在這裏 我們選擇視圖控制器的視圖
其中包含我們的滑動視圖
選擇引用視圖後 我們要
創建一個動態動畫並將它與引用視圖關聯
這段動態動畫爲我們的動畫
保持整體背景 它的主要作用是跟蹤
行爲和動態項目
對於滑動的例子我們有一個滑動行爲
UI動態行爲的偉大之處之一
是更高層次的行爲可以由相對原始
的行爲組成
所以我們的滑動行爲只不過是
重力 碰撞 附件的組合作品
稍後 我們將向大家展示
我們如何使用UIAttachmenBehavior和增加的新組件
讓滑動比過去更簡單
所以一旦我們有滑動的行爲
我們就需要一個動態的項目
這裏我們選擇了滑動視圖
它只是一個自動符合動態項協議的UIView
所以這是一個很好的選擇
然後我們選擇動態項 將它與
滑動行爲關聯 將滑動行爲
和animator組件關聯
現在animator組件將自動確定
系統靜止或運動的時間這是要創建這個
偉大的效果你所需要的全部條件
現在我們已經看過了一個基本示範
這就是今年UIKitdynamics的新變化
我們支持
UIDynamicItem的非矩形碰撞結合
我們有一個全新的UIDynamicItemGroup
允許多個項目就像引擎中的一個部件
一樣運轉 我們還有一個全新的
模擬向量力場的行爲
我們對UIDynamicItemBehavior以及UISnapBehavior進行了
一些基礎性的優化處理
我們會看到UIAttachmentBehavior新增了一些很好的功能
我們最後還將介紹一些新的方法 你們可以
用這些方法調試動畫
所以 在iOS 9裏 我們增加了UIDynamicItem
碰撞邊界類型可以提供三個新方法
爲動態項指定碰撞邊界
在默認情況下你的碰撞邊界是矩形
與邊界數據訪問器返回的動態項目協議
匹配
現在你可以指定一個橢圓類型 它來自
協議中的邊界寬度和高度
最後 你可以指定一個UI BezierPath用於
動態項的碰撞邊界
現在 爲了實現這一點 我們採用了現有的動態項目協議
並已經延長兩個可選屬性
如果你不應用這兩個
可選屬性中的任何一個你將像過去一樣
遭遇到矩形碰撞邊界
如果你執行第一個碰撞邊界類型
並返回橢圓就將得到一個
基於邊界的寬度和高度的橢圓
如果你執行第一碰撞邊界類型並返回一個路徑
我們會將你調回執行第二個類型
此時您將需要提供一個UI BezierPath
用於碰撞邊界
所以如果我們要模擬項目之間的
邊界不同的碰撞爲保險起見
我們要多做幾次情況可能看起來像這樣
這次碰撞看起來比過去所有項目
都有矩形碰撞邊界
的情況下更現實
現在 爲碰撞邊界設定路徑時有
一些限制特別是
BezierPath要求必須是凸起的逆時針模繞
並且非自相交
這些都是非常基本的如果你仔細想想
也沒有什麼太花哨的東西
我們還需要記住當項目在屏幕上時

動態項的中心點
這就是碰撞邊界的更新內容讓我們來談談動態項目組
這是進行多個項目
並使他們作爲一項在底層引擎運行的基本方式
這個項目組保留每個項目
的位置和各自的碰撞邊界
所以因爲這個原因 你應該把這些項目與一組
而不是單獨的行爲關聯起來
與其將它們與組進行關聯
將組與任何行爲進行關聯
你更傾向於與animator組件關聯
總的來說 這會把那些行爲
強加在項目上
而一個組卻不能被添加到其他組中
這是一個一級抽象
所以要創建凹形或其他
複雜的不能用動態項目邊界路徑創建的幾何結構
而且總體來說行爲能夠有此影響
要做到這些 這是一個很好的方式
那麼 讓我們暫時回到滑動示例
我們希望實現更豐富的滑動效果而不僅僅是簡單的平移和回落
比如我們讓屏幕在用戶觸碰時輕微跳動
顯示可以平移
要做到這些 我們只需要
給滑動視圖添加一個簡短的力
這就是那力
所以我們可以在項目的中心把這個力
作爲一個向量進行模擬在項目的中心向量的長度對應的這個力
的長度 向量指向上方以說明
這個力的方向 在本例中我們要
向上移動視圖 所以這個力指向上方
爲了應用這個力我們就要使用UIPushBehavior
你還記得的話UIPushBehavior
有兩種截然不同的模式
它有一個連續模式代表了一種跨越時間的力
另一個模式是瞬時模式
代表一個簡短的瞬間的力
或者稱爲一個脈衝
對於這種交互 我們只需要一個簡短的力 它會反彈回來
然後靜止所以我們要
使用瞬時模式
我們這樣做就得到一個簡短的力
但是什麼使視圖回來？
我們給它一個力使它向上移動
但它卻回落下來
這是我們的複合行爲是由重力
碰撞和附件構成的
所以是重力使其移動下來
然後它再以碰撞行爲反彈
但讓我們來多瞭解一些重力
以及它如何影響我們的項目
我們從開始施加脈衝力的瞬間
來看滑動視圖
的垂直運動
你會發現這個力是作用於一個點
然後項目向上移動再以弧形回落
這是因爲在我們的圖表中重力
無時無地不在影響它
如果我們把這些力與重力相加情況看起來
可能像這樣這個力是應用於
所有位置和時間的
所以不容易模擬
也許我們可以試着使用UI來推動行爲
但是這會非常複雜的 而且很快
所以我們需要更多地把重力當作一個場加以思考
場非常簡單它只是一個函數
在指定的定義域內給每一個點分配一個向量
在這個例子中我們的定義域
是整個參考視圖
所以我們希望重力在整個參考視圖裏
影響滑動視圖
特別簡單
所以我們採用了這個場的想法 並加以擴展
在iOS 9中 我們引入了UIFieldBehavior
UIFieldBehavior
是一個可以添加到參考視圖的
一個區域中的方法場在參考視圖之內的
每一個點都被賦值
任何產生的力量
自動被動態animator組件應用
到已經與場關聯的項目中
如果你在想我們現有的UIGravityBehavior
被作爲一個場實施
重要的是還要記住
這是簡化的物理
爲適應這個展示進行了調整
我不會用它來建造
星際空間站或類似的東西
讓我們看一看內置場的類型
這裏種類非常豐富
有線性和放射重力場、
速度和阻力場、
渦流場以及依據胡克定律的彈簧場
還有電場
和磁場
如果還不能滿足你的需要
我們也提供自定義力鑑別器
此話題我們稍後再敘
我們先從線性重力開始
我們首先會注意到它處於一個區域內
就像我們之前講的那樣
而且它有場強我們使用默認值1
它也是一個方向作用力
我們使用熟悉的重力方向
舉例
但它實際可以指向任何方向
讓我們看一看放射重力和線性重力的區別
除存在於一個區域並且有場強外
這兒有一個位置作爲一個質點用放射重力可以模擬
如你所知
兩個物體之間重力
與距離的平方成反比
這兒是物體之間距離的平方
這個指數是場的衰減值
距離場的位置越遠
場產生的作用力就會減小
這兒也有最小半徑
這一方法可以確定一個物體距離位置點多遠
纔可以感受到場的作用力
我們還有一個噪聲場
在這方面我們注意到的第一個問題是
它隨着時間變化 你可以使用動畫速度
來調節 默認值爲1

你也可以使用平滑參數
調節噪聲程度
讓我們看一看自定義場鑑別器
使用起來非常簡單
先使用場鑑別框創建一個UIFieldBehavior並初始化
然後就可以調用該框使用幾個場取樣包含相關取樣位置
速度、質量、負載以及時間
下來你就可以使用它來
判斷任何作用力
這裏我們需要做的是選擇位置 x位置
然後繪成正弦波
一個很酷的結果
這是一些基本的內置場
和UIFieldBehavior的概述
我想邀請大衛
舉例展示
大家好 我們將
帶你體驗一個
我相信你們以前都見過的一個例子
我確信你們某個時候都使用過FaceTime
所以這兒的例子是
創建一個相似的UI
管理屏幕中的臉孔
正如你所看到的 在我滑過這兒時
方框移動順暢
如果我從角上拉開一點 它會彈回
如果我再拉 它會有
漂亮的漸入曲線
如果向下拋 它就會
沿着四周邊沿彈開
你會注意到在我向下拋時 它並沒有
直接到它應到的地方
實際上有一個物理過程 它會彈離
屏幕邊沿並回到原位
現在 我可以產生一個調試視圖
看看這些作用力場的樣子
這樣 你可以看到
這兒你可以看到我們有四個彈簧場在運行
我們可以很容易地解釋所發生的事情
如果我們把這個放在邊沿
我們知道它會彈回
如果我們跨越兩者 那麼根據
我們跨越的位置它會選擇一邊或另一邊
穿過中間
它會選擇最近的一邊
讓我們看看怎樣設置
怎樣在實際中獨立完成
第一就是建立StickyCorners 行爲
根據麥克的說法它是由其它行爲構成的
這種複雜的行爲可以做完成我們的一切想法
在這種情況下 它會產生衝突行爲
因爲我們不想讓你的面孔
急速離開屏幕邊沿
我們有一個動態的項目行爲
可以影響面孔的屬性
這樣 我們可以減小密度
使引擎具光感
但需要增加其對運動的耐受性 這樣
它位於某一地點時就不會繞着那個位置
不斷旋轉
最後我們禁用旋轉
因爲這樣做沒有意義
你並不想讓自己的面孔
在屏幕中旋轉
最後我們有個這些場行爲
四個彈簧場標出了四個角
我們也把它們增添到行爲中
現在無論什麼時候人們增添這種StickyCorners 行爲
都會免費得到這種行爲
接下來 看看視圖控制器
我們去看一看建立視圖層級需要的一切
但還需增添一個拖動手勢識別器
這樣 用戶可以選擇面孔
並在屏幕移動
長按手勢識別器則會使我們
開關調試界面
我們創建動態仿真器
並增添StickyCorners行爲
手勢識別器是如何工作的？
像往常一樣手勢識別在狀態之間進行
它從begin開始開始後 我們做一些記賬
這樣我們可以跟蹤進展但我們也需要禁用sticky behavior
我馬上會演示我們是怎樣做的
同樣 當它變化時 我們向四周移動
當它取消或結束時
這是比較特殊的地方
當用戶停止互動時
我們檢查拖動手勢識別器的速度
並使用它把速度增添到
動態體系中
這樣 當用戶離開視圖時
它會繼續隨用戶的動作而移動
而不是突然停止並
由場完全接管
禁用和啓用
都是由於相同的理由
在用戶在活動中時
我們不想讓這些場處於活躍狀態
否則它會從我們的
指尖下溜走
所以我們再回過來看一下
看看是怎樣啓用的
的確非常簡單
在啓用時 我們把所有項目增添到
這些行爲中 當禁用時我們再取出來
創建這樣一個系統非常簡單
你可以在自己的程序中
建立類似FaceTime的行爲
所以 爲了告訴你們如何將調試UI
置入你自己的應用程序
我要讓麥克上來幫我一下
謝謝 大衛
真的非常好 在大衛的例子中
爲了能夠一探究竟
將這些場線可視化了
在他打開它之前 這顯得很神祕
所以 在你的動畫設計參照視圖中
這些線基本是用來顯示這個場的疊加圖
特別是 這個疊加圖能夠幫助你將
各個場、碰撞邊界、附件 以及
某特定組件是運動還是靜止可視化
現在 你可能奇怪 這不會是API
但是它在LLDB中可以存取而我們也正在把它
作爲UIDynamicAnimator上的一個有效的調試功能加以推廣
而且它用起來確實很簡單
暫停調試程序
爲你的動態動畫設計找一個參照
激活調試功能 設定在true
然後你將得到這個漂亮的疊加圖它能夠給出所有的物理屬性
現在 除了激活和滅活調試功能之外
我們還要給出調試間隔
這樣你就可以調整
調試疊加圖更新的時間間隔了
所以 默認情況下
每個動畫幀都會更新但是如果你有許多
複雜的物理屬性 那麼可能
例如 最好把間隔改爲5
即只是每到第5幀才更新
同時 我們還允許你調節
動態動畫設計的動畫速度
此時放慢速度可能有利於
觀察真實的過程
之後 重要的是要記住 在使用時
如果放慢速度
可能會影響模擬效果
所以一定要確保以1x修正
那麼接下來讓我們談談UIDynamicItemBehavior
現在 如果你再次調用
可改變你的視圖或動態道具的物理屬性
這適用於一個或多個動態道具
在大衛的例子中
他爲FaceTime方塊選用了低密度
及高阻力
使其牢牢固定於場的角點
就現有特性 在此多舉幾個例子
我們有彈性、摩擦力我們看到了密度和阻力
我們有角阻力 這些都可調節
你的道具在動畫引擎中的狀態
在iOS 9中我們增加了兩個性能
這影響你的道具
在我們新型電場和磁場中的參與度；
我們還增加了anchored屬性
這個略有不同
但是它能讓你的道具
參與動態系統 參與碰撞
不過沒有自己的速度
所以更像是碰撞邊界
那麼接下來
我要談談UIAttachmentBehavior
這讓你能夠約束兩個動態道具
從而讓它們彼此保持特定的距離
你可以利用阻尼和頻率進行配置
讓它更像一個彈簧 而不是連桿
這是一個很好的附件
你知道 它很有用 但是你也確實
只有一個辦法來約束兩個道具
所以 在iOS9中 我們增加了更多附件類型
第一個是限制附件
這與剛講到的距離附件很像
但不是我們能想到的
像一個連桿或彈簧一樣受約束
而是更像兩個道具間的一根繩子
唯一約束是彼此間的最大距離
你對它的配置類似於距離附件
規定從每個道具中心偏移出的兩個點
很簡單
接下來是一個固定的附件
這與限制附件或距離附件略有不同
在你創建這種類型的附件時首先規定一個錨點
就每個道具中心而言 這個錨點
位於你的參照視圖座標空間
而這類附件無論如何不會在兩個道具之間運動
相對於允許道具端部旋轉的連桿它更像是兩道具間的焊接杆
我們還增加了一種鎖銷附件
這個類似於固定附件
即你可以先在兩個道具間規定一個錨點
但是這種類型附件允許兩個道具圍繞這個錨點在彼此之間旋轉
這樣你可以規定一個旋轉範圍默認狀態下無界
但是我們可以給出界限如縮小範圍
最後我們增加了一個滑動附件
這個滑動附件有點複雜
我們等一下看一個例子
和固定附件及鎖銷附件一樣
我們先在參照視圖座標空間
規定附件錨點
但是與這兩個類型不同 我們還要
規定一個平移軸
這裏 兩個道具之間
相對運動都將沿着這個平移軸
這個類型的附件可阻止兩個道具所有的相對旋轉
所以 兩個道具不能再旋轉
只能沿着這個平移軸運動
但像鎖銷附件一樣
你可以限制平移範圍
這樣 如果你規定了一個平移範圍
就要把附件錨點
放在確定爲範圍零點的
錨點位置
所以如果我們以這種類型附件建立該系統
我們就能夠得到
兩個道具間直線運動就是這樣
所以 相當複雜
讓我們看一個基本示例
爲此 我想
再次回到滑動的例子
是說過在過去 如果我們
使其可滑動 將必須
在底部每一側以及頂部離開屏面的某處
增加一個碰撞
以限制滑動視圖
沿着垂直軸的運動
那麼有了UI附件 我們再無需如此
我們用滑動附件就能做到
所以 我們把系統控制在一次碰撞
使其表現更佳
而代碼確實更易讀
所以 如果我們在此激活調試視圖
你就能夠看到
通過沿垂直軸的直線描畫的滑動附件
它隨我們滑動視圖而縮放
但是同時還有一個附件
即距離附件 我們用它
通過一個平移手勢識別器
附於一個操控錨點
所以 不同於大衛的演示
這個完全在動態系統內
我們不做任何禁用或啓動
我們只是保持動態
好極了
所以最後
讓我在UISnapBehavior上爲你做一個快速更新
如果再次你調用UISnapBehavior 它能做的更多
它可以被用來將一個視圖從一個位置移動到另一個位置
並有一種快動效果
通過SnapBehavior你可以定製快拍阻尼
這樣確實可以調節
感覺上的快慢
在iOS 9中 我們也新增了
初始化後定製捕捉點的功能
同樣相當不錯
這裏讓我看一個簡單的例子
所以 如果我們試着平移視圖那麼打開調試功能
就會回到如最初捕捉點的屏面
如果我們輕敲另一個位置就會對齊到新點
即在現有動態特性基礎上
調節捕捉點
相當不錯
你還會注意到 有了調試疊加圖
這些實際上都是自行合成
這裏4個附件 配置如彈簧
把視圖對齊到新位置
確實非常棒
所以 這就是
UIKit Dynamics和iOS 9中新增的內容
我要把它交給大衛
讓他談談視覺效果
各位早上好
那麼我們接下來要談談利用視覺效果
爲你的應用增加新模式
那麼我們用一個簡單的圖像瀏覽器應用示例來形象地加以說明
這裏 我們要向用戶額外介紹一下
他們目前正在看的圖片
看右邊 圖像上面
有點疊加部分
是我們圖像的文件名
所以我們要看看如何創建
那麼 第一步是你要
形成一種模糊效果
我們有3種模式 超亮、
明亮及陰暗模式
你通過這些模式形成一種模糊效果
就是那樣
最後 你用模糊模式形成
你的視覺效果圖
之後只要添加你需要的佈局
你就能夠得到屏面上你看到的模糊效果
下一步 我們要添加振動效果
振動的作用是 使某物在模糊模式
突然彈出
所以接下來 我們要
通過模糊效果形成振動效果
如上面提到的 確實要要模糊疊加
所以我們從模糊效果開始
形成振動效果
我們形成振動效果
正如我們之前形成模糊效果
此時 我們要
在模糊視圖中添加內容視圖
現在 不必直接加到模糊視圖上
而應是在視覺效果圖後
有一個模糊視圖
最後 我們
在振動視圖的內容視圖上加標籤
視覺效果圖的內容視圖上
加這些東西是要確保
你給出的所有內容
效果無誤
所以 當你完成這些之後
模糊視圖頂部就有了可愛的標籤
正如你在屏面上看到的那樣
那麼iOS 9有什麼新東西呢
首先我們使得
你的視圖邊界有清新的動畫效果
在模糊視圖中你可以向用戶顯示更多信息
而無需做任何複雜的工作
但是 除此之外 我們讓你能夠
讓模糊視圖生動有趣
那麼現在 比如如果你的app有夜間加載模式
你在你的應用中可以日夜都採用非常清新的動畫
並推動用戶
接下來我們要簡要介紹
我們如何切實地把這些效果搬上屏面
它做什麼用 以及你爲什麼需要知道
這很重要 因爲所有這些都會影響
性能和修正
這裏 小嬰兒Sophia帶我們看
如何向她的小UI加一點疊加內容
那麼先想想
我們要捕捉哪裏
我們只要看到一個視覺效果
就知道我們需要捕捉的內容
我們將它從屏面移開
這樣我們就把這個小東西拷貝了出來
現在它從屏面上下來了 我們可以用它了
但是我們爲什麼將它從屏面取下
好 有一個原因是我們需要確保
我們獲得正確的效果而且在這種情況下
我們捕獲了我們需要用於模糊的所有一切內容
爲了達到那種模糊效果
而且我們經常離屏做這些事情
這樣我們就不會弄亂屏幕上已經做好的內容
當我們正在離屏做出這樣效果的時候
於是我們將這個模糊效果應用在它這裏
最後 我們把它複製回原來的位置
即效果視圖對它所要求的位置
而所有這些給了我們一個定義
它定義的是你以前可能已經聽說過的一個東西 即所謂“離屏通過”
就是無論什麼時候我們獲得一個內容我們將它複製到屏幕以外
做好後 再把它返回到屏幕上
那麼有什麼其他方法我們可以得到“離屏通過”？
好正如你所看到的
我們已經有了Alpha
而且你可以看到你做那種效果的方法
因爲如何你有一個複雜的視圖層次
其中需要Alpha
那麼我們就不能只把Alpha適用於單個視圖
因爲你將得不到正確的效果
相反我們需要獲得整個複雜的視圖層次
通過離屏獲得它渲染它然後將Alpha應用到整個事情
遮罩在它的背後有一個非常相似的推理
在那個推理中我們需要將所有像素用於遮罩
正如我們剛纔提到的模糊和虛化也是通過離屏完成的
但快照不是 爲什麼是這樣呢？
你可能會問自己
嗯 首先 什麼是快照？
我們已經有了這兩種UIView方法一種是在屏幕更新後
獲得屏幕快照然後以矩形繪製出視圖層次
一種是UIScreen方法即在屏幕更新後獲得快照視圖
而且所有這些都會把快照上的內容返回給你
那麼 快照基本上是做同樣的事情
即如“離屏通過”做的一樣但讓你能夠控制最後一個步驟
從而將內容複製回屏幕
我們獲得了所有你要求我們進行快照的內容
對它進行離屏渲染然後返給你一個視圖
或者代表那個圖像的像素內容
但是 再一次想問的是 這與確保
你的效果必須正確無誤有關嗎？
好
不幸的是如果你得到的視覺效果陷入了
這一點正如你可以看到的
索̨菲亞已經失去了她的模糊度
而這就是你在視覺效果完成後將在屏幕上所看到的內容
視學效果是你離屏時所得到的
它是你事先沒有想到會遇到的
好重新回到這裏
我敢肯定你們今年都已經參加過多任務會議
如果沒有你可以下課後看看它們的視頻
但在所有事情當中即你需要啓動一個非常好的App
以參與多任務處理
其中關鍵的一點是屏幕上要有好的表現
因爲現在你的App的表現也會影響到其他正在運行的App
所以 既然我們在這個特殊的例子中沒有出現任何滾動
那麼我們就可以決定讓我們不要一直保持對模糊進行渲染
讓我們只是爲它照一個快照好了
因此我們決定爲那個特殊的視覺效果圖照一個快照
但隨後發生的事情是捕捉區域是離屏完成的
而且由於你只快照了視覺效果圖
因此在捕捉區域上什麼也沒有
這樣一來捕捉區域什麼也沒帶給你而且模糊功能也沒有可以模糊的
你得到的是你之前看到的被破壞的效果
所以 既然我們已經看到
你是如何破壞了你的效果那我們能做些什麼來解決這個問題呢？
好了 第一件事就是
我們有了這個簡便的方法即用於視覺效果圖上的方法
所謂的“這個效果怎麼了？”
就像使用動態調試標誌
在SDK中不是這樣的 但你可以
從調試器中調用它 就像這個一樣
你會得到一個字符串看起來和這個有點像
在這種情況下我們發現在層次結構上的某個地方
有一個遮罩視圖 它造成的視覺效果
需要在屏幕外來完成因此無法捕獲儘可能多的
它所需要的內容以便進行正確的渲染
那麼如何解決這一問題呢？
第一種方式如果你使用的是Alpha
或者遮罩這項工作實際上是重新排列你的視圖層次
我們在這裏所擁有的只是一些容器或許窗口
和一個容器視圖
包含一個模糊和更多的內容
那麼在這種情況下 模糊實際上並不需要
加入我們所擁有的Alpha或者遮罩
所以我們只是重新安排以便將模糊作爲第一個子視圖
將容器作爲第二個子視圖這樣一來容器
和它裏面的一切都將渲染於模糊的頂部
而且我們可以將Alpha或遮罩適用於這個容器視圖
卻不會搞亂我們的模糊
我們能爲遮罩做的第二件事是
不是將容器視圖進行遮罩
而且我們可以將那個遮罩
向下移動到我們實際上需要遮罩的內容上
現在 正如我們前面所提到的
遮罩往往會採取“離屏通過”
所以你在做這樣的轉換時
應該非常地小心謹慎
最後通過快照 正如我們前面提到的
快照只會捕獲你告訴它需要做的
所以在這種情況下
我們要求快照的內容視圖中 有一定的透明度
這樣我們就可以看到它背後的東西
但是如果我們只快照了那個視圖那麼我們在模糊中將得不到透明度
它會看起來有點滑稽
因此 當我們一直向上移動快照時
窗口通常是最容易做的事情
但有時你可能需要一直將它向上移動到屏幕上
所以如果你要快照模糊 你應該確保
你在快照時儘量遠離模糊內容
以確保你得到你所需要的一切
然後有了這些讓我們轉到有關動態和自動佈局的
一些最佳做法
所以你可能要做的第一件事是
你可能需要使相當複雜的
視圖層次在動態系統內發生作用
而你想要的是使外部視圖加入
動態系統而不是內部視圖
它們的佈局將正如
你用其他內容所做的佈局的一樣
所以 你可以將UIKitDynamics用於外部視圖
這隻需要將“自動調整遮罩大小轉變爲約束”
變爲“真”即可
是的在WWDC中唯一的幻燈片裏講的是“真”
然後你就可以使用“自動佈局”
將所有其他的東西正好放置於視圖裏面
就像你經常做的一樣或者使用新的句法
即如幻燈片上所顯示的一樣
你可以做的另一件事是你在動態系統裏經常會有
各種項目但你可能對它們作了標記
它們不應該參與 但需要跟隨
所以在這裏Lola有她的小標籤
上面寫了文件名是什麼而我們只有這個錨點
它代表了我們的自動佈局約束
然後當動態圖起作用並準備四處移動Lola時
標籤也跟着一起動 但標籤最終不會
與動態圖有互動
最後你可以使用動態圖來操作
其方法是創建一個自定義動態項目
正如麥克前面所提到的
你只需要將NSObject劃入子類
或者其他適當的對象類
只要符合UI動態項目協議
並提供了所需要的方法
對於Bounds 有的尺寸...
它不能是“00”或者動態系統準備
拋出一個異常...然後你執行居中和轉換
並按順序使用這些數值
以構建自動佈局約束
或者改變你係統外部的一些東西
然後關閉 我們將給你一個演示你也可以做到這樣
所以我們這裏得到的是什麼？
對 同剛纔一樣是一個簡單的應用程序
它剛剛顯示了一張照片
但是我們希望能夠以某種風格向用戶展示
照片里人的面部
所以當我們點擊
我們的動態項目時系統就會伸出
並且在那個模糊中出現動畫
如果你再次點擊 當然 它的移動
會出現更好一點的效果
但是如果你繼續點擊 你就可以看到
它在動態系統上的反應非常流暢
並且不具有非常固定的、僵硬的路徑
所以它對於用戶正在做的動作做出恰好的反應
那麼 我們是如何做到這個的？
所以我們做的第一件事是
我們使這個面部執行佈局嚮導
這正好是UI佈局嚮導的一個子類
而在它的內部是一點點的動態
我們將這個面部佈局嚮導執行動態項目也就是再一次
將NSObject劃入子類並符合UI動態項目
並且它將管理一個約束
然後通過將該約束的常數設置爲中心點的x值
或y值 不管該約束是如何變化的
在這裏 當你設置佈局嚮導時
它就會得到一箇中心位置
並且創建了四個額外的動態項目
在系統中表示上、左、下
和右
我們將它分配到約束而約束剛好從動態項目的
左上角發生作用
以及從動態項目參考視圖
而我們使用滑塊附件以限制
這四個動態項目相對於該位置
可以去的範圍大小
這可保證它避免飛到系統外
或者摺疊到一個過小的位置
現在 在視圖控制器裏
我們得到這種行爲的方式是我們有一個
沿着面部佈局嚮導的重力行爲
然後在彼此的頂部將它們居中
因此當重力發生變化時
佈局嚮導將會適當地移動
我們從故事板中得到模糊效果
這樣我們不必不斷地擺弄它
如果我們決定要改變我們使用的風格
我們使用約束將那個模糊視圖
附加到面部佈局嚮導上
因此 當此嚮導改變了尺寸
模糊視圖也會隨之改變
現在爲了使它看起來像是模糊視圖切割了
除面部以外的所有東西對此我們確實有一個小竅門
我們做了一個原始圖像的頂替圖像
剛好切出我們需要的圖像給它們一個遮罩
並創造更多的UI圖像視圖放置於
已經在那裏的視圖的頂部
所以它看起來好像模糊剛好遮擋着面部
但實際發生的事情是你所看到的視圖
被放置在頂部而面部從它們上面切除
最後 我們對這個視圖點擊我們設置的手勢識別器
得到的正好是使我們的動態系統發生改變的東西
當我們要暴露面部時
我們只需要改變重力就可以
所以重力通常是造成一切被拉向中心的原因
但當我們打開它時它像一個反重力一樣想推開一切東西
然後我們利用以下這個事實
即我們通常在這個過程中始終佈局子視圖
以實際地觸發模糊動畫進入或退出
而所有這些都是爲了建設這個非常好的效果
我們所依靠的是自動佈局和動態都可以很容易地提供給你
至此我們將回到幻燈片來做一個結束
總而言之
我們希望你能夠使用這些技術以真正地改善用戶體驗
所以 當你添加一個模糊你添加了它
這樣你就可以通過其他的信息來彌補你的內容
當你使用動態
你可以有一個反應剛剛好的用戶界面
並且正如用戶對他們輸入內容的期待一樣
但是你也需要考慮到表現當你在做這些事情時
因爲如果你有很多在屏幕上的動態項目
它們能夠使用戶界面真正陷入困境
而且你不會得到你所期待的的物理現象
所以請謹慎地使用
而且對於視覺效果如果你有很多這樣的效果
你最終將有很多“離屏通過”
並且這也會招致相當高的成本
這些都是與課程相關的內容這是我們今天爲你準備的
不幸的是其中大部分都在之前發生過
僅有一個沒有發生而且是與我們一起出現的
即所謂“通過GCD建立響應和效率的App”
而且我們在此之後將在實驗室裏回答你的所有問題
並幫助你避免出現你這一年遇到的大部分情況
我們已經有了各種文檔
以及你以前在演示中看到的用於StickyCorners樣本的組裝代碼
將會提供給你
而且 當然 寇特·羅斯特將通過電子郵件回答大家的提問
我很高興你們在週五堅持與我們一起學習
我希望你擁有一個偉大的WWDC並祝大家一路平安
CloudKit中的新特性
下午好 歡迎參加第704環節的講座“CloudKit中的新特性”
我叫Olivier
是iCloud客戶端團隊的技術經理
一年前我們介紹了CloudKits它對你們開發者來說
是一種駕馭iCloud的全新架構
我們在iOS 8上構建了很多
CloudKits的新特性
最明顯是把iCloud Drive和iCloud照片庫
全部加入了CloudKit之中而Mail Drop HomeKit
Safari歷史同步和電話歷史同步也都使用了CloudKit
一年之後我們看到了什麼？
我們上傳了2400多億個記錄
我們存儲了來自3億多用戶的
超過250PB的資源數據
我們真是喜不自禁
對於CloudKit帶給我們
可靠性和穩定性
所以今年我們會再加入幾個新特性
IOS和OS X上的備忘錄正在使用CloudKit
在你的設備之間實現備忘錄同步
我們昨天介紹的新app-新聞
也是完全構建在CloudKit公用數據庫基礎上的
今年就連WWDC app也在使用CloudKit
最後一個要點iOS 9上提供對iCloud備份
端口支持以便使用CloudKit
所以這其實有更大的意義
因爲就用戶數量 數據量
和每秒的請求數量而言
iCloud備份是我們最大的服務
我們也從你們開發者那裏得到了一些好的反饋
比如 Hipstamatic說利用CloudKit我們得以專注於
構建自己的app
甚至還有些遊刃有餘
這正是構建CloudKit的原因
爲了使你們這些開發者能夠專心構建優秀的app
構建美好的用戶體驗不用去設置服務器
不用去運營服務器
不用7乘24小時隨時待命
AgileBits正在使用CloudKit 同步密碼數據
他們對此非常滿意
他們這樣說CloudKit非常快速且高效
它使錯誤檢測和排除變得簡單易行
是CloudKit的設計目標之一
如果後臺程序 網絡或服務器端存在錯誤
我們會把該錯誤發回你的app
讓你的app負責處理 重試
如果那麼做是有意義的話
讚譽來自於IconFactory“CloudKit最大的優點之一是
沒有複雜的登陸程序或設置程序”
這也是我們的目標之一
讓天衣無縫的用戶體驗成爲可能
無需創建賬戶
無需錄入密碼或記住密碼
除了這些良好的反饋之外
我們還聽到了你們開發者提出一些問題
去年我們介紹CloudKit時
我們說它沒有限制
所以我們收到了一些問題比如 這是什麼意思？
如果我的app達到限額怎麼辦？
我要付給蘋果公司多少錢？
去年我們立刻收到的第二個問題大意是這樣的:
好的 但是網絡呢？
如果我有一個網絡app我想讓它能夠訪問
IOS和OS X CloudKitapp所訪問的相同的數據怎麼辦
關於這兩個問題的討論
我要把它交給Eric
Eric是iCloud服務器端團隊的經理
謝謝 謝謝 Olivier
很高興能在今天下午來到這裏
和你們討論CloudKit的新特性
首先我們來回答第一個問題
要花多少錢？
來看CloudKit的使用和價格
在此之前 我們需要理解
CloudKit的架構
當你使用CloudKit時你所有的數據都存儲在
你的CloudKit容器中
這個地方存儲着你所有的數據
你能夠以兩種不同的方式存儲這些數據
一種是作爲私人數據庫另一種是作爲公用數據庫
私人數據庫是用戶的私人數據
比如iCloud照片庫
你拍的所有照片都存在CloudKit中
用戶本人可以對其進行訪問和管理
由於這是用戶的私人數據
它佔用是用戶的存儲限額 不是開發者
現在我們來看公用數據庫
這是應用的公用數據
關於這個的最佳案例是我們昨天剛發佈
新的新聞app
其中所有的新聞文章是通過CloudKit公用數據庫
分佈在所有的新聞應用之中
由於它是應用的公用數據
它佔用的是開發者的存儲限額
所以當我們討論價格和使用時
我們其實是在討論公用數據庫的使用
我們來看看這是什麼意思
對於我們提供的公用數據庫
我們有一定的免費限額
如果你超出了免費限額我們還有一個收費結構
此外 我們還有使用數據
我們來看看免費限額
你把資源存在雲盤裏 追蹤到這些資源
一開始會送你10GB
所以 如果你沒有用戶 你剛開始發展
送你10G
隨着你的用戶數量增長
隨着你的應用越來越受歡迎
我們會給你增加每人額外250MB
我們會爲這些用你應用的用戶
我們可以增加到最高可達1PB的存儲空間
同樣
對於你存儲記錄數據的數據庫
我們一開始會送你100MB每個用戶可增加2.5MB
最高可達10TB的免費限額
除了數據存儲以外 還提供數據傳輸
上傳和下載資源時
你會消耗帶寬
我們一開始會每月送你2GB的
數據傳輸量與其他配給一樣
隨着你的用戶數量增加 會增加限額
我們每人每月會增加50MB
提供每月最高200TB的數據傳輸量
全部免費
對於數據庫 情況略有不同
我們的衡量依據是每秒的請求
我們一開始會送你每秒40個請求這個量很大
與其他配給一樣
它會隨着用戶數量增長
每增加10萬用戶
會有每秒10個請求的增量
最高可達每秒400個免費請求
關於每秒的請求數
重要的是它其實是一種節流限制
如果因爲某種原因你的應用達到了這些限額
我們會向你發送客戶端節流錯誤
告訴你 你已達到了限額
隨後我們再來討論一下
如何確保這種情況不會再次發生
好的 如果你真的超過了這些限額
可以付費獲取更多用量
也就是我們的公用數據庫費用
現在的情況是已超出了我們送你的免費限額
所以這個增量範圍是在你得到的免費限額和你的用量之間
資源是每月0.03美元/GB
數據庫是每月3.00美元/GB
在數據傳輸方面
傳輸資源是0.10美元/GB
對於數據庫的請求價格
100美元可額外增加10個請求/秒
如果你達到了免費限額
你可以根據需要增加用量
直到你的應用能夠平穩運行
當然 推送是免費的
好的 我們現在來看一個
CloudKit計算器的演示
它的訪問網址是developer.apple.com/cloudkit
如果你還沒玩過 你可以去玩玩
我要邀請Ramiro Calvo來幫我操作
因爲顯然我無法邊操作邊講話
他將幫我們演示這個
如果你進入這個計算器 會立刻注意到
我們的活躍用戶爲零
對嗎？ 你可以看到它下面有一些數字
它們會告訴你我們給你提供了多少免費的存儲空間
起初 它和我們剛纔說的一樣
10GB的資源存儲空間
100MB的數據庫存儲空間每月2GB的數據傳輸量
以及每秒40個請求
現在假設我的應用開始騰飛了
我有10萬個用戶
我們把數字增加到10萬
你會發現我們又給了你更多的存儲空間
如果你看下屏幕底部
Ramiro也許你能滾動一下屏幕
你會發現花費其實是0美元
Ramiro請把屏幕向下滾動一點 謝謝
好的 可以看到花費是0美元
現在假設我們的用戶達到了50萬人
好的 我們又一次得到了很多存儲空間
現在我們有多達125TB了
我們仍在增加限額 你的花費仍然是零
現在假設有100萬用戶
好的 現在我們有很多用戶了
我們有很多存儲空間
我們有多達250TB的數據
每秒有很多請求 它還是免費的
現在假設有400萬用戶
好的 現在是400萬用戶了
你會看到這裏將出現很大的數字
我們有多達1PT的存儲空間10TB的數據庫存儲空間
每月200TB的數據傳輸量
這是相當多的數據
所有這些依然不需要你花費分毫
現在來回想一下價格階梯
在某種情況下 我們達到了限額
這個限額貌似就在這裏
你得到了約1PB的存儲空間
你能得到的最大限額
那麼隨着我們增加更多的用戶一定會有一些花費
假設有500萬用戶
這裏的花費是仍是免費的
這是怎麼回事？
如果你的應用的平均用量
少於我們送你的每個用戶的用量仍然不需要你花費分毫
因爲是平均值
這意味着有些用戶也許超出了平均用量
有些也許用得少一些 這都沒有關係
它仍然無需你花費分毫
所以我們可以一直加到一千萬人
結果顯示仍然無需你花費分毫 對吧
如果你能正確構建你的應用
保持在我們送你的免費限額之內
這就是我們的計算方式如果你想獲取更多信息
請使用該計算器
感謝 Ramiro 
好的 下一個問題是我如何知道我用了多少？
CloudKit Dashboard 
是我們顯示該信息的場所
Dashboard是一個網絡應用
網址是developer.apple.com
你可以在這裏查看你的容器
管理你的記錄類型
不管它們是正在開發中還是已經完成了開發
我們又添加了一些新功能
如果你去看看我們添加了什麼
你會發現有個稱爲用法的新部分
你可以去那裏看看
你的應用容器性能如何
如果我們點進去
我們會有幾種不同的方法來查看這些數據
我們可以按天瀏覽或按月瀏覽
如果你是按天查看信息
該圖表的最上面是用戶數量
這非常重要
因爲我們正是根據你的用戶數量來計算送你多少免費資源
所以你應該先看一下這個
現在你還會注意到
右邊有一些虛線
因爲我們給你的是兩個月的數據
上個月和當月
當月取決於你的所在月份
其中有一些是預測
我們會根據您的容器之前的活動
爲你作出預測
下面是另一幅圖表
它顯示的是每秒的請求
每天我們會向你展示我們所看到的
某一天的每秒請求峯值是什麼
你還可以選擇按月 如果你選擇按月
你會看到12個月每個月份的
應用活動情況
而當月是典型的
用虛線表示的預測
基本上就是我們對當月的預期
現在我們往下滾屏來看看其他幾幅圖表
這是數據庫存儲和資源存儲
你會發現這裏有些不同
你會看到兩條線
上面是一條紅線 下面是一條黃線
紅線代表我們送給你的免費的存儲量
黃線代表你的實際用量是多少
所以現在你們大家要玩的遊戲是
如何讓黃線保持在紅線以下 對嗎
你要查看該信息的確切方法是
點擊右側這裏的限額箱
它默認是關閉的
如果你願意可以把它打開
之所以默認爲關閉是因爲我們送給你那麼多免費的存儲空間
如果你點開它比例尺會發生變化
與我們送給你的免費存儲量相比
你的用量基本上會看似一條直線
所以請別客氣 去試試看吧
CloudKit Dashboard可提供兩樣東西
跟蹤使用數據是一個新領域
也會送你們免費限額
如今可用的測試版已公佈在developer.apple.com
如果你已有容器
今天你就可用去那裏
看看Dashboard上的使用數據
好的
人們提出的第二個問題是“那麼網絡呢？”
我很高興向你們介紹
最新的CloudKit網絡服務
就是這個方法 是的 好
通過它 可以對接超強的iOS	
和OS X應用可用把它們擴展到網絡上
那麼它是如何運作的呢？
我們先來討論一下它的特性
你可以通過JSON和HTTPS獲取完整的CloudKit API
我們也提供CloudKit JS庫
它無疑是迅速創建網絡應用的
最佳方式
我們會提供的網絡註冊要使用Apple ID
用戶使用你的網絡app時
需要以這種方式進行驗證
那麼它是如何運作的？如果你觀察下 會發現你的應用正在
iOS和OS X上運行
它與CloudKit框架在幕後互動
與我們的CloudKit服務器對話
我們今天爲你介紹的是
創建你自己的網絡應用的能力
在瀏覽器中運行並討論JSON HTTPS
和我們的CloudKit網絡服務它能讓你
相同的CloudKit服務器對話
在iOS和OS X上進行交互的本地應用程序
關鍵是要理解JSON和HTTPS
關於這個它其實就是技術規範
沒有代碼
事實上它完全取決於開發者
對該技術規範的解讀
你得創建你自己的端點達到端點
你必須創建URL並構造JSON
後者進入實體並在請求中向上傳遞您取回 JSON 響應
對其進行解析處理資源的上傳與下載
重試邏輯等等等等
但這樣做更好的方法是使用CloudKit JS架構
CloudKit JS提供了可用的JavaScript API
使你避免了HTTPS和JSOH協議背後的一切複雜性
你可以使用其中任何一個但如果你去另謀出路
你很可能是瘋了所以請使用CloudKit JS
那麼它能給你什麼呢？
好的 它能給你全面的
公用與私人數據庫的存取
它能給你所有的記錄操作
它能讓你上傳和下載資源
它能讓你進行查詢
它甚至能讓你收到訂閱和通知
這意味着我的網絡應用
能夠收到不同步的事件就好像你收到推送
告訴你事情有變
或通知你一些其他事情
所以你無需讓用戶點擊更新按鈕
或是退出你的網絡應用
它還可以發現用戶的數據變化
它有能力解答自定義區中的語義發生了哪些變化
這會爲您提供同步的語義
簡而言之 它給你的是全面的兼容性
以及在iOS和OS X上運行的
本地CloudKit中的一切能力
正如我之前所說目前CloudKit JS絕對是
開發網絡應用的最佳方式
它是JavaScript API
它與本地CloudKit API相匹配
JavaScript與Objective-C語言相配
但你知道我們已經盡力了它是相當接近
因爲沒有中間服務器
可創建你的JavaScript應用
你可以直接和CloudKit對話 你知道
幕後的CloudKit網絡服務
你無需運行你自己的服務器或任何中間服務器
現在要介紹的是如何創建新的備忘錄網絡應用
這個前幾天曾演示過
讓Ramiro Calvo幫忙來演示一下
向你演示基於CloudKit JS新的備忘錄網絡應用
好的 我們先從icloud.com開始
這是我們的跳板
這裏已經有一些網絡應用了
你會看到一些熟悉的應用有照片和iCloud Drive
這是兩個已經存在於
CloudKit上部的應用程序
在iOS 9中 新的備忘錄應用也是建立在CloudKit上
所以我們已在CloudKit上創建了一個新的網絡應用
在接下來的演示中你會看到它豐富的能力
Ramiro將會點進去
這是它的網絡app
你會在這裏看到一些主要內容
你會看到圖片
你能編輯視頻
這裏有個複選框
所以這些事情在新的備忘錄app中都能實現
它們只是CloudKit的資源和記錄
好的現在我們要創建一個全新的備忘錄
因爲我們正在參加開發者大會
我們也許應該安排一下
在這裏參加開發者大會時該做些什麼
所以也許我們應該先從其中一件
較爲重要的事情開始
我們要確保我們會參加所有的會後派對
讓我們把這件事列在單子上
在我們參加完會後派對之後
我們真得訪問一下developer.apple.com/cloudkit
看看所有優秀的文稿
包括這個超棒的介紹
在那裏你會找到一切
有關CloudKit的信息和文稿
以及最新的CloudKit網絡服務
瀏覽完這些文稿之後我們應該退出
去創建我們的第一個CloudKit網絡應用
創建好之後 我們繼續下一項
盡最大努力達到免費限額
這可能要花費一段時間
所以我想我們無需覈對這一項
但我至少參加了一個派對
所以我們可先覈對這一項Ramiro
完成這個網絡體驗
現在我們去iOS操作系統
這是在iPad上運行新的備忘錄應用
我們打開它
你們會看到與我們之前所見一樣的廚房改裝計劃
這是我們在全球開發者大會上剛鍵入的我們要做的新事情
它會自動顯示出來
是同樣的數據 對嗎
只是我們有一個對接的網站界面
讓你把你的本地IOS界面對接上去
現在我們要在這裏做一些改動
訪問過developer.apple.com
顯然已經用備忘錄app開發了一款很棒的CloudKit網絡app
現在我們何不返回去
看看網絡
看看那邊發生了什麼
如果所有事情都做了
你會發現所有事情都覈對過了
這又是我之前提到過的通知體驗
出現了通知 推送通知
網絡應用將其選取
自動更新 向你顯示出變化
這就是在iOS 9和icloud.com上
可用的最新的備忘錄網絡app
謝謝 Ramiro 
如果你的用戶想使用該應用他們需要註冊
所以我們直接跳過去看看
你的網絡應用上所顯示的界面
首先你需要有一個
讓用戶註冊的按鈕
這就是你的用戶界面
當用戶點擊該按鈕之後會彈出一個新的瀏覽窗口
該瀏覽窗口歸Apple所有
由Apple管理
這是因爲ID和密碼
只在Apple和該用戶之間交互
開發者永遠看不到這個
在後面的登入頁面
還會顯示其他一些東西
首先是“保持登陸狀態”
這樣用戶可以選擇勾選
在未來兩週保持登陸狀態
“忘記Apple ID或密碼？”
如果用戶忘記了他們的ID
我們將全力幫助他們
想起密碼或重置密碼
最後 你知道 如果該用戶對Apple生態系統而言是個新用戶
他們根本沒有Apple ID
他們可當即創建一個Apple ID
他們將得到一個
可以在你的應用中立即使用的Apple賬戶
CloudKit網絡服務提供包括
我剛講到的僅用於iCloud網絡的賬戶
它會爲私人數據庫的使用提供1GB的免費存儲空間
如果同一位用戶訪問了iOS或OS X
並在那裏設置了他們的賬戶它會立刻自動更新爲
5GB的iCloud賬戶
公用數據庫的使用在iOS OS X和網絡上是一樣
沒有區別 所以在網絡上提出請求
和你在手機或Mac上提出請求
是一樣的
存儲也是一樣
在Dashboard上查看使用信息存儲區部分時沒有任何差別
它都是放在一起的
我們確實需要一款配得上iOS或OS X的應用
這些網絡服務的目的是
把超棒的iOS和OS X應用擴展到網絡上
它的開發測試版現在可以使用了是和iOS 9一起發佈的
這就是CloudKit網絡服務的內容
現在我要把Olivier請回來
結束這次講座 非常感謝
謝謝 Eric
這就是今天的內容
我們非常期待看到你們在CloudKit上
創建出某種應用
迸發出某種驚人的想法
正如Eric所說我們有了一個新的網頁：
developer.Apple.com/cloudkit
它彙集了我們擁有的所有數據以及在 CloudKit 方面的
包括在新的服務器 網絡API以及在客戶端框架方面的
所有文稿 參考庫以及示例代碼
除了常規的技術支持
論壇和網址以外
如果所有這些都不可用 你可以電郵
cloudkit@apple.com進行一般諮詢
本週我們還有兩節講座
第一節在明天 我們將深入探討
CloudKit JS和網絡服務 API
另一節講座在週四下午4:30分有關CloudKit技巧與竅門講座
在該講座中我們將演示最佳實踐
介紹一些注意事項
以及我們在iOS 9和OS X El Capitan中
對客戶端框架做出的一些改善
本週我們還有一些實驗室活動
在週三 週四 週五上午9:00
我們會請來客戶端工程師我們會請來服務器端工程師
我保證其中有些人甚至在早上9:00點還沒睡
請帶着你的問題和想法前來
我們樂於更多地討論數據
討論你們頭腦中的應用類型
無論用公用數據庫還是私人數據庫
非常感謝
感謝你們的關注
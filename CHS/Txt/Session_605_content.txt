《社交游戏的最新内容》
大家好
欢迎 感谢大家来参加我们的讲座
我是梅根·加德纳是游戏和图像小组的软件工程师
稍后会有请我的同事埃德温·艾斯坎达上台
我们会谈谈ReplayKit和游戏中心的社交功能
今天准备要介绍几项内容
首先是游戏中心的最新内容
我们有两项新内容
基本上是客玩家
和新的统一服务器环境
埃德温会来给大家介绍ReplayKit
这可以为游戏增添新的社交体验
用户可以与他人分享自己的游戏体验
游戏中心的最新内容是什么呢？
那么...
游戏中心是什么？
希望大家知道答案
特别是你参加本次讲座
这不是新内容不过以防万一 我解释一下
游戏中心是我们的API和app
可以让你作为开发人员为游戏添加社交体验
这可以让用户彼此成为朋友
便于开发人员设置排行榜
对于用户而言可以公开分数
这样可以和朋友以及他人来进行比较
对你而言可以确定用户所取得的成绩
我们还支持你编写实时或回合多人游戏
所需的一切内容
同时不必设置自己的服务器
我们还支持将多人元素加入
单人游戏中
还有什么新的呢？
首先 有客玩家
目前 在游戏中心我们有两个主要位置
可以遇到玩家
首先是GKLocalPlayer
每个设备上只有一个必须是认证的游戏中心用户便行
你还作为GKLocalPlayer的朋友进入GKPlayer
但更常见的情况是作为任何多人游戏的参与者
无论是实时或是基于回合均可
不过对于这些玩家
每个设备只能有一个玩家
现在不再是这样了
我们现在还有客玩家功能
什么是客玩家？
他们实际上是GKPlayer实例
使用方法和其他GKPlayer一样
这些不需要认证
他们是由你提供识别符来生成
然后我们会把GKPlayer给你
在任何多人游戏中他们都是一级参与者
因此你可以通过客玩家填充
游戏中的其他插槽
你需要至少一个认证的GKPlayer
但是其他的内容均可是这些客玩家
客玩家可以用来做什么呢？
他们在通关和游戏方面都很棒
比如你想有个iPad游戏
登录了一个玩家
其他所有人都想要玩
你可以用客玩家填充其余插槽
并可以在用户准备玩的iPad上
准备完全的本地游戏
你可以将回合游戏的游戏逻辑完全按照
其他游戏中那般处理
可以传递消息可以传递回合
可以像其他回合游戏中那样
发送交换要求
这也是插入AI玩家的不错的方法
可以让你和其他方式一样 拥有相同的游戏逻辑
而且还可以让用户可以在不同层级的AI上游戏
这样就可以让他们更快地学习游戏
我刚说过 有了客玩家你可以定义标识符
这个标识符必须在整个游戏环节都独一无二
无论你最后用的是什么方法
确保都不要与标识符发生任何冲突
如果在一个设备上有一个客玩家
在另一个设备上有另外的客玩家
要确保他们不会冲突
否则游戏逻辑可能就会有问题
这些客玩家不会有积分或成绩
这也合情合理因为在服务器上不会公布这些
但是你需要对此了解
有客玩家的环节只有在玩家的环节用的
也是iOS 9时才会兼容
这并不是将你的游戏限制在iOS 9
这只会限制有着客玩家的单独环节
和其他使用iOS 9的用户相匹配
我们想让它变得更容易些
我们不会在那些无法参加游戏的任何人之间进行自动匹 配 
如果你的一个用户向无法参与的某人
发送多人游戏的邀请
我们会在服务器端代替他们自动拒绝
这样你就不会遇到任何问题
不过你需要明白这一点
同样地这不会锁定你的游戏
在兼容性矩阵中规定的每项内容还依然奏效
使用iOS更早版本运行你的游戏
也依然适用
这只是指那些个人可玩性环节
这就是客玩家
我们真心希望这会让你创造
有趣的动态方式来加入多人游戏中
我们非常兴奋地看到大家就要这么做了
接下来 我们有了游戏中心Sandbox 环境
Sandbox
是我们用来 生成单独的环境
便于无需生产成品即可测试游戏
中心的功能 
但是我们有着...完全相同的服务器
你必须有不同的账户
在两处有着完全相同的数据
这非常棒
但我们觉得Sandbox已经...
发挥作用
现在我们要在制作中统一Sandbox
我们仍然会有两套数据
但是都会在相同的服务器上运行
这会给我们带来许多好处
这可以简化账户
你不再需要有单独的Sandbox账户  
你也不必担心维护问题
交友或处理 任何类似问题
这与TestFlight完全兼容
这样你可以把游戏发送到TestFlight 
便于测试方进行测试
而无需担心设置Sandbox的问题
多玩家模式可以用于你在
服务器上公布的任何版本 
而且是自动完成你不必做任何设置
在我们这边会打开开关
需要注意这么几点
首先 你所工作的任何新游戏 
都会在游戏中心的你的游戏名单中显示
正如大家所见
我和demo-liscious正在研究GK测试团队
如果你是demo-liscious的朋友
那么你可以在游戏中心app点击她的头像
如果你点击她的游戏名单 你就可以上下翻看
看到她正在研究那个游戏
如果有个游戏你不希望别人知道
我们建议你可以设置单独的账户
但这应该不是太大的问题
在游戏运行时你所公布的...
任何分数
都会被公布在同一排行榜
iOS 8用户仍需要在设置中
打开Sandbox开关
因为如果它们认为不该进入Sandbox环境 
我们会自动报错
Sandbox并不存在
所以它们并不会在Sandbox中 
但会看到部分相同的UI处理
不过幸好 大家都可以从iOS 8升级到iOS 9
所以我们也建议你这么做
我们来看这样做对于所有这些部分意味着什么
排行榜
所有版本都会在同一个排行榜
但是如果你更新游戏
在其中还添加了新的排行榜
这些排行榜只有你或运行该版本
即游戏的更新版本的
测试团队可见
其他人则无法看到这些排行榜
而所有其他内容都会被公布在相同的制作排行榜上
所幸的是 所有内容都是iTunes Connect
这会让你在公布它们或
你或测试团队调用任何分数结果却公布了错误结果
或是你不希望影响排行榜的真实性
可以使用当前的工具清除
通过 iTunes Connect可以很轻松进行清除
对于多人游戏模式这是个非常大的好处
这让你可以测试在已经大量
制作的游戏中你的多人游戏模式的升级
可以进行测试 
但是在产前服务器和生产服务器之间并无壁垒
它们都是同样的服务器
你可以轻松测试并确保对多人
游戏模式的任何升级 
都会有效地与任何现有内容相适应
对于iTunes Connect
你将保持两套完全不同的元数据
我们都将在服务器上维护
你将会有当前释放版本的数据
以及未释放版本的数据
你将获得哪些数据
你或者用户或测试团队
则要 取决于在设备上安装的app的
CFBundleVersion
如果设备的CFBundleVersion
胜过你将从App Store获取的松开捆绑版本
你将会得到未释放数据
如果你的设备上的CFBundleVersion 
小于或等于你从 App Store下载的
松开捆绑版本你将会得到当前释放的数据
如果在App Store中没有
那你将获得未释放数据
这是存在的唯一数据
我们再来看一遍
如果你和测试团队之一在运行游戏的...
beta版本 
那么游戏中心app中你的好友将可以看到这款游戏
你还可以玩其他的beta版本
这是那里仅有的版本
你将在beta排行榜上公布内容
现有的只有这些排行榜
如果你和用户之一在运行游戏的发行版本
这是常见的情况
你还可以在游戏中心看到游戏
是在游戏中心的好友名单的位置
如果是多人游戏你可以在兼容性矩阵
和iTunes Connect中指定的任何版本来玩
其中包括游戏不一定...
知道的版本
因为兼容性矩阵是存储在服务器上
而服务器知道你会匹配
这些未释放的游戏
正如你所期望的那样你会公布
释放的排行榜
如果你和测试团队之一
在运行游戏尚未公布的 更新版本
游戏仍从游戏中心的游戏中心好友名单可见
你还可以玩其他的指定版本
无论是游戏的较早版本还是正在测试的游戏的新版本
兼容性矩阵所指定的任何内容你都可以玩
然后如果排行榜   已经存在
你将公布释放排行榜
或者要公布未释放的排行榜
如果是该游戏和这些游戏的新排行榜的话
这些排行榜只能被系统中
已有游戏版本的人们看到
这就是新增内容
首先是我们希望为游戏
扩大多人游戏机会的客玩家
以及统一的服务器环境
这其实很简单 是自动完成
你无需进行任何设置
它会与TestFlight配合良好
我们觉得大家会有更好的方法
对游戏进行功能测试
我觉得这一定会让大家
觉得生活轻松了许多
现在请埃德温上台
他会给大家讲讲最新框架重放工具
好
谢谢 梅根
下午好 我是埃德温·艾斯坎达
是Apple的图形和游戏团队的软件工程师
我来和大家讲讲ReplayKit
在游戏领域发生了一些非常难忘的时刻
例如你终于在看似不可能的程度
实现了三颗星
或是你终于打败了大老板
而自己毫发无损
如果能够捕捉并分享这些时刻
那该有多棒啊？
于是就有了ReplayKit
ReplayKit记录运行应用的
视频和音频部分
它可以实现增加语音评论
这样可以令录音更具个人特点
或可增添上下文
还可以允许用户进行回放
整理和修整录音
最后
分享录音到他们所喜爱的社交网络和视频
目的地网站
ReplayKit会生成高质量的HD录音
在TV 网站和移动设备上播放效果都很好
这样做效率极高
可实现性能影响较低
同时可以将功率使用降到最小
ReplayKit包括隐私保护功能
可以帮助保护用户隐私
在接下来的幻灯片中我们会详细介绍
在iOS 9 beta版 就有这一功能
晚些时候到秋天当iOS 9上市 客户就可用到
在所有A7和A8的设备中均可使用
和所有的Apple框架一样
ReplayKit也很重视用户的隐私
在ReplayKit开始录制之前
它需要用户提供许可
是通过用户同意弹窗来实现
ReplayKit还支持家长控制功能
如果孩子会经常用设备 
你可以通过设置在整个系统关闭ReplayKit功能
通过ReplayKit制作的所有录制都不包括系统UI
这意味着在录制期间所发出的
任何个人通知都不会包括在内
游戏中的任何键盘输入也是如此
最后 应用不会直接访问
电影文件
只能通过ReplayKit的
预览UI和分享列表用户才能访问
好我们先通过架构来看
ReplayKit 如何发挥作用
这样应用就连接到ReplayKit框架
它会用到两个类RPScreenRecorder
来处理录制任务
RPPreviewViewController
负责预览UI和分享列表
RPScreenRecorder
会与中继精灵沟通
这是应用的单独过程
中继精灵与较低水平的视频和音频服务沟通
这些服务相继与
硬件沟通来捕获应用和视频和音频
并会从设备的麦克风获取音频数据
在捕获过程中
中继精灵会实时对数据进行编码
并把它写入电影文件
它写入电影文件的位置只能通过
ReplayKits内部服务访问
用户实际上是怎样和影片互动呢？
当你告知RPScreenRecorder
停止录制时 它会返回RPPreviewViewController
你就可以
把它显示出来
RPPreviewViewController
显示预览并分享可以访问
影片的扩展
而用户可以与之互动
来预览并分享影片
正如大家所见这是相当复杂的系统
有很多变动的部分
不过幸好对于开发人员而言
只是归结为这两类
RPScreenRecorder和RPPreviewViewController
很简单
好我们先仔细来看这些类
首先是RPScreenRecorder
同样 它负责开始 停止
丢弃录制结果
它还可以用于检查录制能力
它还可以用于
启动麦克风进行评注
RPScreenRecorder
有委托 你可以 
设置委托使其符合
RPScreenRecorder委托协议
委托可以用来检查可用性的改变
例如由于出现错误
录制会停止工作的情况
在第二类中RPPreviewViewController
同样 它负责预览录制 编辑
剪辑以及最后分享影片
RPPreviewViewController也有有委托
你可以设置委托使其符合
RPPreviewViewControllerDelegate协议
当用户进行预览和分享时
这可以用来取消视图控制器
就是这样
其实只有两类和两个协议
这是个精简版框架
大家会看到用起来非常简单
我们来看API具体怎么用
我认为最好是举例说明
我们的例子是
样本代码团队生成的DemoBots游戏
大家可能在其他讲座中见过它
不过万一你还不了解
我来介绍一下 DemoBots的前提是
你有这个任务自动程序所在的电路板
而且任务自动程序负责保持电路板的运转
不过可惜的是所有的自动程序都有问题
你需要进行调试
DemoBots的每个层次都要用2-3分钟
这是个小游戏环节
可以在developer.Apple.com
下载资源
你必定要去看一下
其中显示了很多Apple的最新游戏技术
这是个相当不错的样本
我们选择DemoBots来展示ReplayKit 
原因之一是场景流非常不错
这在iOS游戏中很常见
一旦启动DemoBots你就会被视作主菜单
从主菜单
可以启动游戏
它会把你转到游戏关卡
在游戏关卡如果你成功或失败
就会被转到关卡结束场景
从关卡结束场景
你可以重玩这一关或进入下一关
那么我们现在了解到场景流是什么样子
我们来看ReplayKit怎样匹配
因为我们知道DemoBots 有着小游戏环节
我们可以选择自动录制策略
我的意思是说
我们会告知ReplayKit
在游戏关卡开始时立刻开始录制
我们还想告知在游戏关卡结束时
要停止录制
我们想让用户可以预览和分享录制结果
但是我们不想在录制结束时 立即这么做 对么？
我们想在所有动作都消失后再这么做
最理想的位置是在关卡结束场景
非常简单
我们来走一遍
首先是主菜单
因为我们在用自动录制策略
我们想让用户关闭这个功能
如果他们不想自动录制每个关卡
为此我们执行了顶部的自动录制按钮
用户可以用来打开关闭这个行为
比如 用户打开了
这个功能接着按下新游戏按钮
在此刻 我们转到游戏实际所在的游戏关卡
我们想告知ReplayKit开始录制
我们来看代码中是什么样
首先 我们需要RPScreenRecorder的实例
在每个应用中都有RPScreenRecorder的分享实例
可以通过类功能访问分享的录制工具
相当简单
开始录制
通过在共享的实例中启动麦克风
我们调用开始录制功能
这里你可以明确是否要开启或关闭语音评论
你还会提供处理程序块
该程序块提供了可选的NSError
如果在这里收到错误信息
则应做相应处理
本例中我们会暂停游戏
提示用户录制也会失败
一旦启动麦克风开始录制
用户就会看到用户同意弹窗
此刻用户会有三个选项
他可以选择录制屏幕
麦克风启动语音评论
他们可以只录制屏幕
或不允许进行录制
因此每次用户启动麦克风开始录制时
同意弹窗会调用
但是一旦用户已经接受
它就不会在接下来的
8分钟内再次出现
假设用户现在希望启动语音评论功能
并要录制屏幕
所以他们会按下录制屏幕和麦克风按钮
好的 此刻ReplayKit开始录制
游戏开始用户开始打游戏
提供语音评论等种种
他们会对这一具体关卡调试所有的任务自动程序
此刻 他们打通的关卡我们希望转到
关卡结束场景
在这么做之前我们想要告知
ReplayKit停止用代码录制 
我们只想在共享的录制工具实例中
用处理程序停止录制
然后处理程序阻止了应用的可选NSError
和可选预览视图控制器
同样适度处理错误
对于预览视图控制器你有两个选项
可以立即显示
或是放在一边以后使用
我们要先放在一旁因为还不想现在就显示
ReplayKit已经停止录制
现在我们转到关卡结束场景
这里我们想让用户预览和分享他们的影片
我们执行播放录制按钮就在右上方
用户轻轻点击
我们想要显示预览UI
用代码来实现 我们只需调用UIViewController
在呈现动画视图控制器时
我们临时接入了预览视图控制器
这是我们之前作为参考的
这就带入了重放工具的预览UI
用户可以整理
剪辑
并最后分享到他们的录制结果
使用ReplayKit的分享UI
这样分享UI和UI分享预览控制器一起执行
这样你甚至可以在app中编写自己的自定义分享扩展
这非常酷
假设用户想要在Facebook分享视频
点击Facebook按钮
Facebook就会浮现出来
视频已经附上他们可以编写自定义的信息
随后只需按下发表就会在信息来源显示
用户使用起来非常简便
而且充满乐趣
现在视频已经发布到用于的Facebook信息来源
他们可以分享和预览
现在他们想取消并丢弃预览UI
记住我们显示了预览UI
我们也负责丢弃它
要处理丢弃功能
只要设置预览视图控制器委托
该委托需要符合
RPPreviewViewController委托协议
并应执行预览控制器
最后要提供预览视图控制器
你可以在预览视图控制器上调用
丢弃动画视图控制器即可
基本是这样
只要两行代码
我们在DemoBots中
有ReplayKit的基本执行
这非常简单
总结一下 我们介绍了录制工具的分享实例
如何停止和开启录制工具
如果显示和取消预览UI
现在我们介绍了基本内容
我们接下来进入更高级的内容
微调ReplayKit执行
首先要证实可用性
出于若干原因 ReplayKit 可以是可用
或是不可用
ReplayKit使用的捕捉视频内容的技术
和AirPlay与TV相同
不过它无法与这两种服务中的
任何一种同时使用
正如我提到的A7和A8设备
支持ReplayKit
在更早的设备上ReplayKit不可用
要想检查可用性
只需...查询可用属性和RPScreenRecorder即可
如果不可用该怎么办？
只需把游戏或app中的录制UI丢弃就好
因为可用性可以实时改变
你可以执行RPScreenRecorder
委托屏幕录制工具来改变可用性
来注意可用性方面的改变
给个小例子 还记得我们在DemoBots中的
自动录制开关吗？
如果ReplayKits在设备上不可用 
我们不想显示那个开关 对吗？
在RPScreenRecorder 询问可用属性
用它来驱动录制开关按钮的可见性
很简单
接下来是丢弃录制结果
因此ReplayKit 在新录制开始时 
会自动丢弃之前的录制
当前每个应用每次只有一个录制
但是在有些情况下
用户不会再访问预览UI
你可能想尽早丢弃它
在我们的DemoBots实例中
如果用户从关卡结束场景转换
要知道他们将无法再预览视频
因此你应该把它丢弃掉
用代码来实现
在具体本例中
我将转至下一个关卡的场景
下一种方法
我们将用处理程序调用丢弃录制
一旦返回
我们就会转到下一个关卡
接下来是录制指示器
当ReplayKit进行录制时
你可能会告知用户录制正在进行中
以及语音评论是否打开或关闭
为实现这点 你可以直接询问录制工具
麦克风启动RPScreenRecorder的属性
并使用这些值打开录制指示器
的可见性
同样是非常简单
接下来是排除UI
游戏中有些元素
对用户而言非常有用
<br/> 但是对观众来说很是无趣
我们来介绍其中的一项录制指示器
用户了解它非常重要
但是对观众来说就相当无用
他们了解录制功能是打开状态
语音评论也已打开因为他们在观看视频 对吧？
所以你可能想排除这些功能
还有两个例子是关于虚拟控制
暂停和菜单按钮
这可能会扰乱录制过程
且对观众而言并不必要
怎样从ReplayKit排除UI？
ReplayKit只会记录应用的主UI窗口
如果你想要排除任何UI
你只需...
创建UI窗口的新实例
并把想要隐藏的任何元素
放入新实例中即可
这就可以排除UI
接下来是要选择何时开始录制
如果你还记得在DemoBots中
我们知道DemoBots
有小游戏环节
只有两三分钟长度
我们会采取自动录制策略
这样可以自动录制每个游戏关卡
但是部分游戏是不一样的 对吧？
例如 在RPG
游戏可玩性环节就会较长
可能会有更长的有趣事件
但是没必要把整个环节都录制下来
相反 应该让用户可按照自己意愿
开始或停止录制
为此 你只需搭建自己的录制控制功能
让用户可以实现这一点
同样每个游戏情况都不同
所以需要选择适合自己的具体游戏类型的情况
好的实际上最后也就是微调环节
我们接下来讨论了如何证实可用性
如何丢弃录制结果
如何显示指示器
如何排除任何UI
以及为游戏选择最佳的录制策略
现在我们来给大家看一段演示
在两周前
我们邀请时空工作室来到库柏蒂诺
检查ReplayKit 
并试着将它用于...
新游戏《冠军的召唤》
我想把讲台交给时空工作室的...
辛科·巴尼斯
让他和大家分享自己的经验
欢迎辛科
谢谢 埃德温
我是辛科·巴尼斯
2005年的时候 我和伙伴们成立了时空工作室
我们是想制作硬核PC游戏
但是在2009年 因iOS和首台iPad这些都不再考虑
我们推出了《口袋传奇》游戏
之后 我们就一直专注于iOS游戏平台
这一切都非常神奇
今天 我来和大家谈谈《冠军的召唤》
以此作为ReplayKit的实例
我的确想和大家谈谈它怎样影响了游戏本身
但是更主要的是它如何搭建社区
特别是对我们来说游戏人员的社区 
活跃的游戏人员
我想给大家介绍一点我们的历史
时空工作室一直在致力于硬核游戏
提取精华 并融入手机游戏风格中
通过这种方法我们在试图
提供可以立刻访问的内容和具体战略丰富性的内容方面
找到了自己的强项
我们的下一个产品是《冠军的召唤》
《冠军的召唤》是个手机打斗竞技场
是个三对三的团队游戏
赛道机制是受到橄榄球的启发
它是按照射手风格在中间开启
主要内容是挤入一个5分钟的
混合武术打斗环节
我们非常努力在这5分钟内
加入所有不同的选择和不同的策略
我们知道观众定会喜欢这些
但是我们也知道受到此类游戏吸引的观众
并不希望自己亲自来玩
他们喜欢观看游戏
他们喜欢观看游戏现场
我们所做的还包括
提供观看模式 
以便在世界各地的任何角落都可以观看
游戏现场
通过游戏本身可以满足我们这方面的需求
但是我们也知道人们喜欢录制并
分享游戏内容作为游戏社区
创建的动力 这也是ReplayKit的用武之地
这里是我和大家分享的重播实例
作为此类游戏的设计方
我有着顶级的编程人员
能力远比我和合伙人高出许多
我很想来展示观看的相关功能
在这个上下文中重播可以
让我实现这一点
这里有相当多的很酷的内容
但是我添加的评论和在共享环境中的介绍
则是ReplayKit的功劳
我是说 我们会看到这在《冠军的召唤》这类
游戏中发挥了极好的作用
我们认为在如今的富媒体市场中
对于积极发展社区的人来说
这都会很有帮助
这是很漂亮的一击
很有技术含量而且还是个很专业的玩家
朝他开火干掉了我的搭档
在游戏的结尾部分捕捉到这些瞬间
并与人分享这对我很重要
这也是所有这些的精髓所在
当我想到ReplayKit时 
在我看来 这是在介绍社区的有力手段
并关注我们正在玩的游戏
我们都在分享并把这类内容
加入《冠军的召唤》
这类游戏中是很简单的
执行方面我们就用了一个人 里克
他花了一天时间就做好了
无可否认
太精彩了！
这就是我对它的评价
非常感谢大家
埃德温 回到台上来吧
谢谢 辛科
非常棒
可惜的是本次讲座马上要结束了
《社交游戏的最新内容》
总结一下
梅根介绍了游戏中心的改变
例如加入了客玩家功能
可以实现新玩家配置和游戏中心的多人游戏模式
她还介绍了怎样流线化开发过程
测试游戏中心的游戏
这是通过统一服务器环境
去除那个游戏中心Sandbox
我们还介绍了ReplayKit
为游戏中增加社交功能的全新方法
可以让你在运行应用的同时记录视频和音频
这样做非常高效
同时还可以保护用户的隐私
正如大家所见这是个高度精简的框架
使用起来也非常简单
若想了解更多
可前往developer.Apple.com
并参考文档资料或联系我们的游戏技术
开发顾问阿兰·斯卡夫
我希望大家尽快下载iOS 9数据
查看ReplayKit
用于你的游戏中把它们带到实验室
给我们看看你做出了什么
就是这些内容
感谢大家光临
希望大家会喜欢在WWDC的体验
谢谢
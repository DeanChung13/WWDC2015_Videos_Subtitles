CloudKit中的新特性
下午好 欢迎参加第704环节的讲座“CloudKit中的新特性”
我叫Olivier
是iCloud客户端团队的技术经理
一年前我们介绍了CloudKits它对你们开发者来说
是一种驾驭iCloud的全新架构
我们在iOS 8上构建了很多
CloudKits的新特性
最明显是把iCloud Drive和iCloud照片库
全部加入了CloudKit之中而Mail Drop HomeKit
Safari历史同步和电话历史同步也都使用了CloudKit
一年之后我们看到了什么？
我们上传了2400多亿个记录
我们存储了来自3亿多用户的
超过250PB的资源数据
我们真是喜不自禁
对于CloudKit带给我们
可靠性和稳定性
所以今年我们会再加入几个新特性
IOS和OS X上的备忘录正在使用CloudKit
在你的设备之间实现备忘录同步
我们昨天介绍的新app-新闻
也是完全构建在CloudKit公用数据库基础上的
今年就连WWDC app也在使用CloudKit
最后一个要点iOS 9上提供对iCloud备份
端口支持以便使用CloudKit
所以这其实有更大的意义
因为就用户数量 数据量
和每秒的请求数量而言
iCloud备份是我们最大的服务
我们也从你们开发者那里得到了一些好的反馈
比如 Hipstamatic说利用CloudKit我们得以专注于
构建自己的app
甚至还有些游刃有余
这正是构建CloudKit的原因
为了使你们这些开发者能够专心构建优秀的app
构建美好的用户体验不用去设置服务器
不用去运营服务器
不用7乘24小时随时待命
AgileBits正在使用CloudKit 同步密码数据
他们对此非常满意
他们这样说CloudKit非常快速且高效
它使错误检测和排除变得简单易行
是CloudKit的设计目标之一
如果后台程序 网络或服务器端存在错误
我们会把该错误发回你的app
让你的app负责处理 重试
如果那么做是有意义的话
赞誉来自于IconFactory“CloudKit最大的优点之一是
没有复杂的登陆程序或设置程序”
这也是我们的目标之一
让天衣无缝的用户体验成为可能
无需创建账户
无需录入密码或记住密码
除了这些良好的反馈之外
我们还听到了你们开发者提出一些问题
去年我们介绍CloudKit时
我们说它没有限制
所以我们收到了一些问题比如 这是什么意思？
如果我的app达到限额怎么办？
我要付给苹果公司多少钱？
去年我们立刻收到的第二个问题大意是这样的:
好的 但是网络呢？
如果我有一个网络app我想让它能够访问
IOS和OS X CloudKitapp所访问的相同的数据怎么办
关于这两个问题的讨论
我要把它交给Eric
Eric是iCloud服务器端团队的经理
谢谢 谢谢 Olivier
很高兴能在今天下午来到这里
和你们讨论CloudKit的新特性
首先我们来回答第一个问题
要花多少钱？
来看CloudKit的使用和价格
在此之前 我们需要理解
CloudKit的架构
当你使用CloudKit时你所有的数据都存储在
你的CloudKit容器中
这个地方存储着你所有的数据
你能够以两种不同的方式存储这些数据
一种是作为私人数据库另一种是作为公用数据库
私人数据库是用户的私人数据
比如iCloud照片库
你拍的所有照片都存在CloudKit中
用户本人可以对其进行访问和管理
由于这是用户的私人数据
它占用是用户的存储限额 不是开发者
现在我们来看公用数据库
这是应用的公用数据
关于这个的最佳案例是我们昨天刚发布
新的新闻app
其中所有的新闻文章是通过CloudKit公用数据库
分布在所有的新闻应用之中
由于它是应用的公用数据
它占用的是开发者的存储限额
所以当我们讨论价格和使用时
我们其实是在讨论公用数据库的使用
我们来看看这是什么意思
对于我们提供的公用数据库
我们有一定的免费限额
如果你超出了免费限额我们还有一个收费结构
此外 我们还有使用数据
我们来看看免费限额
你把资源存在云盘里 追踪到这些资源
一开始会送你10GB
所以 如果你没有用户 你刚开始发展
送你10G
随着你的用户数量增长
随着你的应用越来越受欢迎
我们会给你增加每人额外250MB
我们会为这些用你应用的用户
我们可以增加到最高可达1PB的存储空间
同样
对于你存储记录数据的数据库
我们一开始会送你100MB每个用户可增加2.5MB
最高可达10TB的免费限额
除了数据存储以外 还提供数据传输
上传和下载资源时
你会消耗带宽
我们一开始会每月送你2GB的
数据传输量与其他配给一样
随着你的用户数量增加 会增加限额
我们每人每月会增加50MB
提供每月最高200TB的数据传输量
全部免费
对于数据库 情况略有不同
我们的衡量依据是每秒的请求
我们一开始会送你每秒40个请求这个量很大
与其他配给一样
它会随着用户数量增长
每增加10万用户
会有每秒10个请求的增量
最高可达每秒400个免费请求
关于每秒的请求数
重要的是它其实是一种节流限制
如果因为某种原因你的应用达到了这些限额
我们会向你发送客户端节流错误
告诉你 你已达到了限额
随后我们再来讨论一下
如何确保这种情况不会再次发生
好的 如果你真的超过了这些限额
可以付费获取更多用量
也就是我们的公用数据库费用
现在的情况是已超出了我们送你的免费限额
所以这个增量范围是在你得到的免费限额和你的用量之间
资源是每月0.03美元/GB
数据库是每月3.00美元/GB
在数据传输方面
传输资源是0.10美元/GB
对于数据库的请求价格
100美元可额外增加10个请求/秒
如果你达到了免费限额
你可以根据需要增加用量
直到你的应用能够平稳运行
当然 推送是免费的
好的 我们现在来看一个
CloudKit计算器的演示
它的访问网址是developer.apple.com/cloudkit
如果你还没玩过 你可以去玩玩
我要邀请Ramiro Calvo来帮我操作
因为显然我无法边操作边讲话
他将帮我们演示这个
如果你进入这个计算器 会立刻注意到
我们的活跃用户为零
对吗？ 你可以看到它下面有一些数字
它们会告诉你我们给你提供了多少免费的存储空间
起初 它和我们刚才说的一样
10GB的资源存储空间
100MB的数据库存储空间每月2GB的数据传输量
以及每秒40个请求
现在假设我的应用开始腾飞了
我有10万个用户
我们把数字增加到10万
你会发现我们又给了你更多的存储空间
如果你看下屏幕底部
Ramiro也许你能滚动一下屏幕
你会发现花费其实是0美元
Ramiro请把屏幕向下滚动一点 谢谢
好的 可以看到花费是0美元
现在假设我们的用户达到了50万人
好的 我们又一次得到了很多存储空间
现在我们有多达125TB了
我们仍在增加限额 你的花费仍然是零
现在假设有100万用户
好的 现在我们有很多用户了
我们有很多存储空间
我们有多达250TB的数据
每秒有很多请求 它还是免费的
现在假设有400万用户
好的 现在是400万用户了
你会看到这里将出现很大的数字
我们有多达1PT的存储空间10TB的数据库存储空间
每月200TB的数据传输量
这是相当多的数据
所有这些依然不需要你花费分毫
现在来回想一下价格阶梯
在某种情况下 我们达到了限额
这个限额貌似就在这里
你得到了约1PB的存储空间
你能得到的最大限额
那么随着我们增加更多的用户一定会有一些花费
假设有500万用户
这里的花费是仍是免费的
这是怎么回事？
如果你的应用的平均用量
少于我们送你的每个用户的用量仍然不需要你花费分毫
因为是平均值
这意味着有些用户也许超出了平均用量
有些也许用得少一些 这都没有关系
它仍然无需你花费分毫
所以我们可以一直加到一千万人
结果显示仍然无需你花费分毫 对吧
如果你能正确构建你的应用
保持在我们送你的免费限额之内
这就是我们的计算方式如果你想获取更多信息
请使用该计算器
感谢 Ramiro 
好的 下一个问题是我如何知道我用了多少？
CloudKit Dashboard 
是我们显示该信息的场所
Dashboard是一个网络应用
网址是developer.apple.com
你可以在这里查看你的容器
管理你的记录类型
不管它们是正在开发中还是已经完成了开发
我们又添加了一些新功能
如果你去看看我们添加了什么
你会发现有个称为用法的新部分
你可以去那里看看
你的应用容器性能如何
如果我们点进去
我们会有几种不同的方法来查看这些数据
我们可以按天浏览或按月浏览
如果你是按天查看信息
该图表的最上面是用户数量
这非常重要
因为我们正是根据你的用户数量来计算送你多少免费资源
所以你应该先看一下这个
现在你还会注意到
右边有一些虚线
因为我们给你的是两个月的数据
上个月和当月
当月取决于你的所在月份
其中有一些是预测
我们会根据您的容器之前的活动
为你作出预测
下面是另一幅图表
它显示的是每秒的请求
每天我们会向你展示我们所看到的
某一天的每秒请求峰值是什么
你还可以选择按月 如果你选择按月
你会看到12个月每个月份的
应用活动情况
而当月是典型的
用虚线表示的预测
基本上就是我们对当月的预期
现在我们往下滚屏来看看其他几幅图表
这是数据库存储和资源存储
你会发现这里有些不同
你会看到两条线
上面是一条红线 下面是一条黄线
红线代表我们送给你的免费的存储量
黄线代表你的实际用量是多少
所以现在你们大家要玩的游戏是
如何让黄线保持在红线以下 对吗
你要查看该信息的确切方法是
点击右侧这里的限额箱
它默认是关闭的
如果你愿意可以把它打开
之所以默认为关闭是因为我们送给你那么多免费的存储空间
如果你点开它比例尺会发生变化
与我们送给你的免费存储量相比
你的用量基本上会看似一条直线
所以请别客气 去试试看吧
CloudKit Dashboard可提供两样东西
跟踪使用数据是一个新领域
也会送你们免费限额
如今可用的测试版已公布在developer.apple.com
如果你已有容器
今天你就可用去那里
看看Dashboard上的使用数据
好的
人们提出的第二个问题是“那么网络呢？”
我很高兴向你们介绍
最新的CloudKit网络服务
就是这个方法 是的 好
通过它 可以对接超强的iOS	
和OS X应用可用把它们扩展到网络上
那么它是如何运作的呢？
我们先来讨论一下它的特性
你可以通过JSON和HTTPS获取完整的CloudKit API
我们也提供CloudKit JS库
它无疑是迅速创建网络应用的
最佳方式
我们会提供的网络注册要使用Apple ID
用户使用你的网络app时
需要以这种方式进行验证
那么它是如何运作的？如果你观察下 会发现你的应用正在
iOS和OS X上运行
它与CloudKit框架在幕后互动
与我们的CloudKit服务器对话
我们今天为你介绍的是
创建你自己的网络应用的能力
在浏览器中运行并讨论JSON HTTPS
和我们的CloudKit网络服务它能让你
相同的CloudKit服务器对话
在iOS和OS X上进行交互的本地应用程序
关键是要理解JSON和HTTPS
关于这个它其实就是技术规范
没有代码
事实上它完全取决于开发者
对该技术规范的解读
你得创建你自己的端点达到端点
你必须创建URL并构造JSON
后者进入实体并在请求中向上传递您取回 JSON 响应
对其进行解析处理资源的上传与下载
重试逻辑等等等等
但这样做更好的方法是使用CloudKit JS架构
CloudKit JS提供了可用的JavaScript API
使你避免了HTTPS和JSOH协议背后的一切复杂性
你可以使用其中任何一个但如果你去另谋出路
你很可能是疯了所以请使用CloudKit JS
那么它能给你什么呢？
好的 它能给你全面的
公用与私人数据库的存取
它能给你所有的记录操作
它能让你上传和下载资源
它能让你进行查询
它甚至能让你收到订阅和通知
这意味着我的网络应用
能够收到不同步的事件就好像你收到推送
告诉你事情有变
或通知你一些其他事情
所以你无需让用户点击更新按钮
或是退出你的网络应用
它还可以发现用户的数据变化
它有能力解答自定义区中的语义发生了哪些变化
这会为您提供同步的语义
简而言之 它给你的是全面的兼容性
以及在iOS和OS X上运行的
本地CloudKit中的一切能力
正如我之前所说目前CloudKit JS绝对是
开发网络应用的最佳方式
它是JavaScript API
它与本地CloudKit API相匹配
JavaScript与Objective-C语言相配
但你知道我们已经尽力了它是相当接近
因为没有中间服务器
可创建你的JavaScript应用
你可以直接和CloudKit对话 你知道
幕后的CloudKit网络服务
你无需运行你自己的服务器或任何中间服务器
现在要介绍的是如何创建新的备忘录网络应用
这个前几天曾演示过
让Ramiro Calvo帮忙来演示一下
向你演示基于CloudKit JS新的备忘录网络应用
好的 我们先从icloud.com开始
这是我们的跳板
这里已经有一些网络应用了
你会看到一些熟悉的应用有照片和iCloud Drive
这是两个已经存在于
CloudKit上部的应用程序
在iOS 9中 新的备忘录应用也是建立在CloudKit上
所以我们已在CloudKit上创建了一个新的网络应用
在接下来的演示中你会看到它丰富的能力
Ramiro将会点进去
这是它的网络app
你会在这里看到一些主要内容
你会看到图片
你能编辑视频
这里有个复选框
所以这些事情在新的备忘录app中都能实现
它们只是CloudKit的资源和记录
好的现在我们要创建一个全新的备忘录
因为我们正在参加开发者大会
我们也许应该安排一下
在这里参加开发者大会时该做些什么
所以也许我们应该先从其中一件
较为重要的事情开始
我们要确保我们会参加所有的会后派对
让我们把这件事列在单子上
在我们参加完会后派对之后
我们真得访问一下developer.apple.com/cloudkit
看看所有优秀的文稿
包括这个超棒的介绍
在那里你会找到一切
有关CloudKit的信息和文稿
以及最新的CloudKit网络服务
浏览完这些文稿之后我们应该退出
去创建我们的第一个CloudKit网络应用
创建好之后 我们继续下一项
尽最大努力达到免费限额
这可能要花费一段时间
所以我想我们无需核对这一项
但我至少参加了一个派对
所以我们可先核对这一项Ramiro
完成这个网络体验
现在我们去iOS操作系统
这是在iPad上运行新的备忘录应用
我们打开它
你们会看到与我们之前所见一样的厨房改装计划
这是我们在全球开发者大会上刚键入的我们要做的新事情
它会自动显示出来
是同样的数据 对吗
只是我们有一个对接的网站界面
让你把你的本地IOS界面对接上去
现在我们要在这里做一些改动
访问过developer.apple.com
显然已经用备忘录app开发了一款很棒的CloudKit网络app
现在我们何不返回去
看看网络
看看那边发生了什么
如果所有事情都做了
你会发现所有事情都核对过了
这又是我之前提到过的通知体验
出现了通知 推送通知
网络应用将其选取
自动更新 向你显示出变化
这就是在iOS 9和icloud.com上
可用的最新的备忘录网络app
谢谢 Ramiro 
如果你的用户想使用该应用他们需要注册
所以我们直接跳过去看看
你的网络应用上所显示的界面
首先你需要有一个
让用户注册的按钮
这就是你的用户界面
当用户点击该按钮之后会弹出一个新的浏览窗口
该浏览窗口归Apple所有
由Apple管理
这是因为ID和密码
只在Apple和该用户之间交互
开发者永远看不到这个
在后面的登入页面
还会显示其他一些东西
首先是“保持登陆状态”
这样用户可以选择勾选
在未来两周保持登陆状态
“忘记Apple ID或密码？”
如果用户忘记了他们的ID
我们将全力帮助他们
想起密码或重置密码
最后 你知道 如果该用户对Apple生态系统而言是个新用户
他们根本没有Apple ID
他们可当即创建一个Apple ID
他们将得到一个
可以在你的应用中立即使用的Apple账户
CloudKit网络服务提供包括
我刚讲到的仅用于iCloud网络的账户
它会为私人数据库的使用提供1GB的免费存储空间
如果同一位用户访问了iOS或OS X
并在那里设置了他们的账户它会立刻自动更新为
5GB的iCloud账户
公用数据库的使用在iOS OS X和网络上是一样
没有区别 所以在网络上提出请求
和你在手机或Mac上提出请求
是一样的
存储也是一样
在Dashboard上查看使用信息存储区部分时没有任何差别
它都是放在一起的
我们确实需要一款配得上iOS或OS X的应用
这些网络服务的目的是
把超棒的iOS和OS X应用扩展到网络上
它的开发测试版现在可以使用了是和iOS 9一起发布的
这就是CloudKit网络服务的内容
现在我要把Olivier请回来
结束这次讲座 非常感谢
谢谢 Eric
这就是今天的内容
我们非常期待看到你们在CloudKit上
创建出某种应用
迸发出某种惊人的想法
正如Eric所说我们有了一个新的网页：
developer.Apple.com/cloudkit
它汇集了我们拥有的所有数据以及在 CloudKit 方面的
包括在新的服务器 网络API以及在客户端框架方面的
所有文稿 参考库以及示例代码
除了常规的技术支持
论坛和网址以外
如果所有这些都不可用 你可以电邮
cloudkit@apple.com进行一般咨询
本周我们还有两节讲座
第一节在明天 我们将深入探讨
CloudKit JS和网络服务 API
另一节讲座在周四下午4:30分有关CloudKit技巧与窍门讲座
在该讲座中我们将演示最佳实践
介绍一些注意事项
以及我们在iOS 9和OS X El Capitan中
对客户端框架做出的一些改善
本周我们还有一些实验室活动
在周三 周四 周五上午9:00
我们会请来客户端工程师我们会请来服务器端工程师
我保证其中有些人甚至在早上9:00点还没睡
请带着你的问题和想法前来
我们乐于更多地讨论数据
讨论你们头脑中的应用类型
无论用公用数据库还是私人数据库
非常感谢
感谢你们的关注
<br/> 下午好
歡迎來到應用程序擴展最佳實踐
我是索菲婭·多伊徹我是一名工程師
我在UIKit框架團隊
稍後我的同事會加入本屆會議
來自CoreOS的伊恩 拜特
在會議的第一部分
我想談兩個iOS的擴展主要類型
動作和共享的擴展
在稍後的會議上伊恩將加入我們
來談今天的小工具的增強功能
在整個會議期間 我們將告訴您許多現實世界的例子
以幫助您最大限度地
利用這些類型的擴展
現在　應用程序擴展和分享
讓我向您簡單介紹一下這兩種類型的擴展
有何不同
動作擴展都關於不斷變化的內容
而共享擴展都關於移動內容
從當前主機應用程序
到應用程序或Web服務
現在
我要給您舉更多的例子
正如我剛纔提到的
動作擴展作用於當前的內容
正因爲如此它們使用的內容
將作爲主用戶界面
稍後我將展示一個有關它的例子
但您也有機會
在執行該操作之前提出附加選項
此外
您的應用程序功能可以被分開
在不同的動作擴展
存在的容器應用程序中
現在讓我舉一個例子
我們在用Safari瀏覽器我點擊右上方動作件
彈出共享表與兩種類型的擴展
共享擴展在頂部
動作擴展在底部
我們做這個翻譯擴展
當我們點擊它
下面Safari瀏覽器
就會將網頁轉移到該擴展
在那裏它會被翻譯
然後翻譯角會移回Safari瀏覽器原位
下面是同樣的一個變化
當您點擊翻譯您帶了這種形式的表
在這裏用戶可以選擇一種語言
然後當您點擊語言時我們的網頁將傳送到擴展
然後它會再次被翻譯
並搬回到位於Safari中的
這麼多的關於動作的擴展
那麼共享擴展有何不同？
正如我剛纔所說的共享擴展
是所有關於共享的內容從主機應用程序
到您的應用程序或Web服務
正因爲如此這很重要
您所提供的用戶驗證和編輯之前的內容
將移出到您的Web服務
我們爲您提供的是一個API
之後我會告訴您幾個例子
此外您的共享擴展代表您的應用程序
在共享表中爲了防止混亂
我們只允許您把一個共享擴展
包含在一個應用程序裏
現在讓我舉一個共享擴展的例子
我們有底部共享
和頂端共享擴展
現在我們可選擇四種照片而當我們
點擊iCloud照片共享擴展
接下來
我們得到一個小預覽表用戶可以在其中添加評論
可能點擊共享相冊 並在右側出現一個小預覽
但是我們還沒有轉移任何數據
現在如果該信息是正確的用戶可以決定
要麼抵消要麼點擊發布實際執行操作
現在讓我們來仔細看一下在中心的這個表
這實際上是我早先提到的API
這就是所謂的
SLComposeServiceViewController
這是它的外觀平直框
有一個文本框 一個右側的小預覽
然而這是特別爲我們定製的特色服務
例如我們喜歡自定義
使它看起來更像這一點
我們增加了一個佔位符我們甚至還添加了
一個字符餘留屬性
我們甚至改變預覽視圖
在底部我們有一些選擇
現在讓我們通過一些例子來構建
首先
要設置一個佔位符在該表上設置佔位屬性
開始了
而您的Web服務可能有一個最大字符限制
所以我們有一個小指示燈在左下角
要更新它只需設置一個屬性
再次我們爲您提供了d一個預覽視圖框
但您可以有您自己的一個
爲了支持簡單的構成控制器
並重寫裝入預覽視圖
然後返回您自定義視圖控制器的預覽
但有一點要記住
請確保該視圖有
否則可能無法在紙張上顯示出來
現在這些選項在底部
這些僅僅是單元格一個值在左邊
一個值在右邊點擊他們
我們通過一個選項視圖控制器
可以選擇您的選項您的自定義選項
讓我來告訴您如何設置它的代碼
很簡單
子類SL - 構成
然後重寫 - 方法
每一行表示爲一個SL構成表配置項目
（太拗口了）
左邊是標題
右手邊是值
現在如果用戶點擊一個單元格我們在這裏調用點擊處理
而且您應該
創建自定義視圖控制器
爲您的自定義選項
而推動它只需調用推送配置視圖控制器就可以
這種工作方式與API相同
即您的導航控制器
然後最後返回項目區域
現在我們甚至能爲您提供自動完成支持
在構成表上
要自動完成
您可以設置一個視圖控制器
在這裏更新按鈕部分
在這種情況下它是一個表視圖我們自動填充名稱
但它可能是真的什麼
要設置它只需設置自動完成視圖屬性就可以
我們爲您做所有動畫
當您做完自動完成
您將其設置回零
一切都非常簡單
再次
我們的
SLComposeServiceViewController
提供了一致和熟悉的用戶界面
這是完全可自定義的您可以在應用程序採用它
但是如果您有不同的需求
爲您服務擴展
您可以隨時通過您的視圖
直接返回
現在
我只是告訴您如何讓動作共享擴展
那麼讓我們改變齒輪一點點
並討論
如何支持別人做擴展
在主機應用程序裏
舉例來說假設我們做了一個文本編輯應用程序
我們想與大家分享文本文檔
以及純文本
然而某些擴展可能不理解文字
他們可能只支持PDF文件
或者其他的擴展可能只支持HTML
現在您想支持儘可能多的擴展
所以好方法是提供所有這三個文件類型
但是您知道
這三個都不是真正的獨立的文件
當您共享一個文本文檔時
您真正擁有的是一個單一的文件
它支持不同的文件格式
而正因此我們有一個叫做
NSItemProvider的API
簡單來說
NSItemProvider是單個條目
有多種表示方法
讓我告訴您一個代碼示例來更好地解釋它
現在我們創建NSItemProvider
調用註冊項目類型標識符
來添加新的表示
到該項目提供者
在這種情況下它是純文本
現在如果擴展請求採用純文本表示
該系統將在這裏調用這種裝載處理程序塊
還有您應該動態創建文本文檔
並調用完成處理程序
來將數據返回到擴展
PDF格式同樣
只要擴展要求一個PDF 
表示我們調用加載處理程序您在動態創建PDF
並調用完成讓其將數據
返回到該擴展
要顯示共享表
簡單地創建一個UI活動視圖控制器
並提供了初始的項目來提供程序選項
現在
您看到的是構成表中的第一個例子
我們在右上角有這個小預覽
該主機應該也提供預覽
這些預覽代表着什麼將被共享 
而且它們需要被簡單而有效的創建
它們不能過大
對於這點
我們有一個NSItemProvider API也是如此
這就是所謂的預覽圖像處理程序
並且一旦擴展要求一個預覽
我們調用這個塊在這裏
您應該創建縮略圖或預覽
表示爲動態的圖像
並調用完成處理程序
來返回數據
現在我們需要再次改變我們的觀點
我們首先談到了實現擴展
然後我們談到了支持擴展爲主機應用程序
現在讓我們來看看
再次成爲擴展開發是什麼感覺以及
如何聲明您的支持用哪種數據
主機應用程序可以提供給您的擴展
例如
也許您想擁有完整的共享服務
並要聲明您共享擴展
支持圖像和視頻
現在
在這種情況下讓我們做三種擴展名
一個擴展支持圖像
另一個支持處理電影
而第三個處理圖像和短片
現在讓我們看看會發生什麼
如果主機應用程序共享單一的圖像
在這種情況下 
第一和第三種擴展將出現在共享表
現在相同的方式在處理電影的情況下
如果主機應用程序
共享一個電影
第二和第三種擴展將出現在共享表這是有道理的
但是
如果主機的共享
支持圖像和電影會發生什麼？
您可能會認爲所有的擴展將出現在工作表中
然而
目前的情況並非如此
因爲在iOS 8中的實現需要
擴展可以處理所有兩種類型的文件格式
有一點可惜
因爲用戶擴展開發人員可能會想支持儘可能多的擴展
而要做到這一點您應該
提供儘可能多的意見及其可能帶來的結果
但是在這種情況下
您實際上會得到比剛纔的共享
更少的擴展只能單一表示
比如電影或圖像
所以我們在iOS 9中添加了新的功能
您也可以選擇通過添加NSExtension 
激活詞典版
把新的擴展名信息info和plistu
設置爲兩個之後
您的擴展就會出現即使
主機應用程序共享圖像和電影
即使您只關心電影或圖像
如今 這些都是高一級的激活規則
但是我們也支持激活只有謂詞的規則
再次謂詞可以是非常簡單的
但也非常強大的 像這裏這個一樣
我就不贅述了現在
我們可以參考應用程序擴展開發者指南
去了解更多信息
接下來我們來談一談圖標擴展
正如我前面提到的
分享擴展代表您的應用程序
它是一個共享表中的Web服務
因此 我們只需使用您的應用程序圖標
或在共享表中的
包含應用程序圖標的其他圖標
所以不需要做額外的工作
對您來說
動作擴展相反地需要模板圖像
我們需要兩個尺寸
一個用於iPad一個用於iPhone
它們被存儲在擴展套件裏
現在 我來介紹一下模板是如何工作的
比如把它想像成一個模版
模板的圖像是黑白的代表
具有透明的背景然後
系統把那模板與那黑與白的圖像
一起來創建實際的圖標用於共享表
再次
需要兩種尺寸
60點的iPhone
和76點的iPad
不過我建議您在您的擴展中使用圖像資源
並提供各種不同 - 所有不同的圖標大小
這將用於應用程序圖標
這樣您的應用程序擴展將更適應未來的需要
這麼多動作能共享擴展
讓我們邀請伊恩上臺說說
今天小插件的增強功能
謝謝索菲婭
您好我是伊恩·拜特CoreOS工程師
現在我準備向您介紹今天小插件的增強功能
首先快速回顧一下
您還記得去年
今天小插件讓您對快捷信息一目瞭然
所以有了您的股票價格和您的體育成績
它會告訴您下班後您需要花多久
才能到家
所以今天我要和您談談
如何提高您今天小插件
如何確保該模型的數據
始終是最新的並同步到
您包含的應用程序
我還要給大家介紹一下如何確保
您的視覺表現是最新的
並也反映了您的小插件的內容
然後我會介紹一些通用的最佳做法
您可以用於您所有的擴展
包括您的今天小插件
讓我們開始吧
這是Notification Center的景色
它填充的是今天小插件
您可以通過滾動看到所有的小部件
如果您想了解更多信息
您可以在這裏看到
您可以簡單地
在部件上點擊
它會帶您到達應用程序瞭解更多信息
現在 我們應該如何促進
今天小插件及其所包含的應用程序之間的這種互動
我們可以使用URL schemes
現在我要告訴您一點點關於這些交互使用
這些URL方案
和一些開放URLAPI NSExtension環境
可以帶用戶進入應用程序
現在我們有一些很好的做法想與你們分享
是關於控制這些URL schemes的
首先我們非常希望您能使用
並且專注於您App的註冊URL schemes上
太棒了
接下來您要使用的是
您可以使用系統URL schemes
例如HTTPS
那麼接下來就會在Safari上打開一個網頁
您也可以寫信息、打電話
或進行其他交互並且在系統組件中
開始進行有趣的工作流
那麼接下來告訴您應該怎樣做
您可以注意到我正在展示一個表格
我選擇了一排索引路徑回調
因爲許多小部件只是簡單的表格
我們要做的第一件事
實際上是構建一個URL
我們接下來用我的AppURL scheme來做這件事
只是用來舉例
這將會把我們帶到我的主體App裏
接下來我們想要做的事是
調用開放的URL API
這個您可以在擴展內容中找到
它可能與您的視力控制器相連
現在這跟在UI應用上的曝光有些不同
在UI應用中
它需要一個調回版塊
但是這個調回版塊有一個布爾參數
我接下來就講講這個布爾參數
需要將成功參數設爲是
如果我們要把你們帶進我的主體App
或者進入
已經註冊了URL scheme的系統組件
如果我們不能夠做到它將被設置爲否
就像用戶還沒有解鎖電話
和當電話還被鎖住的時候下拉
Notification Center
有很多辦法
可以跟容器應用互動和分享數據
今天我想講述
如何使用默認值
和您的容器應用
或Keychain項目
和框架數據
框架數據將潦草地進入共享容器
系統框架會以您的名義
把所有這些整齊地分成應用程序組
首先用戶默認
您可能知道用戶默認是什麼
如果您曾經開發過一段Cocoa或Cocoa Touch
那裏有多個很小的設置數據
它們像小的字符串、數字、布爾值和其他
它們影響您應用程序的設置
您可以分享這些設置數據
在您的容器應用程序
和您的擴展之間
通過使用NSUser默認初始值的
套件名稱的API
您將傳遞應用組的標識符去完成這個API
現在記住這件重要的事情
這個API不僅僅解鎖您容器應用的默認值
即您的標準用戶在您應用裏的默認值
它還產生一個新的默認套件
您的容器應用也能有其訪問權限
如果它也參與到應用組的話所以這個非常重要
當您用這個API時不但在您的擴展裏
而且在您的容器應用裏
當您想要改變這些設置項目的默認值時
我想講述的下一件事情是
您能用到共享容器的內部
當容器應用和它的擴展都有其訪問權限時
第一是您能保持的是模型數據
模型數據是比如SQLite文檔 
甚至可能模型對象想要
持久地將核心數據持久保存爲預設文檔
您可以把所有這些保存在共享的容器裏
您的容器應用和它的擴展
都有訪問權限
您可以在那裏存入文件
剛剛索菲婭講述了一個文字處理應用
可能這個文字處理應用應該把它的文字文件
保存這個共享的容器裏在那裏
擴展能修改它們
接下來
您也能存您想存的媒體項目
例如圖像、
錄影片段、
音頻文檔
和其他
它們有訪問您的容器應用
和它的擴展的權限
現在如果您把可以緩存的項目
緩存在共享的容器裏可能不太好
我想您更願意緩存在一個可以清除的地方
當您程序的運行空間變得很低的時候
現在來設置核心數據以使用共享的容器
我想給您演示一個小的樣本代碼
您可以把它應用於容器應用
和它的任何擴展
您可以簡單地通過模板
修改Xcode已經爲您產生的代碼
因此您要做的第一件事是建立一個新的屬性
或者改變一個現有的屬性
在這種情況下 我們叫它
安全應用組展示存儲URL
當然首先要做的是
拿到一個NS文檔管理員的實例
然後作爲文檔管理員 我們將調用
容器URL對於安全應用組的標識符然後再一次傳遞
我們之前已經設置好的應用組標識符
在這之後 
我們將把存儲文件名字附加到URL
那個URL指向共享的容器
容器應用程序和擴展程序都可以訪問它
現在我們需要用到這個存儲URL 因此
我們要設置我們的永久存儲協調員
我們要用這些
首先產生一個存儲協調員
用我們的管理對象模型
然後我們將拿到
我們剛剛建立的那個存儲URL的實例
最後我們將這個永久存儲
加入到存儲協調員中用我們剛剛產生的URL
這將指向
後臺支持這個的SQLite 文檔
在共享的容器裏
然後我們把它返回給調用者
最後我們實際想要設置管理對象語境
我們通過拿到永久存儲的協調員
產生一個管理對象語境
然後我們將設置這個協調員
成爲管理
對象語境的存儲協調員
然後返回它
這就是所有您需要做的在您的容器應用和任何一個它的擴展裏
設置核心數據
來使用共享的永久存儲
在共享的容器裏
因此核心數據有可能不是您的應用程序需要的
假設您正在用剛纔提到的預設文檔
來把您的模型對象
序列化到共享容器
在這一點上
您要考慮同步和訪問權限這些事情
在共享容器裏因爲
潛在的您的擴展和您的應用
會企圖同時改變這些文檔
這對數據一致性不是件好事
所以
您實際上不得不使用排它鎖
您需要真的特別小心地
在共享容器裏的數據使用排它鎖
因爲一個擴展被清除和並被當天暫停的同時
擁有一個排它鎖
對數據的一致性不是個好事情
那麼您需要怎麼做呢？
嗯關於任務斷言
我最好多講一些
任務斷言是您的擴展統治操作系統的
非常好的方式嘿
我正在做一些事情
您最好不要打擾
如果您想要中斷它
我喜歡拿某種回調函數
首先我能清理乾淨
記住擴展被暫停是非常具有侵略性的
當它們不再被應用
當用戶下拉進入
Notification Center
然後上拉來取消
我們可以在那時暫停所有正在運行的擴展
所以那樣可能需要非常快速
您要快速地
保護序列化和另一個清理任務
用這些後臺斷言
我會演示給您看如何去做
它用NSProcess 信息API
您要做的第一件事是
拿到NAPRocess 信息實例
通過調用進程信息工廠的方法
接下來您將調用API
去調用一個結束的活動
我將向您介紹如何設置此呼叫
第一個變量
您將通過這個方法得到
它是非常短的字符串
這個短字符串
是爲您
而不是爲操作系統的
它告訴您
要在被保護的任務內部做什麼
下一件事是
通過這個API得到一個回調函數
回調函數能在兩種方式之一中使用
我將和您走過第一種
第一它將被調用
如果我能以您的名義斷言得到一個後臺任務
並把過期設定爲否
這意味着它對您是安全的
可以去執行一些序列化任務數據的
您不想被打斷的任務
既然任務斷言不能無限制地被拿到
當任務斷言快要過期的時候
它的頂峯就過去了
操作系統會再一次調用您的回調函數
這一次將過期設定爲是
這意味着您需要取消
無論什麼任務
並準備被暫停
現在
當您退出版塊時
我們將爲您釋放任務斷言
您不需要做任何事
還有第二種可以工作的方式就是
我們完全不能爲您獲得任務斷言
在這種情況下
我們將會立即調用您的版塊
把它的過期設爲是
您可能不希望使用排它鎖
在這個點上在分享容器中
因爲如果您被暫停了就沒有保護您的東西了
這樣一來
您將會被清理
並做好暫停的準備
您只有幾秒鐘的時間
來決定是否徹底清理
因此
那是一個複雜的話題
但是我認爲有三件事
您需要搞明白通過今天講的關於任務斷言的內容
第一是它們會被釋放
當您的代碼退出調用時
一開始我們就執行一個任務斷言如果一切順利的話
我們把過期設爲否然後
我們會爲您保持這個任務斷言
直到您的代碼退出版塊範圍
第二個需要記住的是
您有可能需要
重新進入並執行您的調用
來通知您關於過期的信息
再次我們可以再一次調用您的版塊
將其過期設爲是來給您一個提醒
這個任務斷言將要過期
您應該去清理
最後
您的擴展並不總是可以進行任務斷言
有時您調用之後 
過期會立即被設成是您調用的版塊將會按那種方式運行
而且您沒有機會去執行一些關鍵操作
您需要做好準備去處理這些情況
因爲它們確實會發生
接下來
這些任務斷言
僅僅保護版塊範圍內的代碼
因此它們一般被用於簡單的事情
例如快速序列化
和一些同步的內容
如果您需要與另一個工作序列協同
您該怎麼做？
因爲您知道任務斷言
是在那個調用版塊範圍內的
那麼調用版塊
必須與其他序列中受保護的工作同步
例如
如果在主線程中
您想保護一些東西那麼您需要確定
調用版塊沒有退出原始保護範圍
在這個工作完成之前
這裏我用一個例子展示如何
在板塊中通過調用異步到主線程上
執行將會從版塊中退出
很可能在進行之前暫停就會生效
完成
太糟糕了
因此在這種情況下您的版塊
需要通過發送同步或信號
或者無論哪個您在隊列裏選擇的方法
來記住在您分配去另一個隊列裏時
它是工作的
它不是必須爲主隊列需要被取消
因爲我們可能會同時賦值過期變量來回調您的模塊
在這種時候
您需要清理您正在做的事情跳出回到程序模塊 
退出釋放斷言任務
實際上您這樣做是安全的
因爲這個回調函數
正在私有系統隊列裏執行
您不會產生死鎖定
因爲我們不會往那裏回調
現在這已經很多了
我明白
從這裏繼續
在我們新的多任務的世界裏
我們現在碰到很多情況
在您的擴展和包含的應用程序
同時執行的時候
這意味着
如果什麼事情在您所包含的應用程序裏發生
這件事改變了您數據模型的狀態
潛在的是您的擴展可能就
不會和模型的狀態同步了這是不好的
因此有一種您可以用來保持
每個人在同一個狀態的途徑
就是進化Notificationcenter
API和
NSNotificationCenter非常相像
但它更加簡單
它適用的用例數量更小
對於您的包含的應用和它的擴展來說
例如今天
我們將向您展示
如何用它去暗示您的擴展
去重新加載模型
以下是您要如何去做
第一在那個包含的應用裏面
您要取得
一個進化
Notification Center 的實例
您將調用CF
NotificationCenter
拿到進化 notify Center
然後您將傳遞這個通知的實例
給CFNotificationCenter發佈通知
下一件您要做的事是挑揀出一個字符串
這個字符串將用來代表您的通知
您會在您包含的應用裏
用它和任何一個擴展去觀察這個通知
然後您要傳遞是
在您的擴展裏
您將再一次用它去得到一個
進化Notification Center 的實例
您將把這個
傳遞給
CFNotificationCenter的觀察者
這個準許您去觀察這個通知
下一件您想做的事
是傳遞一個回調模塊
這是回調模塊正在被執行的樣子
當系統注意到
這個通知被髮送了
您想要傳遞那個短字串
最後立刻交付
這能確定所有事情都始終保持最新
並讓您的擴展內部的模型重新加載
在包含的應用傳遞這個暗示的時候
現在記得我叫它暗示因此您可能
不想用這個去協調
您的擴展和您包含的應用之間的鎖
因爲它不總是保證
您的擴展
能收到這些通知
這就是如何保持您的模型始終最新
如何保持
您的小工具的視覺展示最新？
下一步我將告訴您
我要用的這個叫做後臺刷新
後臺刷新是一個系統
它和您的小工具一起工作來保持它最新的途徑
去保持視覺展示的最新狀態
再一次
我們回到NotificationCenter
在這裏您能看到我們的股票小工具
股票小工具顯示的是最新的股價
在一天裏蘋果的股票變化了會發生什麼呢？
嗯這個通知
可能將被髮射到您的手機同時包含的應用程序
可能被希望做一些事情
您的小工具視覺上的表現
可能改換
不幸的是
我們會注意到
小工具現在和股價不一致了
它顯示$130.12
而實際應該是$132.12
我們如何修補呢？
我們如何確定我們的視覺展示
總是最新的呢？
嗯對初學者 
系統將隨機地刷新這個內容
它將和小工具對話
去看看是否需要更新
而不必去下拉
Notification Center
每一個今天小工具的視圖控制器都符合
NC 小工具的提供
如果小工具的視圖控制器
實現了授權方法更新
它將參與到這個系統裏來
現在我將向您展示如何來完成
我們要做的第一件事
是在我們的今天小工具視圖控制器加小工具
來處理程序執行更新
以符合NC小工具的提供
第一步我們將刷新模型
這能爲我們做一件事
一件非常重要的事
它會告訴我們模型裏是否有變化
而這個變化
將實質影響小工具的視覺展示
如果有變化
我們會告訴視圖階層
它需要重新畫圖
最後我們在裏面
會拿到傳遞給我們的完成處理程序
如果有視覺上的變化
我們就會傳遞新的數據
如果沒有實質性的變化
影響到我們小工具的視覺展示
那麼沒有數據將被傳遞
這會讓我們的小工具在
Notification Center 裏
是一個好公民
因爲在這一點上我們暗示操作系統
它不需要擴展任何資源
去更新我們的今天小工具的
視覺展示
既然我們已經做了這個我們的小工具已經被更新了
您會注意到股價是正確的
下一個
網絡擴展是短暫的目標
是真正的短暫的過程
它們來來去去
記住我談的是用戶下拉
然後迅速地向上劃回
這對於一些花時間的事可能是場浩劫
例如網絡會話
小工具可能會調用雲服務
還有一些網上其他事情以便進行處理數據
那麼我們如何處理這種情況呢？
嗯我建議您
嘗試用NSURLsession
後臺會話
這些是什麼？
這些是任務被執行的網絡任務
是以您的名義被系統執行的
更新和事件會被快遞到您的擴展
只要它還保持活躍
但是如果您的擴展被暫停或清除了
或因爲什麼原因電話被掛掉了
用這個關鍵系統
或這個系統的部件包含的應用
來接管錯誤和處理事件以它的名義
我將展示如何在您的擴展裏設置
首先
您要創建
一個NSURLSession配置後臺會話
用標識符目標配置
哦對不起用方法
再一次跟隨模式
您要創建一個標識符
它會被正在參與這個後臺會話的
擴展應用和包含應用使用到
像我們這種情況我們在用
com.example.my 下載會話
下一件事
您要在會話的配置中
建立一個分享的容器標識符
不然的話您將有很大
您的所有會話都可能在我們調試的時候因爲不合法而被退回
如果您是剛開始一個任務
至少我知道我就做過這樣的事
下一步
您要創建一個NSURLSession
傳遞這個會話的配置
到初始器
現在您注意到我們正在和初始器用同一個授權表格
因爲完成處理程序形式的初始器
和後臺URL會話一起用
是不合法的
下一步爲了舉例
我們要下載Apple.com 網站
我們要產生一個任務並且消費它
現在我們的擴展
已經成功在後臺創建了一個NSURLSession
並交給了系統
系統將用開始快遞事件去擴展
下一步在我們的包含應用中正如我以前講的
我們需要準備它對任何情況
例如擴展被暫停或清除了
或被掛斷而不能處理
從系統和網絡部件發來的事件
我們用加入應用程序對我們的UI應用授權
來處理後臺URL會話事件的方法來做
第一步我要做的
舉例來說
是確認一個標識符
就是一個我們期待的標識符
系統將導入和NSURLSession
有關聯的標識符
對於您處理的應用授權事件
就像和擴展一樣
我們將設置一個NSURLSession 配置項目
通過調用後臺會話配置
和標識符工廠的方法
我們需要再次設置分享容器標識符
然後我們需要調用NSURLSession
傳遞這個分享的配置 
然後再次用授權形式的初始器
最後非常重要的
如果您不仔細看就會錯過的
是我們將保存這個完成出來程式
我們將把它保存回我們的屬性裏
當我們完成的時候
當我們處理關於這個URL會話事件的時候
您也許會問
您如何知道什麼時候事件處理完成了呢好我來演示給您看
在我們的NSURLSession授權裏我們需要用這個方法
URL會話的確會完成後臺URL會話事件
它將被調用到您的容器應用程序
或者在這個情況下
您的容器應用程序
會任命它去管理這些事件去解決所有的URL會話事件
從後臺URL會話裏
我們要做的第一件事
是拿到這個配置對象
然後我們將確認
會話配置的標識符
是否匹配我們期待的標識符
然後我們將調用完成處理程式
就是我們早前保存的
併發行我們對會話的引用
這時我們完成了
我們成功地處理了
到我們的容器應用程式的任何事件
從我們先前到擴展開始的系統組件
現在您能用這個技術
應對任何一種擴展類型不只是今天小工具
這真是個偉大的技術
但是有一個地方您不能用
那是對您的Watch OS 1 擴展
作爲代替
我們建議您用後臺任務斷言
去保護這些小的任務您可以發現
更多關於WatchKit的技巧和竅門
明天早上10點在Presidio
由夾克 貝倫斯主講
接下來在您網絡交易時
您會不可避免地要挑戰您的憑證
如何能安全可靠地保護您用戶的隱私
從而祕密地分享這些信息
在您的容器應用程序和擴展中
我們建議您用Keychain訪問組對於這個
就像這裏演示的
您在您的擴展
和您的容器應用程序中設置
然後用這個您設置的標識符
就是您在您的容器應用程式中和它的擴展中設置的
您簡單地傳遞這個標識符作爲一個值
無論什麼時候您在Keychain里加一個項目就可以
就像這裏演示的一樣
下一件事
告訴您這裏有一個自動查詢行爲
對採用Keychain API的詢問API
因此可靠項目的更新
可靠項目的刪減
可靠項目的複製都自動做了正確的事情
就是通過尋找每一個關於您的Keychain
因此您不用傳遞Keychain 訪問組標識符
到這些API裏這就是個需要記住的技巧
您可以發現更多關於這些API的內容
通過觀看安全錄像和您的應用程式的錄像
總結一下今天索菲婭講述了所有關於
動作和分享的擴展
關於它們意味着什麼
和如何才能更好地利用它們去分享數據
與您的應用程序和網絡
她也演示瞭如何把NS項目提供器
使用到它的最大可能
這是她爲您分享數據類型而努力的工作
她也演示了如何讓您的主程序擁有偉大的環境
對動作和分享擴展來說您知道嗎
這將提升您主程序的價值
然後我演示瞭如何加強您的今天小工具
通過確定您的模板和它的視覺展示
總是保持到最新狀態
然後我們演示了一些
最佳的實踐比如如何安全地分享祕密
和保護您客戶的隱私
那裏有一些相關的講座我早些時候引用的
Watchkit的技巧和安全
以及您的應用程序
明天您能瀏覽關於更多的信息 
我建議您去讀App延伸項目導航或者
去和我們的宣傳員科特 羅斯特交談
謝謝
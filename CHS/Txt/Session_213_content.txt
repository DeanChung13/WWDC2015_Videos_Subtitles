构建App跟Researchkit
大家好！
我叫约翰·厄尔
是ResearchKit团队的一名工程师
今天我要讲讲ResearchKit
以及如何促进App研究
今天 我的谈话内容由四个部分构成
首先要讲讲什么是ResearchKit
然后再谈几个问题
几个影响App型研究设计的相关问题
虽然我的主旨是在阐述如何使用
ResearchKit构建App时
ResearchKit在研究App的具体功能
最后 由于它是一个开放源码项目
我要讲讲大家该如何促成ResearchKit
那我们就开始吧！
什么是ResearchKit？
简而言之它是一个开放源码工程
可以在GitHub上使用
但是如果延伸一下
我们首先需要了解一点动机
即使您以前从未参与过医学研究工作
但是类似工作您可能已经见过
无论是在大学还是在医院
如果您已经参与了一项研究工作
您可能会打电话和调查员碰头
别人给您解释具体工作及其风险和效益
然后您可能要回答问题采集样本比以往更频繁
现在 这可是一个重量级模型
研究人员已经告诉我们它有三个问题
第一个问题是有限参与
在大学校园内贴传单只是将人员参与
局限在校园附近的居民
进行海量研究则需要很多研究团队开展合作
这就意味着 如果开展研究频率也不会太高
第二个问题是数据较主观也不常见
经常是通过调查每月收集一次数据
或者周期更长
这就影响了提出的问题
限制了数据质量
第三个问题是单向通信
您曾经参与的研究工作具体结果您可能从未听说过除非您认识调查员
这就是我们认为App带来的好处
App Store经销模式辐射范围很广
可以帮助研究人员接触更多研究对象
因此采用ResearchKit的前五种研究App
注册参与者超过70,000人在他们的研究领域中
已经开展了很多研究项目这也是规模最大的一个
第二 App的数据可以持续流动
这与主观不常见的人工收集数据形成鲜明对比
最后 App可以局部记录
每个参与者的情况以便向他们反馈
在症状管理方面的具体表现
并有助于保持他们的参与度
而且也不会增加调查人员的工作量
在Apple我们以前希望为更多研究项目
让这一点成为现实这就是构建ResearchKit的原因
ResearchKit是一种开放源码框架
可以在GitHub上使用
使用它 创建研究App更容易
无论是商用App
还是纳入学术研究
现在iOS有了很棒的API
可以用来收集被动数据信息
比如HealthKit和CoreMotion
但是要成功开展App研究
还有很多方面需要了解
我们希望在这些方面，ResearchKit对您有所帮助
现在ResearchKit有三个模块
第一个模块是调查
ResearchKit提供标准UI模板
可以用来调查iPhone或iPad
我们采用了最常见的健康研究测量工具
对它进行了测试比如SF12或EQ5D
第二个模块是知情同意
在人体观察研究领域它是一项常规要求
为了让参与者充分了解研究细节
并在此情况下获得参与者的同意
每项研究工作的细节都存在差异
因此ResearchKit会提供模板
在App过程中可以用来展示这种差异
ResearchKit的第三个模块是现时任务
现时任务是一种半控测试项目
在此项目中参与者按步骤接受指令
通过装置上的传感器收集数据时
即可执行该任务
例如在这种步态与平衡任务中
我们在来回步行过程中将手机放入口袋
通过加速仪和陀罗仪可以收集步态评估数据
因此我们了解了ResearchKit三个方面
调查知情同意和现时任务
在发布ResearchKit同时
与我们合作的调查人员向AppStore 提供了他们自己的App
即使现在我们也在使用这些Apps收集疾病相关数据
非常广泛比如帕金森病、糖尿病、
心血管疾病、哮喘和乳腺癌
我们已与上述合作机构共同为这些App
以及这些机构
共享的核心共用库开放了源代码
因此如果需要快速启动它就能帮助您开始App
那么App究竟具备哪些功能呢？
在适应阶段它们都采用了
ResearchKit的知情同意模块
但是之后一旦注册参与者
它们会以几种方式采集数据
首先它们采用ResearchKit的
调查模块和现时任务模块通过排程活动
采集更多主观测量结果
此外它们采用HealthKit和CoreMotion
通过被动数据采集获得了客观度量值
而且 通过加入一份仪表盘标签
解决了单向通信问题
因此参与人员可以查看和跟踪
源自调查结果的两种主观量度值
比如情绪以及源自HealthKit的
客观度量值如重量参数
因此正是ResearchKit和App在使用它
但是随着ResearchKit的开发
我们对构建App型研究项目过程中
涉及的其它方面有了更好的了解
当时我们认为这些对共享至关重要
因此在这里我愿意和大家一起分享我的一些心得
如果您是一名构建研究App项目的工程师
可能在项目团队中并不只有您一人
还有很多事情需要其他成员去完成
这里我可以就此作一些简单介绍
也许最重要的就是联系与您所在单位有关的道德委员会
或机构评审委员会
以便就研究方案
通过某种形式的道德评审
为此您需要决定向该参与者
通报研究情况究竟会意味着什么
您会采用这种纸质形式
并且希望您能够对它进行压缩
最终适合移动App需要
在我们进入ResearchKit知情同意模块时
我们会详细阐述
接下来 由于ResearchKit不提供后台服务
您需要计划如何保持研究数据
因此可能需要您本人去调查
或与第三方服务提供商签订合同
任何一种方式您都需要为数据安全和保密承担责任
最后您还需要策划如何共享研究数据
参与人员可能需要采用仪表盘标签
或其它方式而调查人员则
可能要求您去寻求各方知情同意
因此如您所见实际App架构之外
还有各种各样的问题
它们将对研究型App设计产生一定影响
更多相关资源
请登录我们的网站ResearchKit.org
并且还可参阅
我们的ResearchKit用户邮寄清单
通过上述网站和清单
可以接触之前也顺利完成任务的其他研究者
因此无需道别
接下来让我们谈谈使用ResearchKit构建App
在研究过程中ResearchKit究竟能够发挥什么作用？
如上所述ResearchKit有三个模块
调查模块知情同意模块
和现时任务模块
ResearchKit所有这些模块的
运行模式大致相同
要求用户执行的每项活动
被确定为一项任务
每项任务可以包含一个或几个步骤
为了执行一项任务您希望就此向用户展示
为此将使用任务视图控制器
一个任务视图控制器就是一个容器视图控制器
有点像导航控制器或标签条控制器这在UI工具箱您可能比较熟悉
在展示任务视图控制器时
将进入该任务的第一步
然后在任务视图控制器内显示它是一个视图控制器
可以显示该步骤的数据
这一步结束时任务视图控制器将
采集它输出的结果并对该任务所有步骤
输出的数据进行核对
最后当任务完成时任务视图控制器将通知委托代表
您也会了解任务结果
关于已经通过的步骤该任务结果将有一个相应步骤结果
如果超过一个步骤
相应会有若干步骤结果
这就是ResearchKit内的对象模型
现在我们深入了解一下其中一个核心对象
也就是上述步骤
下面我们看看各个步骤
在ResearchKit内一个步骤实际对应的
是一项ResearchKit任务中
用于每个页面的基本模板
并且子类是一种步骤
刚好是一个抽象基类对于ResearchKit不同模块
需要的每个不同步骤而言
可以用于每个不同类型
如调查
因此您可能会收到一项指令一个调查问题和调查问卷
或者对于其它而言如现时任务需要倒计时器
对于认知型任务可能需要玩记忆游戏
因此一般情况下这个基本模板
会在页面中央展示该步骤内容
为此已有预定义要素下面我们会谈及
此外一般还包括向前导航控制器
在步骤视图控制器内显示
从代码来看它的效果如何呢？
将ORKStep作为抽象基类
并且它是该对象内的一个子类
因此我要说说使用Objective-C
撰写这个框架文件但从Swift完全可以使用
并且我们还在此基础上增加了为空性和泛型
因此它可以和Swift 2一起使用
那么基类
有哪些重要特征呢？
第一项特征也是最关键特征即标识符
这是您作为开发人员需要提供的一串字符
它可能是人工可读字符串也可能是UUID
或者与本步骤某项记录
以及数据库中相应任务对应的标识符
该标识符的重要性在于
它将该步骤与相应步骤结果连在一起
并且在您的任务语境中必须是唯一标识符
接下来所有步骤都有一个标题和文本
并且一般来说它们都适合每个步骤模板中的
同一对应位置
如果您正在写一个问题例如针对调查中的一个问题步骤
一般来说您会设置一个短标题
并且这个实际问题本身会对文本特征进行核实
还有一项特征需要说明一下那就是备选性质
因此调查和ResearchKit中的每个步骤
或者很多其它步骤可能都属于备选性质
实际上它们默认为备选性质
如果需要关闭它比如因为需要提供特定答案
您就可以利用这种特征
那就是所谓的步骤但是为了使用一项步骤
需要将它放入任务文本
现在ResearchKit中的任务还没有一种抽象基类
相反它只是一份协议
定义了任务视图控制器与每项任务的互动方式
仍然有一项关键特征即识别符
与在本App中可能收集的其它任务结果相比
它是该任务结果的唯一识别方式
接下来虽然任务视图控制器需要
了解该任务中下一步骤的具体内容
为此我们根据步骤协议方法对该步骤进行了定义
其中我们从任务视图控制器通过了当前步骤
通常情况下您刚好回到下一步骤
但有时您想了解...
您想根据现有结果决定采用哪种测试方案...
需要展示哪一步
例如如果我选了A您希望进入A步
如果我选了B您希望进入B步
为此任务视图控制器将通过该任务一项结果
您可以用来做出上述决定的现有任务结果
在寻找该任务的第一个步骤时
任务视图控制器将通过零作为当前步骤
并且该任务完成时
告知任务视图控制器没有其它后续步骤
就此已经没有能够让您归零的其它步骤了
同样任务视图控制器
可能会询问您的任务：之前应该有哪些步骤
因此通过方法前步骤您可以采取一些措施
比如防止后向导航
因此关于任务协议
有多种其它特征和方法
执行一项任务可能比较复杂
因此ResearchKit包括ORKTask的执行
它是单纯情况下的ORKOrder任务
其中您希望采用连续顺序展示您的各种步骤
因此在这里您通过一个标识符和一个步骤阵列
即可让这些步骤从只读特征返回
但是任务视图控制器
只是通过ORKtask协议与它的预订任务互动
因此您可以按步骤呼叫而不是对该步骤特征进行评估
现在如果您需要条件逻辑
还有一种预订任务版本是它的一个子类
称为ORKNavigable预订任务
通过它可以明确结果相关述语
以及相应终点步骤
这是最近通过外部促成方在该框架基础上
增加的内容今天我没有时间谈论它
但是您有机会了解GitHub相关细节
任务就谈到这里
但是执行一项任务需要使用任务视图控制器来展示这项任务
下面让我们看一看任务视图控制器
您将启动一项任务
并且需要经由此项任务创建一个任务视图控制器
但是您会注意到第二项特征任务运行UUID
这就是UUID
它是该任务此次特定运行的唯一识别方式
因此如果这里我们通过零
表明这是一个新任务实例
我们从零开始
但是如果我保存工作成果假设调查时间很长
假设我希望中途暂停那么我可能保存
在新任务视图控制器中确定日程
重新启动这项任务时我们一定会希望恢复以前的工作运行UUID
因为它与任务运行确实相同
然后您需要设立代表
如果希望了解何时完成任务
可以召回代表
但是同样也会召回代表
这样就有机会
对任务视图控制器行为进行定制
例如针对特定步骤使用新步骤视图控制器
代替默认步骤
此外有些任务可能会输出信息
一种文件输出
例如如果在执行任务时使用麦克风收集音频数据
那么我们会希望在执行任务过程中
将该数据写入音频文件
在ResearchKit中为了给予支持
您会给来自该任务的文件输出
应该进入您的任务视图控制器
指定一个输出目录
任务完成时您需要处理这些文件
然后负责清理
最后通过程序展示任务视图控制器并获得类似信息
因此您所看到的这种任务视图控制器
它的行为相当标准
并且任务视图控制器本身
只能控制数量很少的视窗不动产
因此它控制这个导航条
设定进度显示结果
可能还设定一些向后导航控制机构
此外它向步骤视图控制器提供的信息
刚好能够正确显示向前导航控制机构
任务视图控制器到此为止
但是得到结果呢？
让我们看看下面如何获得结果
下面介绍DidFinishWithReason
代表召回
任务完成时您的代表将收到该信息
这里您会了解到任务视图控制器结束的原因
可能结束的其中一项原因是用户选择了在任务中途保存工作成果
如果是那样您会希望提取恢复数据
它是一种不透明NSData性质 然后保存
因为以后希望继续执行任务时需要用示例说明新任务视图控制器
并将其传输到专用初始化程序中的恢复数据
但是通常情况下您会顺利完成任务
因此您希望从任务视图控制器的结果属性
抓取相关结果并用它解决一些问题
如对它进行序列化发送到服务器
或者可能需要分析以便向用户展示其中一些信息
最后需要解除该任务视图控制器
因为已经展示了任务视图控制器
还需要为解除控制器承担责任
现在大家了解了ResearchKit的基本概况
以及使用任务型模式的方法
现在让我们看看它该如何匹配
ResearchKit第一个模块调查模块
因此ResearchKit中的调查由三部分构成
指令、调查问题和调查问卷
反之每部分对应一个步骤
因此我们有一个调查问题
我们有一个指令步骤 一个问题步骤和一个问卷步骤
在ORKStep基类现有内容基础上
我们再增加一些指令步骤
但是问题步骤和问卷步骤比它们稍微多一些
我们要看看下个环节
这是问题步骤和任何其它步骤一样
它有一个识别符在任务范围内必须唯一
问题步骤也有回答格式
回答格式是ORKAnswer格式的一个子类
对应希望展示步骤的特定类型
由于各种子类覆盖范围很广
因此我们可能有一个Boolean回答格式
包括“是/否”问题文本选择回答格式
提供图像比例尺的图像选择回答格式
或者日期型和时间间隔格式
种类繁多可以在GitHub上查看
问题步骤就谈到这里
那么问卷步骤呢？
这里有一个问卷步骤并且问卷步骤有一个识别符
而且还有一系列问卷项目
这里是问卷项目
每个文件项目都有一个识别符
在问卷步骤语境内必须唯一
和问题步骤一样问卷项目也有回答格式
并且在受支持答卷项目中
ResearchKit支持相同回答格式
例如我们可以将文本选择回答格式与
同一表格的数字答案格式混合在一起
这就是ResearchKit调查模型对象的对象模型
那么如何获得结果呢？
这是预订任务及其识别符和一个步骤阵列
完成任务后就会获得任务结果
同样有匹配识别符和一系列结果
如果预订任务启动一个指令步骤
那么指令步骤会有一个识别符
一旦完成任务就会获得步骤结果
及其相应识别符
该步骤结果的结果属性为空
因为在该指令步骤期间未收集到任何数据
我们要做的就是向它们展示该指令
虽然这个对象没有什么有用属性
类似开始日期和结束日期
告诉您该指令在页面上持续的时间
此外还可能有一个问题步骤
这个问题步骤有一个识别符
与相应步骤结果匹配
不同于指令步骤结果
实际上会有一个child结果
承载实际答案与答案格式对应
表格结果工作方式极为相似
这里有一个预订任务包含唯一问卷步骤
有两个问卷项目当然在问卷步骤内
识别符必须唯一
收到答案时
会收到任务结果和匹配识别符
还有步骤结果以及与该问卷步骤匹配的识别符
然后收到相应child问题结果
这次还会收到一系列问题结果每个问卷项目都有一个结果对应
还有与相应文件项目匹配的识别符
这就是ResearchKit中的对象模型
以及如何使用调查并且用来展示调查项目的方法
我要让大家看一看Xcode简短展示
这里有一个示例App它显示表格视图
和一份有效任务清单这里我要将一项调查任务
整合在一起让大家看看我已经提到的一些特征
这里是表格视图控制器
表格视图控制器有一个--当您选择一行时
它会举例说明任务视图控制器
并显示该任务设定代表
和输出目录完成任务后
我们会在didFinish召回中显示--我们会解除该任务视图控制器
现在切换到任务枚举这里保留实际任务
大家看到我定义了各种情形包括调查情形
并且显示的任务当前为空
但是现在我要将它定义为调查任务
下一步我会创建它
为了创建调查任务我要定义计算属性
调查任务这里我创建了一项预订任务
以及识别符调查并附带一个步骤阵列
现在该阵列为空
我要添加一个指令步骤
现在这个指令步骤有一个识别符
这里我正在生成识别符
因为我知道它们在该任务内是唯一识别符
我设置了一个标题和文本
将在页面上显示
您会注意到我已经将这些标注为本地化字符串
因为这些模型对象的内容实际上已经本地化
如果打算在多个场合使用App
需要将该内容以及App中需要本地化的
其它项目进行本地化
然后我会添加一个问题步骤
这个问题步骤是一个“是/否”问题
现在有了一个布尔回答格式
它有一个标识符组和一个标题问题如下：
在一个典型日在您爬完几段楼梯后
您的健康状态对自己是否有所影响？
这是一个非常典型的问题
在普通健康调查问卷中很常见
我们已经提过问卷表格所以我要增加一个问卷步骤
这是一份问卷 有识别符 有标题
还有一个常见问题：在上两周您受到以下问题
困扰的频率是多少？
现在我们列出各种问题每个问题都有一个问卷项目
因此其中每项都是一个问题
采用文本选择回答格式
这是一个多项选择问题但只能选择一个答案
大家可以看到这里我给的答案
根本不是几天 超过这些天数的一半 几乎是每天
它们也有相应数值这些值将会进行编码
纳入结果对象因此以后可以分析结果
这些同样可能是属性列表类值
它可能是一个整数--宁可是一个s数
或者可能是一个字符串像这样
我们看到了这个兴趣项
我的问题是做事情少有兴趣或快乐
我们会再增加两项
填完表格
设置完毕后我还想做一件事情
让您看看结果，
为此我已为大家构架了UI所以我们可以研究一下
App自身中的一些结果
这件事情实际在GitHub上的
ORKCatalog样本App中完成
但是今天我还要序列化到JSON
让大家看看JSON输出效果
为此 我们将回到任务视图控制器委托DidFinishWithReason
它希望再增加一个步骤 我要把它挪开
我要在任务上添加结论步骤我忘了做这件事情
所以这是我们的结论步骤
那就回到这里吧
我要打开reason
如果顺利完成任务
我会从任务视图控制器提取结果
然后我想将它序列化到JSON
并且ResearchKit框架本身不包括任何JSON序列化
我们已经将一些东西纳入其中一个测试App
以便证明JSON序列化会用于一项真实App
这里我已将其纳入现在我可以向大家演示了
所以我会运行它并让大家看看调查项目在ResearchKit的情况
开始执行任务时
我会立即看到这个指令步骤
还会显示进度
我可以取消该任务
我已经有了标题和文本也有了导航控制机构
大家看到它已预先生成方便开始启动
从任务视图控制器搭建的框架开始
实现了自动化
我进来时看到了自己的布尔问题
我可以选择自己的答案如果我选择跳过这个问题
我输入的答案会被清除如果我返回答案已经没有了
一旦我返回我可以回答一些不同问题
因此我要仔细检查给出答案
可能我并未回答全部问题但我可以继续
最后我完成了
我们看看结果吧！
如前所述这里我们看到了任务结果
还有一个起始日期和结束日期据此可以查看该调查项目持续的时间
我们有了输出目录一个任务运行UUID
从任务视图控制器开始直接通过
我们也有了任务识别符
child结果阵列包含一个步骤结果阵列
因此初始指令步骤我们有了指令步骤结果
初始指令步骤没有children
因为我们未收集到用户提供的附加信息
此外 还有问题步骤结果
包含一个布尔问题结果
以及为我的问题提供的实际答案
这时我回答“是”
然后从这里的答卷步骤我们得到答卷步骤结果
以及感觉形式标识符和我输入的每个答案
我回答了前两个问题
我没有回答该表格中的最后一个问卷项目
大家可以看到这里没有实际答案属性
并且最后对于结束指令步骤我们还有一个步骤结果
现在我要让大家看看在开发App过程中
如果需要变更调查项目修改答案格式该有多轻松
我希望做的一件事情就是改变我的布尔答案格式
或许“是”提供的信息并不充分
或许我的健康状况受到很大影响
或者影响不大
为此我可以切换到文本选择回答格式
针对允许我提供全部答案的每个选项
我可以提供一些细节文本这样我可以选择“是 影响很大”
或者“是 影响不大”
这里您还要注意一点排他性设置
如果是多选项您可以将一个或多个选项设为排他性选项
如果选择了一个选项系统会取消所以其它选项
我也可能希望改变我的答卷步骤
正如大家看到的那样它是一种垂直卷动的长表格
可能那不是我在App中期望的那样
也许我希望有一些水平滑条
可以用来显示大致相同的内容
得到相同答案但是表现方式可以不同
只需切换到ORKScale格式
明确最大值和最小值的说明内容
即可在ResearchKit内轻松实现
所以我要再次运行并让大家看看效果
又是我们的调查项目
非常相似
在这个步骤我们已经有了不同选项
以前是多选问题现在是滑条
可以用来调整数值
当我完成任务看到结果时
从架构来看结果非常类似但结果类型不同
因为相应答案格式也不同
所以对这些结果的解释也需要有所变化
ResearchKit调查就讲到这里
第二个模块是知情同意
ResearchKit第二个模块是知情同意
我们现在看一下
什么是知情同意？
知情同意是保证参与者完全明白为何和如何进行调查
调查意味着什么
有何风险和收益的过程
如今 调查通常针对个人
而需要同意什么详细要求将取决于您的调查标准
也取决于道德审查过程
现在 参与者和调查者一起审查知情同意书
从起始页到结尾签名
也许您需要在同意过程中签名
最终 知情同意通常是一份法律文件
现在App Store提交的人类研究必须包括
道德审查的证据
这并不完全意味着您需要包含像我们要讨论的那个研究
元件中的知情同意模块那样的知情同意过程
因为低风险研究可能是例外的
一定的高风险研究可能需要亲自工作
但许多案例中假设Researchkit
可以帮到忙那么研究元件中的知情同意
就是合适的您可以在道德审查过程中
自行决定
那让我们来看看知情同意模块
是如何工作的Researchkit中
有两个步骤需要在知情同意文件中被同意
并且这两个步骤都可以
从ORKConsent中获取内容
这个知情同意文件由两个序列组成
第一个是一个部分序列
这些部分序列可能是预定义类型
就像数据采集、隐私、数据使用
这些都是您希望在知情同意文件中看到的类型
但也有自定义部分
因此Researchkit并不打算提供一个完整的解决方案
我们提供80%的解决方案
如果您需要给您的App附加信息您可以自行添加
除了知情同意文件以外还有一个签名序列
因而我们可能有一个
包含有预填充姓名和图像的调查签名
以及一个我们在调查同意过程中采集的参与者的签名和图像
让我们看看调查元件中的这些部分
我们有了视觉同意步骤 分享同意步骤
以及检查同意步骤我将稍作详细解释
视觉同意通常在文件中各部分占一屏
有着简洁的动画过渡稍后我将就这些预定义部分
作个演示
它完全可以定制因此您可以用图像替代
您可以用动画替代
也可以填充知情同意文件中的确切内容
让我们看看如何编码
您将创建一个特别种类的知情同意部分
这种情况下采集数据
然后设置属性
我不用设置标题
因为在iOS的所有语言都已经进行过本地化
现在我选择的是预定义部分
但如果我不需要预定义部分或者如果我需要指定我自己的
我也可以这样重写
我可以指定在视觉同意过程中显示的概要
当用户通过视觉同意或在浏览整个文件时
点击了“了解更多”的话
我也可以指定内容
此外您可以设置其他事项
可以设置定制图像或者定制动画
定制动画只是一个视频文件
您可以包含进您的App里
如果设置步骤类型的话不管何种错误
您都可以覆盖掉这个定制动画或者您也可以重新设置一个
一旦您有了同意部分
您就可以把您的文件附到视觉同意步骤里
来展示您的视觉同意序列
知情同意模块的下一步是分享步骤
研究数据采集艰难因此在可行的多方研究中重复使用是有意义的
所以获取更广泛的同意
可以让您和其他研究者
共享数据
但是那对参与者会有问题
如果数据敏感他们可能只想协助您的研究而非别人的
这个问题 在我们使用Researchkit
研发最初的App时就存在
因此我们创建同意分享步骤
我们已经提前本地化了所有iOS支持的语言
以便我们带入您的机构名称和几个其他细节
您就可以问参与者
他们是否同意更广泛地分享数据
在初期调查中超过80%的参与者对此表示同意
但我们仍然认为这是件重要的事项
如果您的需求包含这样一个广泛同意的话
以上是同意分享步骤
Researchkit知情同意模块的最后一步
是检查步骤参与者在此检查实际文件
可能输入他们的名字
也可能是手指签名
我们接下来看
这将如何编码
现在您要开始您的同意文件
您需要加一个
您想采集的签名
这是参与者签名
您为参与者在签名线下方设置标题
如果您想生成PDF文件的话
我们就得到一个识别符
如果我们想在知情同意书中
找到一个特别的签名的话识别符就将进行识别
您可以关闭名字采集或者签名图像采集
我们通过设置命令签名图像来关闭
然后您可以在知情同意文件中添加签名
当您指定了您想收集何种签名时
您就可以把同意文件附到同意检查步骤
您可以使用多个同意检查步骤
如果您有多人在同一设备上查看同一文件的话这是允许的
这些就是Researchkit中组成知情同意模块的步骤
但要真的理解当您运行App时看起来的样子
接下来我将做演示
开始编码知情同意部分
我需要开始创建同意文件
我先做这个 这是我的同意文件
首先我需要在视觉同意中来展示同意部分
在这里我创建一个同意部分序列
在Type Overview上我设置了概要
来创建一个同意部分
由于已经本地化过语言了我不需要设置标题
我来添加更多部分您可以看到这些动画
我再来添加数据采集部分和隐私部分
每一部分都带有lorem ipsum文本
此外我想展示如何给同意文件添加实质内容
内容将添加到同意检查文件部分
或者添加到视觉同意部分在点击“了解更多”时
发现的内容中
您可以直接指定内容属性
它只是文本或者您可以指定HTML
如果您想要HTML的话
这是我的同意部分
我需要一些同意检查步骤的签名
我将添加参与者签名
就像之前幻灯片里我展示的编码
带有不同标题和不同识别
符的带有名字和预定
图像的调查者签名
我将把这些添加到同意书中
然后 我就有了同意文件
我需要创建任务来展示我的同意过程
这是带有识别符同意书的同意任务
我选这个是因为它与调查不同
它应当是我阅读
是我能明白我有了一个步骤序列它目前是空白的
首先我想要一个视觉同意步骤
我添加在这里有识别符的视觉同意书
我从我的电脑属性中传递文件
接下来我将展示同意分享步骤
它仅有几个属性我需要设定顺序来充分填充文本
最后我需要一个同意检查步骤
从而让参与者
有机会输入他们的签名并检查整个文件
这样我就从同意文件中获得了第一个签名
我知道是参与者签名
同意文件本身附着带有独特任务识别符号的
同意检查步骤
有几项我可以在同意检查步骤额外定制
就像用户输入他们的名字和在确认对话中他们同意时
所展示的文本一样
我已经把这些步骤添加到我的步骤序列里了
我只需要扩展表格视图来展示任务
制定我想展示的实际任务
我来演示同意部分
我开始知情同意任务时
直接跳到视觉同意步骤
与一些我们看到的步骤相反
视觉同意步骤每一部分有多个界面
这与我的同意文件的开始部分对应
我导航到第二步
当我向下个界面过渡时我们有美丽的动画
我想说一下这是预定义好的动画
您可以进一步定制屏幕
例如为了使其适用您的App
如果您用UIAppearance设置色调
那就会覆盖掉屏幕上方的控制按钮
和下方这里的按钮
并改变图像的颜色
对应的动画可以很好地适用于您创建的App
当我进行下一部分
您将看到“了解更多”按钮
当我点击“了解更多”我能看到特别同意文件中的实质同意
我继续来到内容分享步骤这只是一个问题步骤
我问是只向您的机构
还是向世界各地的研究者分享数据
我想向所有您认为合格的研究者分享数据
那么继续我会看到同意检查步骤它概括了
文件每部分的标题和内容
我只设置一部分内容
但如果您想为您的同意书设置特别的同意所有内容的话
那就会是一份需要用户同意的完整的法律文件
现在有时您想在文件中显示的部分
和您在视觉同意书中显示的部分不同
您可以通过只使用文件内的部分
在调查元件中轻易地
让它只出现在同意检查步骤
或者通过使用完全不同的反对代表
或第三方选择的同意文件
您可以设置HTML检查内容
如果您需要完全定制它完全支持在同意检查中
显示您自己的HTML
我一旦同意了您就会看到我提供的自定义文本
我输入我的名字
继续我可以签字这个我做不好
最后当我完成任务时
您就得到了一个结果就像在Researchkit上的
其他任务一样
这里有一个与视觉同意相应的步骤结果
显示我看视觉同意用了多长时间
因为我回答了“是”
就分享了一个带有答案“是”的问题步骤
并且您会看到最终同意检查步骤的结果
包括我输入的签名数据
那么如果我在Swift的实际目标中找我的名字
我就能拉出我签名的具体的UI图像
以上就是Researchkit中的知情同意部分
在结束这个不值得的
已经学过的知情同意之前
还有其他事项
需要提一下
我将它们分为两类
第一类是知情部分
第一部分是个形式元素
我们已尝试把视觉同意很好地适用于
小的iPhone形式元素上的同意文件
但是对于您的App您需要添加额外的定制内容
您需要试着让内容正好适用于那些设备
接下来我鼓励您使用定制部分
即我们在Researchkit的建议风格部分
输入的内容
您需要表达您实际
需要的代表您的伦理的您的道德检查过程
接下来您应该开始计划参与者的问题是否放在同意过程中？
就是说 在用户完全同意之前
且在他们实质上加入了您的研究之后
也许他们开始参与后会有更多问题呈现
许多已经在使用Researchkit中的App
最后整合进一个理解小测验
这可能是有点多余的工作
但是得知参与者会真正理解
您在视觉同意中要表达的也会让您很放心
为达到这个目的
您可以使用与调查模块同样的步骤
然后整合进同意任务即可完成
另一方面 我们得到同意
这里有几个点
一个是身份验证
Researchkit没有验证您的参与者身份的功能
但是使用Research Kit的初始App可以用邮件验证
来确保参与者是一个人
但这个研究可能要来自您的道德检查过程
您也许不需要比它差太多
比如您也许需要用第三方服务
来更可靠地识别身份
一旦您有了身份的概念
您可能想要绑定身份和相关的同意记录
这样一来使用一些加密签名就是合理的
以上就是知情同意
在Researchkit中的第三个模块是主动任务
一个主动任务是半控制的测试
测试中会给予参与者执行任务的逐步指示
通过设备上传感器在收集数据的同时执行任务
这些任务的主要
特性是它们是交互的且时间很短
因此他们是分段的任务
在一个ResearchkitApp中目前最长的任务大约是六分钟
大多数都只有一两分钟
我们看一下Researchkit中预定义好的任务
这些任务一般有一些指示步骤
用于给您介绍任务基本上就是告诉您
它是什么还有您需要做什么
然后给您某些类别的指示让您准备去执行
接着是一个主动的步骤数据在此时被收集
最后当任务完成时我们感谢您的参与
激活步骤是其成为主动任务的原因
在此激活步骤是一个在我们预定义好的单独主动任务中的基本类别
或是生成我们需要的每个任务中特殊行为的子类
现在当我们释放Researchkit时
有五个主动任务
前三个是用传感器收集的数据打开设备
您被要求来回走因此我们就会有
加速计和陀螺仪收集的我们的步态
和平衡任务的数据
我们来设定健康任务当我们收集心率数据时
被要求走六分钟
然后设定声音任务当我们使用麦克风时
来收集您的声音信息
此外还有两个任务更多认知测量任务
使用更多交互触摸行为
我们有空间记忆任务其中有序列
被要求重复还有点击速度任务
其中您被要求在两个按钮间快速转换点击
此外在我们释放Researchkit以后
还增加了两个主动测试
我们有一个听力测试还有一个反应时间测试
您将收到一个刺激
您必须摇晃设备做出反应
为了帮您树立一个有关主动任务如何工作的印象
我将给您做一次演示来作为实践
接下来
这是一个很短的演示
因为我只需要给这些简单的预定义任务一个示例
我将创建这个主动任务计算特性
该任务是两个指头敲击间隔
我只需要设定几个参数
对每个我们提供的不同的主动任务来说这几个步骤基本相同
您指定一个识别符
在您的研究中它必须是唯一的
您指定一个拟使用说明
作为一个本地化的字符串
它将被代入我们提供给每个任务的事先预定的内容中
您指定一个时间段及您需要用户敲击多长时间
还可以定义一些其他的选项
来控制我们是否在任务开始和结束时包含实际指示步骤
如果我们提供的对您不合适的话
您也许会想提供您自己的指令
现在我们有了主动任务
并且想要把它增加到桌面视图上
我只需要做几个改动来支持它
我把它添加到我的任务列表
作为一个代表任务提及我的计算属性
当我运行它时我应该有第三个任务
就是两个指头敲击任务
拟使用说明填充在这里
其余内容本地化到所有iOS支持的语言
我们保持这个到所有我们添加的主动任务
这里是我们的下一步指示
告诉我们该做什么
我选择按钮来点击
当我进入任务并开始点击前并不计时
我现在开始点击
现在我们看到计时器走得越来越快
任务结束了
当任务结束时我得到一些结果
我们看一下它是如何运作的
因为这是其中一个认知任务数据没有被写到文件中
数据被存放在内存里
我已经在JSON连载我们看一下
这里有了我们的任务
同样我们有开始和结束日期和其他各种属性
我们有与介绍指示相对应的步骤结果
我们有与激活步骤相对应的步骤结果
它包含一个子结果
就是两指敲击间隔任务的敲击间隔结果
反过来它包含着一列样本
样本包含着每次敲击的时间
和屏幕上的坐标位置及识别符显示我敲击的那个按钮
敲击到按钮外的也记录在此
此外这个结果也有一些其它属性细节见屏幕
我想讲的是这些位置对于其它种类的主动任务
对应着什么
您将看到基于文件的结果那些是带着指向磁盘特定位置的
文件URL的ORKFile结果
它们会出现在您设定任务控制器时指定的输出目录中
以上就是我的Researchkit主动任务演示
今天我们讲了Researchkit的三个模块
调查、知情同意、主动任务
但我想还不能结束
我想Researchkit随着第三方
就是你们的贡献将会持续扩充
我们持续增加附加功能
使它与我们最新版本的软件同步
因此有你们的贡献它将变得更好
让我们谈谈您可以如何贡献
Researchkit只是GitHub上的一个开放源码项目
那意味着您可以像和其他开放源码项目一样
和它进行交互
首先您需要选一个现有议题或者开始一个新的并且评论它
从中我们得知您正在继续工作
然后您想和我们分享什么事项时
您要交一个pull请求
此时Apple的评审
和我们外部活跃的贡献者将评审
您贡献的质量
它将如何与Researchkit匹配
及如何融入该项目
迄今为止我们收到的修改中
90%已经整合进代码库
我认为这是个良好的起点
让我们的项目可以向前发展
一旦您的修改被整合
尽管这不是结束
此后某个时刻
我们将启动整合过程
从而把Researchkit带向一个更高版本
事实上我们昨天已经结束了第一个版本
用Researchkit 1
在这个过程中我们会再次
审核您的修改比如可访问性
也会本地化到iOS支持的所有语言
在此请您帮忙
希望工作听起来不算多
您愿意帮忙
让我们再来看看您能贡献的其它领域
我们之前提到其中一个领域
是主动任务我们已经有两个新的上半月公众贡献的主动任务
我们看到还有人贡献了答案格式
有人添加了一个垂直滑块答案表格
有人添加了新的图像捕捉步骤
除此以外我们期望看到更多领域
比如设备支持领域的贡献
所以如果您有硬件设备您认为可以用于医疗调查研究
您可以为Researchkit添加支持
来帮助更多研究者在App中使用它
我们也希望添加一些后台集成
因此如果您有后台服务
您认为可以很好地整合进Researchkit
并且它可以为研究者提供数据存储方案
那么您给Researchkit添加代码来支持您的后台将是很有意义的
我们知道有一些贡献者
他们已经在做了
现在我们不谈细节 我想多谈一点
主动任务您已看到主动任务的结构
它有指示步骤 倒计时步骤
激活步骤和完成步骤
激活步骤当您实施您的激活步骤时基础分类中
已经有一些有用的行为
因而激活步骤支持记录配置
当您为了从不同设备的传感器中
自动采集数据
来配置您的激活步骤时您不用写很多代码
我们仔细看一下这是如何运作的
当下我们有五个
内置于Researchkit的记录仪
有加速记录 运动记录
有从CoreMotion采集数据的计步器
有从HealthKid采集数据的
健康质量记录
例如 它可以用来采集心率
我们也有位置记录
我们可以在您激活步骤的过程中
从Core Location获得信息
现在当您在iOS上使用这些时
您需要取得用户的同意来进入数据
Researchkit不是一个系统框架
它不允许您绕过这些控制
但是我们试着理顺这个过程
如果您使用一个或多个步骤任务视图控制器会通知
并在指示之后步骤开始前询问许可
所以我稍微讲一下记录器是如何使用的
以Researchkit中这个
六分钟走路的健康步行为例
这是健康步行
它是ORKActiveStep的子类
当您对ORKActiveStep做子分类时
您也对激活步骤视图控制器做了子分类
您有一个激活步骤视图控制器
它有个返回指针
现在给健康步行配置了记录器配置
它将有一个带有特定的唯一的
识别符的健康质量记录器
它将与结果匹配您马上就能看到
这个记录器配置有几个参数
有数量种类
在此就是心率数量种类
有单位 在此就是心率监视器上的每分钟心跳
您可以配置不止一个记录器
这个例子中就配置了计步器
再次，有了不同的识别符
当您运行健康步行时
您可从记录器中识别结果
当步行开始 您有两个记录器
一个是健康质量记录
一个是计步器
每一个都将用到
健康步行所附加的配置目标模型
当任务完成时您会得到步骤结果
作为您任务结果的一部分
步骤结果将包含两个子文件结果
每一个都是带识别符号的与配置对应的记录
如前所述文件URL将指向输出目录的文件在此数据会被记录
Researchkit中的实际序列化格式
在这里是JSON
但如果您需要不同的格式
可以直接增加一个不同格式
以上是记录器
现在我已经提到做一个客户激活步骤时您需要的过程
但我们在结束前还是描述一下
当您要创建您的定制激活步骤时
您先将ORKActiveStep做子分类
并将激活步骤视图控制器做子分类
通常我们有配对的分类
然后您需要构建UI
如果您需要控制整个屏幕
那就意味着您将彻底覆盖
您的激活步骤视图控制器的UI
或者意味着您要定制视图
使其适合Researchkit内置的激活步骤模板
如果您需要使用我们已有的记录器来采集传感器数据
您就得配置一些记录器并且添加新的结果类别
以认知游戏为例您看到这里我们有了点击间隔任务
那是个我们特别创建的结果类别的例子
当您创建类似这个的激活类别时
您需要相应地创建您自己的类别结构
该类别结构必须可序列化
那将引出您要包括在结果中的一些限制
以上是结果步骤
我们谈到
三个模块和如何给Researchkit贡献
我想给你们一点想法
首先 Researchkit是开放源码的
我想让您做一件事复制这个结果
看它如何适用于您的App
因为它是开放源码的您可以做出贡献
可以对医疗研究的未来有所作为
这是真正的要点
这是一个开放源码项目它会成为您让它成为的样子
还有几个其他领域您可以得到Researchkit的附加信息
我们的主页
ResearchKit.org
我们有包含在Researchkit中的
不同项目的链接既有使用ResearchKit的App
也有我们再次链接的框架本身
举例来说如果您是主调查人员
您想联系到能帮助您的项目的人们
您可以联系我们ResearchKit@Apple.com
最后关于技术支持我有两个邮箱列表
如果您需要联系正在使用该框架的用户
或者咨询如何使用可以联系ResearchKit Users
如果是关于如何贡献的问题可以联系ResearchKit Dev
当您尝试组建一个研究App时这里有一些相关部分可以帮您
昨天HealthKit有新消息
我们介绍了一些新的数据种类
您可以在线访问
我们今天早上也有HealthKit和ResearchKit研讨会
明天上午11:00也有
最后有一个健康和健身的研讨会一共半小时
希望您参与
非常感谢 感谢聆听
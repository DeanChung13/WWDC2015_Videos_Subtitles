00:00:29.596 --> 00:00:30.564 
<br/> 
下午好

00:00:34.301 --> 00:00:36.570 
歡迎來到應用程序擴展
最佳實踐

00:00:37.571 --> 00:00:39.239 
我是索菲婭·多伊徹
我是一名工程師

00:00:39.306 --> 00:00:41.008 
我在UIKit框架團隊

00:00:41.475 --> 00:00:43.177 
稍後我的同事會加入
本屆會議

00:00:43.243 --> 00:00:44.778 
來自CoreOS的伊恩 拜特

00:00:46.213 --> 00:00:49.183 
在會議的第一部分

00:00:49.249 --> 00:00:52.119 
我想談兩個iOS的擴展主要類型

00:00:52.819 --> 00:00:54.188 
動作和共享的擴展

00:00:55.756 --> 00:00:57.691 
在稍後的會議上
伊恩將加入我們

00:00:57.758 --> 00:00:59.293 
來談今天的小工具的增強功能

00:01:00.460 --> 00:01:02.996 
在整個會議期間 
我們將告訴您許多現實世界的例子

00:01:03.063 --> 00:01:04.364 
以幫助您最大限度地

00:01:04.431 --> 00:01:05.966 
利用這些類型的擴展

00:01:08.602 --> 00:01:10.470 
現在　應用程序擴展和分享

00:01:10.971 --> 00:01:15.642 
讓我向您簡單介紹一下
這兩種類型的擴展

00:01:15.709 --> 00:01:17.444 
有何不同

00:01:19.413 --> 00:01:23.750 
動作擴展
都關於不斷變化的內容

00:01:24.384 --> 00:01:26.920 
而共享擴展
都關於移動內容

00:01:27.087 --> 00:01:28.655 
從當前主機應用程序

00:01:28.956 --> 00:01:31.024 
到應用程序或Web服務

00:01:32.893 --> 00:01:33.727 
現在

00:01:34.194 --> 00:01:35.762 
我要給您舉更多的例子

00:01:36.730 --> 00:01:37.865 
正如我剛纔提到的

00:01:37.998 --> 00:01:40.300 
動作擴展作用於當前的內容

00:01:41.301 --> 00:01:43.704 
正因爲如此
它們使用的內容

00:01:43.770 --> 00:01:45.272 
將作爲主用戶界面

00:01:46.373 --> 00:01:48.342 
稍後我將展示一個有關它的例子

00:01:50.244 --> 00:01:51.578 
但您也有機會

00:01:51.845 --> 00:01:54.781 
在執行該操作之前
提出附加選項

00:01:57.017 --> 00:01:58.018 
此外

00:01:58.952 --> 00:02:01.421 
您的應用程序功能可以被分開

00:02:01.488 --> 00:02:03.690 
在不同的動作擴展

00:02:03.757 --> 00:02:06.460 
存在的容器應用程序中

00:02:08.562 --> 00:02:10.564 
現在讓我舉一個例子

00:02:12.232 --> 00:02:15.335 
我們在用Safari瀏覽器
我點擊右上方動作件

00:02:15.836 --> 00:02:18.572 
彈出共享表與兩種類型的擴展

00:02:19.439 --> 00:02:20.574 
共享擴展在頂部

00:02:21.275 --> 00:02:22.910 
動作擴展在底部

00:02:23.844 --> 00:02:25.979 
我們做這個翻譯擴展

00:02:26.613 --> 00:02:27.481 
當我們點擊它

00:02:27.681 --> 00:02:28.782 
下面Safari瀏覽器

00:02:29.583 --> 00:02:32.186 
就會將
網頁轉移到該擴展

00:02:32.653 --> 00:02:35.155 
在那裏
它會被翻譯

00:02:35.455 --> 00:02:38.692 
然後翻譯角會移回
Safari瀏覽器原位

00:02:42.229 --> 00:02:43.664 
下面是同樣的一個變化

00:02:44.264 --> 00:02:46.867 
當您點擊翻譯
您帶了這種形式的表

00:02:46.934 --> 00:02:48.902 
在這裏用戶可以選擇一種語言

00:02:49.536 --> 00:02:53.140 
然後當您點擊語言時
我們的網頁將傳送到擴展

00:02:53.207 --> 00:02:55.242 
然後它會再次被翻譯

00:02:55.309 --> 00:02:58.679 
並搬回到位於Safari中的

00:03:01.682 --> 00:03:02.983 
這麼多的
關於動作的擴展

00:03:03.050 --> 00:03:05.219 
那麼共享擴展有何不同？

00:03:09.923 --> 00:03:12.326 
正如我剛纔所說的
共享擴展

00:03:12.392 --> 00:03:15.562 
是所有關於共享的內容
從主機應用程序

00:03:15.762 --> 00:03:17.264 
到您的應用程序或Web服務

00:03:19.399 --> 00:03:20.968 
正因爲如此
這很重要

00:03:21.034 --> 00:03:24.204 
您所提供的
用戶驗證和編輯之前的內容

00:03:24.271 --> 00:03:26.673 
將移出到
您的Web服務

00:03:28.442 --> 00:03:29.776 
我們爲您提供的是一個API

00:03:29.843 --> 00:03:31.545 
之後我會告訴您幾個例子

00:03:34.581 --> 00:03:37.951 
此外您的共享擴展
代表您的應用程序

00:03:38.018 --> 00:03:40.587 
在共享表中
爲了防止混亂

00:03:40.654 --> 00:03:43.056 
我們只允許
您把一個共享擴展

00:03:43.123 --> 00:03:44.258 
包含在一個應用程序裏

00:03:46.627 --> 00:03:49.196 
現在讓我
舉一個共享擴展的例子

00:03:50.163 --> 00:03:51.965 
我們有底部共享

00:03:52.266 --> 00:03:53.667 
和頂端共享擴展

00:03:55.002 --> 00:03:57.171 
現在我們可選擇四種照片
而當我們

00:03:57.271 --> 00:03:59.173 
點擊iCloud照片共享擴展

00:04:00.874 --> 00:04:01.775 
接下來

00:04:03.043 --> 00:04:06.113 
我們得到一個小預覽表
用戶可以在其中添加評論

00:04:06.580 --> 00:04:10.584 
可能點擊共享相冊 
並在右側出現一個小預覽

00:04:10.884 --> 00:04:12.586 
但是我們還沒有
轉移任何數據

00:04:14.288 --> 00:04:17.324 
現在如果該信息是正確的
用戶可以決定

00:04:17.391 --> 00:04:20.560 
要麼抵消
要麼點擊發布實際執行操作

00:04:21.762 --> 00:04:24.965 
現在讓我們來仔細看一下
在中心的這個表

00:04:26.366 --> 00:04:28.769 
這實際上是我早先提到的API

00:04:29.002 --> 00:04:30.003 
這就是所謂的

00:04:30.070 --> 00:04:31.705 
SLComposeService
ViewController

00:04:31.772 --> 00:04:33.307 
這是它的外觀平直框

00:04:34.508 --> 00:04:36.777 
有一個文本框 
一個右側的小預覽

00:04:38.345 --> 00:04:41.415 
然而這是特別爲我們定製的
特色服務

00:04:41.481 --> 00:04:43.450 
例如我們喜歡自定義

00:04:43.650 --> 00:04:45.352 
使它看起來更像這一點

00:04:47.454 --> 00:04:49.356 
我們增加了一個佔位符
我們甚至還添加了

00:04:49.423 --> 00:04:50.390 
一個字符餘留屬性

00:04:50.557 --> 00:04:52.292 
我們甚至改變預覽視圖

00:04:52.826 --> 00:04:55.329 
在底部我們有一些選擇

00:04:59.166 --> 00:05:02.836 
現在
讓我們通過一些例子來構建

00:05:04.605 --> 00:05:05.973 
首先

00:05:06.540 --> 00:05:10.077 
要設置一個佔位符
在該表上設置佔位屬性

00:05:13.146 --> 00:05:14.047 
開始了

00:05:15.983 --> 00:05:18.852 
而您的Web服務可能
有一個最大字符限制

00:05:19.319 --> 00:05:21.154 
所以我們有一個小指示燈
在左下角

00:05:21.388 --> 00:05:23.423 
要更新它
只需設置一個屬性

00:05:26.360 --> 00:05:28.762 
再次我們爲您提供了d
一個預覽視圖框

00:05:28.829 --> 00:05:30.030 
但您可以有您自己的一個

00:05:30.731 --> 00:05:34.368 
爲了支持簡單的
構成控制器

00:05:34.701 --> 00:05:36.370 
並重寫裝入預覽視圖

00:05:36.837 --> 00:05:40.440 
然後返回
您自定義視圖控制器的預覽

00:05:41.742 --> 00:05:43.610 
但有一點要記住

00:05:43.677 --> 00:05:46.480 
請確保該視圖有

00:05:46.547 --> 00:05:50.517 
否則可能無法
在紙張上顯示出來

00:05:54.354 --> 00:05:58.058 
現在這些選項在底部

00:05:59.092 --> 00:06:02.196 
這些僅僅是單元格
一個值在左邊

00:06:02.262 --> 00:06:05.499 
一個值在右邊
點擊他們

00:06:05.599 --> 00:06:07.067 
我們通過一個
選項視圖控制器

00:06:07.134 --> 00:06:12.372 
可以選擇您的選項
您的自定義選項

00:06:13.307 --> 00:06:15.142 
讓我來告訴您
如何設置它的代碼

00:06:16.243 --> 00:06:17.177 
很簡單

00:06:17.344 --> 00:06:19.680 
子類SL - 構成

00:06:20.781 --> 00:06:22.716 
然後重寫 - 方法

00:06:23.784 --> 00:06:28.522 
每一行表示
爲一個SL構成表配置項目

00:06:28.956 --> 00:06:29.823 
（太拗口了）

00:06:32.292 --> 00:06:34.027 
左邊是標題

00:06:34.595 --> 00:06:37.731 
右手邊是值

00:06:40.167 --> 00:06:44.271 
現在如果用戶點擊一個單元格
我們在這裏調用點擊處理

00:06:44.972 --> 00:06:46.240 
而且您應該

00:06:46.306 --> 00:06:48.141 
創建自定義視圖控制器

00:06:48.208 --> 00:06:49.877 
爲您的自定義選項

00:06:51.245 --> 00:06:53.881 
而推動它只需調用
推送配置視圖控制器就可以

00:06:54.448 --> 00:06:56.917 
這種工作方式與API相同

00:06:57.050 --> 00:06:59.152 
即您的導航控制器

00:07:01.355 --> 00:07:04.258 
然後最後返回項目區域

00:07:08.562 --> 00:07:11.298 
現在我們甚至能爲您提供
自動完成支持

00:07:11.365 --> 00:07:12.332 
在構成表上

00:07:13.233 --> 00:07:14.935 
要自動完成

00:07:15.002 --> 00:07:16.370 
您可以設置一個視圖控制器

00:07:16.436 --> 00:07:17.871 
在這裏更新按鈕部分

00:07:18.772 --> 00:07:21.675 
在這種情況下它是一個表視圖
我們自動填充名稱

00:07:21.875 --> 00:07:23.010 
但它可能是真的什麼

00:07:24.711 --> 00:07:27.748 
要設置它
只需設置自動完成視圖屬性就可以

00:07:28.215 --> 00:07:29.750 
我們爲您做所有動畫

00:07:30.117 --> 00:07:31.318 
當您做完自動完成

00:07:31.385 --> 00:07:32.853 
您將其設置回零

00:07:35.856 --> 00:07:36.690 
一切都非常簡單

00:07:37.424 --> 00:07:38.258 
再次

00:07:38.325 --> 00:07:39.226 
我們的

00:07:39.293 --> 00:07:40.527 
SLComposeService
ViewController

00:07:40.594 --> 00:07:42.162 
提供了一致和熟悉的
用戶界面

00:07:42.729 --> 00:07:46.099 
這是完全可自定義的
您可以在應用程序採用它

00:07:47.067 --> 00:07:48.602 
但是
如果您有不同的需求

00:07:48.669 --> 00:07:50.971 
爲您服務擴展

00:07:51.271 --> 00:07:54.174 
您可以
隨時通過您的視圖

00:07:54.374 --> 00:07:55.375 
直接返回

00:07:57.344 --> 00:07:58.178 
現在

00:07:58.245 --> 00:08:00.814 
我只是告訴您
如何讓動作共享擴展

00:08:01.548 --> 00:08:02.816 
那麼讓我們改變齒輪
一點點

00:08:02.950 --> 00:08:04.585 
並討論

00:08:04.651 --> 00:08:07.721 
如何支持別人做擴展

00:08:08.121 --> 00:08:09.523 
在主機應用程序裏

00:08:11.325 --> 00:08:14.595 
舉例來說假設我們
做了一個文本編輯應用程序

00:08:15.229 --> 00:08:17.297 
我們想與大家分享文本文檔

00:08:17.364 --> 00:08:18.565 
以及純文本

00:08:19.600 --> 00:08:22.469 
然而
某些擴展可能不理解文字

00:08:23.170 --> 00:08:24.671 
他們可能只支持PDF文件

00:08:25.572 --> 00:08:27.941 
或者其他的擴展
可能只支持HTML

00:08:29.343 --> 00:08:31.345 
現在
您想支持儘可能多的擴展

00:08:31.411 --> 00:08:35.115 
所以好方法是提供
所有這三個文件類型

00:08:36.817 --> 00:08:38.519 
但是您知道

00:08:39.052 --> 00:08:41.188 
這三個都不是真正的
獨立的文件

00:08:41.255 --> 00:08:43.123 
當您共享一個文本文檔時

00:08:43.756 --> 00:08:46.593 
您真正擁有的
是一個單一的文件

00:08:46.660 --> 00:08:48.228 
它支持不同的
文件格式

00:08:49.930 --> 00:08:51.999 
而正因此我們有一個
叫做

00:08:52.299 --> 00:08:54.101 
NSItemProvider
的API

00:08:55.302 --> 00:08:56.637 
簡單來說

00:08:56.703 --> 00:08:58.972 
NSItem
Provider是單個條目

00:08:59.039 --> 00:09:00.541 
有多種表示方法

00:09:01.675 --> 00:09:04.278 
讓我告訴您一個代碼示例
來更好地解釋它

00:09:05.779 --> 00:09:07.814 
現在我們創建
NSItemProvider

00:09:09.149 --> 00:09:10.784 
調用註冊項目類型標識符

00:09:10.851 --> 00:09:14.087 
來添加新的表示

00:09:14.154 --> 00:09:15.189 
到該項目提供者

00:09:16.156 --> 00:09:17.491 
在這種情況下它是純文本

00:09:19.126 --> 00:09:22.896 
現在如果擴展請求
採用純文本表示

00:09:23.330 --> 00:09:26.099 
該系統將在這裏
調用這種裝載處理程序塊

00:09:27.534 --> 00:09:30.170 
還有
您應該動態創建文本文檔

00:09:30.237 --> 00:09:32.673 
並調用完成處理程序

00:09:32.739 --> 00:09:34.975 
來將數據返回到擴展

00:09:37.010 --> 00:09:38.445 
PDF格式同樣

00:09:38.779 --> 00:09:41.582 
只要擴展要求一個PDF 

00:09:42.015 --> 00:09:45.485 
表示我們調用加載處理程序
您在動態創建PDF

00:09:45.552 --> 00:09:47.654 
並調用完成
讓其將數據

00:09:48.121 --> 00:09:49.089 
返回到該擴展

00:09:51.992 --> 00:09:53.160 
要顯示共享表

00:09:53.493 --> 00:09:55.662 
簡單地創建一個
UI活動視圖控制器

00:09:56.296 --> 00:09:58.866 
並提供了初始的項目
來提供程序選項

00:10:03.270 --> 00:10:04.104 
現在

00:10:04.638 --> 00:10:06.974 
您看到的是
構成表中的第一個例子

00:10:07.441 --> 00:10:09.209 
我們在右上角有這個小預覽

00:10:09.810 --> 00:10:11.812 
該主機
應該也提供預覽

00:10:13.347 --> 00:10:15.682 
這些預覽
代表着什麼將被共享 

00:10:17.084 --> 00:10:19.720 
而且
它們需要被簡單而有效的創建

00:10:19.786 --> 00:10:21.021 
它們不能過大

00:10:22.890 --> 00:10:23.790 
對於這點

00:10:23.857 --> 00:10:26.493 
我們有一個NSItem
Provider API也是如此

00:10:26.560 --> 00:10:28.161 
這就是所謂的
預覽圖像處理程序

00:10:29.263 --> 00:10:31.999 
並且
一旦擴展要求一個預覽

00:10:32.299 --> 00:10:34.801 
我們調用這個塊
在這裏

00:10:34.868 --> 00:10:37.804 
您應該
創建縮略圖或預覽

00:10:37.871 --> 00:10:39.573 
表示爲動態的圖像

00:10:39.840 --> 00:10:40.874 
並調用完成處理程序

00:10:40.941 --> 00:10:41.842 
來返回數據

00:10:42.809 --> 00:10:44.945 
現在我們需要再次
改變我們的觀點

00:10:45.512 --> 00:10:47.614 
我們首先談到了
實現擴展

00:10:48.682 --> 00:10:51.518 
然後我們談到了
支持擴展爲主機應用程序

00:10:52.152 --> 00:10:53.187 
現在讓我們來看看

00:10:53.253 --> 00:10:55.556 
再次成爲擴展開發是什麼感覺
以及

00:10:55.622 --> 00:10:57.224 
如何聲明您的支持
用哪種數據

00:10:57.291 --> 00:11:00.127 
主機應用程序
可以提供給您的擴展

00:11:01.562 --> 00:11:02.529 
例如

00:11:02.729 --> 00:11:04.498 
也許您想擁有完整的共享服務

00:11:04.565 --> 00:11:07.100 
並要聲明您共享擴展

00:11:07.201 --> 00:11:08.869 
支持圖像和視頻

00:11:11.905 --> 00:11:12.739 
現在

00:11:12.806 --> 00:11:15.042 
在這種情況下
讓我們做三種擴展名

00:11:16.109 --> 00:11:20.247 
一個擴展支持圖像

00:11:20.881 --> 00:11:22.416 
另一個支持處理電影

00:11:22.749 --> 00:11:25.352 
而第三個
處理圖像和短片

00:11:27.287 --> 00:11:28.689 
現在讓我們看看會發生什麼

00:11:28.755 --> 00:11:30.357 
如果主機應用程序
共享單一的圖像

00:11:31.892 --> 00:11:33.260 
在這種情況下 

00:11:33.327 --> 00:11:35.462 
第一和第三種擴展將
出現在共享表

00:11:37.364 --> 00:11:39.533 
現在相同的方式
在處理電影的情況下

00:11:40.167 --> 00:11:41.902 
如果主機應用程序

00:11:41.969 --> 00:11:43.170 
共享
一個電影

00:11:44.304 --> 00:11:47.341 
第二和第三種擴展將出現在共享表
這是有道理的

00:11:48.275 --> 00:11:49.109 
但是

00:11:49.176 --> 00:11:50.844 
如果主機的共享

00:11:51.278 --> 00:11:53.046 
支持圖像和電影
會發生什麼？

00:11:53.280 --> 00:11:55.349 
您可能會認爲所有的
擴展將出現在工作表中

00:11:55.415 --> 00:11:56.316 
然而

00:11:56.383 --> 00:11:58.785 
目前的情況並非如此

00:11:58.852 --> 00:12:02.155 
因爲在iOS 8中的實現
需要

00:12:02.289 --> 00:12:07.995 
擴展可以處理
所有兩種類型的文件格式

00:12:09.062 --> 00:12:10.230 
有一點可惜

00:12:10.330 --> 00:12:14.201 
因爲用戶擴展開發人員
可能會想支持儘可能多的擴展

00:12:14.268 --> 00:12:17.804 
而要做到這一點
您應該

00:12:17.871 --> 00:12:19.873 
提供儘可能多的意見
及其可能帶來的結果

00:12:20.440 --> 00:12:21.708 
但是在這種情況下

00:12:21.775 --> 00:12:23.143 
您實際上會得到比剛纔的共享

00:12:23.210 --> 00:12:25.879 
更少的擴展
只能單一表示

00:12:25.946 --> 00:12:27.514 
比如電影或圖像

00:12:29.183 --> 00:12:30.918 
所以我們在iOS 9中
添加了新的功能

00:12:32.986 --> 00:12:37.524 
您也可以選擇通過添加
NSExtension 

00:12:37.591 --> 00:12:38.559 
激活詞典版

00:12:38.792 --> 00:12:40.827 
把新的擴展名信息info
和plistu

00:12:41.328 --> 00:12:42.429 
設置爲兩個之後

00:12:43.130 --> 00:12:46.767 
您的擴展就會出現
即使

00:12:46.834 --> 00:12:49.069 
主機應用程序共享
圖像和電影

00:12:49.136 --> 00:12:51.905 
即使
您只關心電影或圖像

00:12:54.241 --> 00:12:56.543 
如今 
這些都是高一級的激活規則

00:12:57.177 --> 00:13:00.547 
但是我們也支持
激活只有謂詞的規則

00:13:01.882 --> 00:13:04.284 
再次
謂詞可以是非常簡單的

00:13:04.351 --> 00:13:05.886 
但也非常強大的 
像這裏這個一樣

00:13:06.787 --> 00:13:08.555 
我就不贅述了
現在

00:13:08.655 --> 00:13:10.624 
我們可以
參考應用程序擴展開發者指南

00:13:10.691 --> 00:13:11.925 
去了解更多信息

00:13:17.397 --> 00:13:20.167 
接下來
我們來談一談圖標擴展

00:13:23.036 --> 00:13:23.871 
正如我前面提到的

00:13:24.004 --> 00:13:26.807 
分享擴展
代表您的應用程序

00:13:26.874 --> 00:13:28.509 
它是一個共享表中的
Web服務

00:13:29.276 --> 00:13:31.979 
因此 
我們只需使用您的應用程序圖標

00:13:32.045 --> 00:13:33.714 
或在共享表中的

00:13:33.780 --> 00:13:35.082 
包含應用程序圖標的其他圖標

00:13:35.148 --> 00:13:37.150 
所以
不需要做額外的工作

00:13:37.217 --> 00:13:38.185 
對您來說

00:13:41.488 --> 00:13:44.491 
動作擴展
相反地需要模板圖像

00:13:46.627 --> 00:13:47.828 
我們需要兩個尺寸

00:13:47.895 --> 00:13:50.097 
一個用於iPad
一個用於iPhone

00:13:52.199 --> 00:13:53.734 
它們
被存儲在擴展套件裏

00:13:54.768 --> 00:13:57.671 
現在 
我來介紹一下模板是如何工作的

00:13:59.173 --> 00:14:00.974 
比如把它想像成一個模版

00:14:02.009 --> 00:14:04.211 
模板的圖像
是黑白的代表

00:14:04.711 --> 00:14:07.314 
具有透明的背景
然後

00:14:07.381 --> 00:14:09.316 
系統把那模板
與那黑與白的圖像

00:14:10.150 --> 00:14:14.188 
一起來創建實際的圖標
用於共享表

00:14:16.590 --> 00:14:17.424 
再次

00:14:17.858 --> 00:14:19.326 
需要兩種尺寸

00:14:19.693 --> 00:14:21.495 
60點的iPhone

00:14:21.995 --> 00:14:23.530 
和76點的iPad

00:14:25.832 --> 00:14:30.070 
不過我建議您在您的擴展中
使用圖像資源

00:14:30.237 --> 00:14:33.407 
並提供各種不同 - 
所有不同的圖標大小

00:14:33.507 --> 00:14:35.075 
這將用於應用程序圖標

00:14:35.742 --> 00:14:39.112 
這樣您的應用程序擴展
將更適應未來的需要

00:14:42.883 --> 00:14:45.052 
這麼多動作
能共享擴展

00:14:45.118 --> 00:14:46.820 
讓我們邀請伊恩
上臺說說

00:14:46.887 --> 00:14:48.121 
今天小插件的增強功能

00:14:57.331 --> 00:14:58.799 
謝謝索菲婭

00:15:00.701 --> 00:15:03.537 
您好我是伊恩·拜特
CoreOS工程師

00:15:03.837 --> 00:15:06.974 
現在我準備向您介紹
今天小插件的增強功能

00:15:08.575 --> 00:15:09.543 
首先快速回顧一下

00:15:10.143 --> 00:15:11.378 
您還記得去年

00:15:11.845 --> 00:15:14.982 
今天小插件
讓您對快捷信息一目瞭然

00:15:15.849 --> 00:15:18.252 
所以有了您的股票價格
和您的體育成績

00:15:18.685 --> 00:15:20.654 
它會告訴您
下班後您需要花多久

00:15:20.721 --> 00:15:22.389 
才能到家

00:15:24.424 --> 00:15:26.493 
所以今天
我要和您談談

00:15:26.560 --> 00:15:28.462 
如何提高您今天小插件

00:15:28.762 --> 00:15:30.898 
如何確保該模型的數據

00:15:30.964 --> 00:15:33.100 
始終是最新的
並同步到

00:15:33.200 --> 00:15:34.334 
您包含的應用程序

00:15:35.235 --> 00:15:37.804 
我還要給大家介紹一下
如何確保

00:15:38.005 --> 00:15:40.807 
您的視覺表現
是最新的

00:15:40.874 --> 00:15:42.976 
並也反映了
您的小插件的內容

00:15:44.011 --> 00:15:47.381 
然後
我會介紹一些通用的最佳做法

00:15:47.481 --> 00:15:49.850 
您可以
用於您所有的擴展

00:15:50.083 --> 00:15:52.152 
包括您的今天小插件

00:15:53.720 --> 00:15:54.788 
讓我們開始吧

00:15:55.322 --> 00:15:57.624 
這是Notification
 Center的景色

00:15:57.958 --> 00:16:00.260 
它填充的是今天小插件

00:16:00.861 --> 00:16:03.063 
您可以通過滾動
看到所有的小部件

00:16:03.697 --> 00:16:06.066 
如果您想了解更多信息

00:16:06.133 --> 00:16:07.968 
您可以在這裏看到

00:16:08.368 --> 00:16:09.469 
您可以簡單地

00:16:10.604 --> 00:16:11.572 
在部件上點擊

00:16:11.638 --> 00:16:15.142 
它會帶您到達應用程序
瞭解更多信息

00:16:16.143 --> 00:16:18.545 
現在 
我們應該如何促進

00:16:18.745 --> 00:16:21.515 
今天小插件
及其所包含的應用程序之間的這種互動

00:16:22.249 --> 00:16:25.252 
我們可以使用
URL schemes

00:16:25.919 --> 00:16:28.121 
現在我要告訴您一點點
關於這些交互使用

00:16:28.822 --> 00:16:31.358 
這些URL方案

00:16:31.425 --> 00:16:35.696 
和一些開放URL
API NSExtension環境

00:16:35.762 --> 00:16:37.631 
可以帶用戶進入應用程序

00:16:38.632 --> 00:16:41.535 
現在我們有一些很好的做法
想與你們分享

00:16:41.602 --> 00:16:44.771 
是關於控制這些
URL schemes的

00:16:45.706 --> 00:16:48.942 
首先我們非常希望您能使用

00:16:49.009 --> 00:16:51.612 
並且專注於您App的
註冊URL schemes上

00:16:52.212 --> 00:16:53.080 
太棒了

00:16:54.214 --> 00:16:55.916 
接下來您要使用的是

00:16:55.983 --> 00:16:58.085 
您可以使用系統
URL schemes

00:16:58.652 --> 00:17:00.254 
例如HTTPS

00:17:00.654 --> 00:17:03.023 
那麼接下來就會在
Safari上打開一個網頁

00:17:03.490 --> 00:17:06.960 
您也可以寫信息、打電話

00:17:07.361 --> 00:17:10.797 
或進行其他交互並且在系統組件中

00:17:10.998 --> 00:17:12.332 
開始進行有趣的工作流

00:17:12.833 --> 00:17:14.268 
那麼接下來告訴您應該怎樣做

00:17:15.368 --> 00:17:19.772 
您可以注意到
我正在展示一個表格

00:17:19.839 --> 00:17:22.209 
我選擇了一排索引路徑回調

00:17:22.276 --> 00:17:24.111 
因爲許多小部件只是簡單的表格

00:17:25.112 --> 00:17:26.313 
我們要做的第一件事

00:17:26.380 --> 00:17:29.016 
實際上是構建一個URL

00:17:29.583 --> 00:17:32.953 
我們接下來用我的App
URL scheme來做這件事

00:17:33.253 --> 00:17:34.821 
只是用來舉例

00:17:35.055 --> 00:17:37.925 
這將會把我們帶到我的主體App裏

00:17:38.825 --> 00:17:40.027 
接下來我們想要做的事是

00:17:40.127 --> 00:17:42.296 
調用開放的URL API

00:17:42.362 --> 00:17:47.768 
這個您可以在
擴展內容中找到

00:17:48.068 --> 00:17:50.571 
它可能與您的視力控制器相連

00:17:51.572 --> 00:17:54.975 
現在這跟在UI應用上的曝光有些不同

00:17:55.042 --> 00:17:56.276 
在UI應用中

00:17:56.343 --> 00:17:58.846 
它需要一個調回版塊

00:17:59.179 --> 00:18:02.349 
但是這個調回版塊有一個布爾參數

00:18:02.482 --> 00:18:04.117 
我接下來就講講這個布爾參數

00:18:05.519 --> 00:18:09.256 
需要將成功參數設爲是

00:18:09.489 --> 00:18:12.459 
如果我們要把你們帶進我的主體App

00:18:12.960 --> 00:18:14.828 
或者進入

00:18:15.095 --> 00:18:17.097 
已經註冊了
URL scheme的系統組件

00:18:17.698 --> 00:18:20.934 
如果我們不能夠做到
它將被設置爲否

00:18:21.502 --> 00:18:24.037 
就像用戶還沒有解鎖電話

00:18:24.104 --> 00:18:25.572 
和當電話還被鎖住的時候下拉

00:18:25.639 --> 00:18:27.474 
Notification 
Center

00:18:29.877 --> 00:18:31.812 
有很多辦法

00:18:31.912 --> 00:18:34.982 
可以跟容器應用互動和分享數據

00:18:35.048 --> 00:18:36.717 
今天我想講述

00:18:36.884 --> 00:18:37.885 
如何使用默認值

00:18:39.386 --> 00:18:40.320 
和您的容器應用

00:18:42.155 --> 00:18:43.423 
或Keychain項目

00:18:45.058 --> 00:18:46.093 
和框架數據

00:18:46.159 --> 00:18:49.296 
框架數據將潦草地進入共享容器

00:18:49.396 --> 00:18:52.065 
系統框架會以您的名義

00:18:52.766 --> 00:18:56.503 
把所有這些整齊地分成應用程序組

00:18:58.772 --> 00:19:00.307 
首先用戶默認

00:19:00.707 --> 00:19:02.543 
您可能知道用戶默認是什麼

00:19:02.609 --> 00:19:05.445 
如果您曾經開發過一段Cocoa
或Cocoa Touch

00:19:05.946 --> 00:19:08.248 
那裏有多個很小的設置數據

00:19:08.649 --> 00:19:11.919 
它們像小的字符串、數字、
布爾值和其他

00:19:12.186 --> 00:19:14.955 
它們影響您應用程序的設置

00:19:15.789 --> 00:19:18.225 
您可以分享這些設置數據

00:19:18.625 --> 00:19:20.194 
在您的容器應用程序

00:19:20.260 --> 00:19:21.528 
和您的擴展之間

00:19:21.828 --> 00:19:24.498 
通過使用NSUser默認初始值的

00:19:24.565 --> 00:19:26.934 
套件名稱的API

00:19:27.601 --> 00:19:31.672 
您將傳遞應用組的標識符
去完成這個API

00:19:32.272 --> 00:19:34.641 
現在記住這件重要的事情

00:19:35.042 --> 00:19:39.646 
這個API不僅僅
解鎖您容器應用的默認值

00:19:39.813 --> 00:19:42.583 
即您的標準用戶在您應用裏的默認值

00:19:42.983 --> 00:19:45.986 
它還產生一個新的默認套件

00:19:46.253 --> 00:19:49.289 
您的容器應用也能有其訪問權限

00:19:49.356 --> 00:19:53.293 
如果它也參與到應用組的話
所以這個非常重要

00:19:53.527 --> 00:19:56.463 
當您用這個API時
不但在您的擴展裏

00:19:56.663 --> 00:19:58.398 
而且在您的容器應用裏

00:19:58.465 --> 00:20:01.401 
當您想要改變這些設置項目的默認值時

00:20:03.437 --> 00:20:06.006 
我想講述的下一件事情是

00:20:06.073 --> 00:20:08.842 
您能用到共享容器的內部

00:20:09.710 --> 00:20:14.181 
當容器應用和它的擴展
都有其訪問權限時

00:20:14.748 --> 00:20:17.217 
第一是您能保持的是模型數據

00:20:17.885 --> 00:20:22.856 
模型數據是比如SQLite文檔 

00:20:23.190 --> 00:20:26.360 
甚至可能模型對象想要

00:20:26.426 --> 00:20:28.161 
持久地將核心數據持久保存爲預設文檔

00:20:28.228 --> 00:20:30.464 
您可以把所有這些保存在共享的容器裏

00:20:30.864 --> 00:20:32.332 
您的容器應用和它的擴展

00:20:32.599 --> 00:20:35.435 
都有訪問權限

00:20:37.271 --> 00:20:39.006 
您可以在那裏存入文件

00:20:39.139 --> 00:20:42.176 
剛剛索菲婭講述了
一個文字處理應用

00:20:42.543 --> 00:20:45.746 
可能這個文字處理應用
應該把它的文字文件

00:20:46.079 --> 00:20:49.082 
保存這個共享的容器裏
在那裏

00:20:49.483 --> 00:20:51.151 
擴展能修改它們

00:20:53.587 --> 00:20:54.421 
接下來

00:20:54.488 --> 00:20:57.558 
您也能存您想存的媒體項目

00:20:57.758 --> 00:20:59.159 
例如圖像、

00:20:59.226 --> 00:21:00.661 
錄影片段、

00:21:00.727 --> 00:21:01.962 
音頻文檔

00:21:02.029 --> 00:21:03.764 
和其他

00:21:03.830 --> 00:21:06.633 
它們有訪問您的容器應用

00:21:07.100 --> 00:21:08.302 
和它的擴展的權限

00:21:09.069 --> 00:21:11.805 
現在如果您把可以緩存的項目

00:21:11.872 --> 00:21:14.374 
緩存在共享的容器裏
可能不太好

00:21:14.441 --> 00:21:16.977 
我想
您更願意緩存在一個可以清除的地方

00:21:17.044 --> 00:21:19.713 
當您程序的運行空間
變得很低的時候

00:21:21.849 --> 00:21:26.220 
現在
來設置核心數據以使用共享的容器

00:21:26.653 --> 00:21:28.922 
我想給您演示一個小的樣本代碼

00:21:29.089 --> 00:21:31.692 
您可以把它應用於容器應用

00:21:31.758 --> 00:21:34.428 
和它的任何擴展

00:21:35.128 --> 00:21:38.966 
您可以簡單地通過模板

00:21:39.032 --> 00:21:40.634 
修改Xcode已經爲您產生的代碼

00:21:41.168 --> 00:21:43.904 
因此您要做的第一件事是
建立一個新的屬性

00:21:44.171 --> 00:21:45.672 
或者改變一個現有的屬性

00:21:46.106 --> 00:21:47.541 
在這種情況下 
我們叫它

00:21:47.608 --> 00:21:50.677 
安全應用組展示存儲URL

00:21:52.112 --> 00:21:53.847 
當然首先要做的是

00:21:53.914 --> 00:21:56.316 
拿到一個NS文檔管理員的實例

00:21:57.217 --> 00:22:01.522 
然後作爲文檔管理員 
我們將調用

00:22:01.622 --> 00:22:04.992 
容器URL對於安全應用組的標識符
然後再一次傳遞

00:22:05.259 --> 00:22:08.662 
我們之前已經設置好的
應用組標識符

00:22:09.997 --> 00:22:11.164 
在這之後 

00:22:11.231 --> 00:22:15.035 
我們將把存儲文件名字附加到URL

00:22:15.402 --> 00:22:18.272 
那個URL指向共享的容器

00:22:18.472 --> 00:22:21.742 
容器應用程序和擴展程序
都可以訪問它

00:22:23.243 --> 00:22:25.913 
現在我們需要用到這個存儲URL 
因此

00:22:25.979 --> 00:22:27.948 
我們要設置我們的永久存儲協調員

00:22:28.215 --> 00:22:29.283 
我們要用這些

00:22:29.349 --> 00:22:31.852 
首先產生一個存儲協調員

00:22:32.686 --> 00:22:34.588 
用我們的管理對象模型

00:22:35.355 --> 00:22:37.057 
然後我們將拿到

00:22:37.124 --> 00:22:39.259 
我們剛剛建立的那個
存儲URL的實例

00:22:40.527 --> 00:22:43.830 
最後我們將這個永久存儲

00:22:44.131 --> 00:22:47.467 
加入到存儲協調員中
用我們剛剛產生的URL

00:22:47.534 --> 00:22:49.102 
這將指向

00:22:49.169 --> 00:22:52.472 
後臺支持這個的
SQLite 文檔

00:22:52.873 --> 00:22:53.974 
在共享的容器裏

00:22:54.908 --> 00:22:56.910 
然後我們把它返回給調用者

00:22:59.246 --> 00:23:03.183 
最後我們實際想要設置管理對象語境

00:23:03.250 --> 00:23:06.286 
我們通過拿到永久存儲的協調員

00:23:06.920 --> 00:23:09.456 
產生一個管理對象語境

00:23:09.957 --> 00:23:12.259 
然後我們將設置這個協調員

00:23:12.326 --> 00:23:14.194 
成爲管理

00:23:14.494 --> 00:23:16.263 
對象語境的存儲協調員

00:23:16.730 --> 00:23:18.131 
然後返回它

00:23:18.599 --> 00:23:22.769 
這就是所有您需要做的
在您的容器應用和任何一個它的擴展裏

00:23:22.836 --> 00:23:24.471 
設置核心數據

00:23:24.705 --> 00:23:29.042 
來使用共享的永久存儲

00:23:29.309 --> 00:23:30.444 
在共享的容器裏

00:23:32.846 --> 00:23:37.351 
因此核心數據有可能
不是您的應用程序需要的

00:23:37.751 --> 00:23:40.621 
假設您正在用剛纔提到的預設文檔

00:23:40.687 --> 00:23:43.357 
來把您的模型對象

00:23:43.657 --> 00:23:44.958 
序列化到共享容器

00:23:45.592 --> 00:23:47.494 
在這一點上

00:23:47.561 --> 00:23:51.832 
您要考慮同步和訪問權限這些事情

00:23:52.199 --> 00:23:56.170 
在共享容器裏
因爲

00:23:56.603 --> 00:23:58.639 
潛在的您的擴展和您的應用

00:23:58.705 --> 00:24:01.141 
會企圖同時改變這些文檔

00:24:01.408 --> 00:24:03.310 
這對數據一致性不是件好事

00:24:04.344 --> 00:24:05.179 
所以

00:24:05.245 --> 00:24:08.282 
您實際上不得不使用排它鎖

00:24:08.582 --> 00:24:10.517 
您需要真的特別小心地

00:24:10.584 --> 00:24:13.420 
在共享容器裏的數據使用排它鎖

00:24:13.921 --> 00:24:16.390 
因爲一個擴展被清除
和並被當天暫停的同時

00:24:16.757 --> 00:24:20.127 
擁有一個排它鎖

00:24:20.761 --> 00:24:23.163 
對數據的一致性不是個好事情

00:24:24.264 --> 00:24:26.733 
那麼您需要怎麼做呢？

00:24:27.467 --> 00:24:29.436 
嗯關於任務斷言

00:24:29.503 --> 00:24:30.938 
我最好多講一些

00:24:31.338 --> 00:24:34.608 
任務斷言是您的擴展統治操作系統的

00:24:34.975 --> 00:24:37.244 
非常好的方式嘿

00:24:37.945 --> 00:24:38.979 
我正在做一些事情

00:24:39.046 --> 00:24:40.981 
您最好不要打擾

00:24:41.648 --> 00:24:43.250 
如果您想要中斷它

00:24:44.418 --> 00:24:46.386 
我喜歡拿某種回調函數

00:24:46.453 --> 00:24:48.455 
首先我能清理乾淨

00:24:49.690 --> 00:24:52.793 
記住擴展被暫停是非常具有侵略性的

00:24:52.860 --> 00:24:54.294 
當它們不再被應用

00:24:54.828 --> 00:24:57.231 
當用戶下拉進入

00:24:57.297 --> 00:24:59.099 
Notification
 Center

00:24:59.333 --> 00:25:01.502 
然後上拉來取消

00:25:01.935 --> 00:25:05.772 
我們可以在那時暫停
所有正在運行的擴展

00:25:06.373 --> 00:25:07.875 
所以那樣可能需要非常快速

00:25:09.576 --> 00:25:12.346 
您要快速地

00:25:12.446 --> 00:25:13.847 
保護序列化和另一個清理任務

00:25:13.981 --> 00:25:16.083 
用這些後臺斷言

00:25:17.284 --> 00:25:19.720 
我會演示給您看如何去做

00:25:19.786 --> 00:25:22.523 
它用NSProcess 信息API

00:25:23.590 --> 00:25:25.325 
您要做的第一件事是

00:25:25.425 --> 00:25:28.729 
拿到NAPRocess 信息實例

00:25:28.996 --> 00:25:31.765 
通過調用進程信息工廠的方法

00:25:33.901 --> 00:25:35.202 
接下來您將調用API

00:25:35.269 --> 00:25:38.772 
去調用一個結束的活動

00:25:38.872 --> 00:25:41.742 
我將向您介紹
如何設置此呼叫

00:25:44.111 --> 00:25:44.945 
第一個變量

00:25:45.012 --> 00:25:46.613 
您將通過這個方法得到

00:25:46.680 --> 00:25:49.116 
它是非常短的字符串

00:25:49.683 --> 00:25:51.285 
這個短字符串

00:25:51.351 --> 00:25:52.286 
是爲您

00:25:52.352 --> 00:25:53.987 
而不是爲操作系統的

00:25:54.321 --> 00:25:56.623 
它告訴您

00:25:56.690 --> 00:25:58.025 
要在被保護的任務內部做什麼

00:25:58.926 --> 00:26:00.561 
下一件事是

00:26:02.029 --> 00:26:04.965 
通過這個API得到一個回調函數

00:26:05.632 --> 00:26:08.869 
回調函數能在兩種方式之一中使用

00:26:09.136 --> 00:26:11.038 
我將和您走過第一種

00:26:11.538 --> 00:26:14.842 
第一它將被調用

00:26:14.908 --> 00:26:17.978 
如果我能以您的名義斷言
得到一個後臺任務

00:26:18.245 --> 00:26:20.080 
並把過期設定爲否

00:26:20.514 --> 00:26:23.083 
這意味着它對您是安全的

00:26:23.283 --> 00:26:26.920 
可以去執行一些序列化任務數據的

00:26:26.987 --> 00:26:28.589 
您不想被打斷的任務

00:26:29.790 --> 00:26:33.961 
既然任務斷言不能無限制地被拿到

00:26:34.628 --> 00:26:37.130 
當任務斷言快要過期的時候

00:26:37.197 --> 00:26:39.600 
它的頂峯就過去了

00:26:41.201 --> 00:26:44.671 
操作系統會再一次調用您的回調函數

00:26:44.872 --> 00:26:47.374 
這一次將過期設定爲是

00:26:47.908 --> 00:26:50.210 
這意味着您需要取消

00:26:50.277 --> 00:26:51.912 
無論什麼任務

00:26:51.979 --> 00:26:55.048 
並準備被暫停

00:26:57.251 --> 00:26:58.085 
現在

00:26:59.152 --> 00:27:01.555 
當您退出版塊時

00:27:01.622 --> 00:27:04.224 
我們將爲您釋放任務斷言

00:27:04.491 --> 00:27:06.460 
您不需要做任何事

00:27:07.895 --> 00:27:09.930 
還有第二種可以工作的方式就是

00:27:10.297 --> 00:27:14.434 
我們完全不能爲您獲得任務斷言

00:27:15.435 --> 00:27:17.638 
在這種情況下

00:27:17.704 --> 00:27:20.607 
我們將會立即調用您的版塊

00:27:20.908 --> 00:27:22.743 
把它的過期設爲是

00:27:23.710 --> 00:27:26.813 
您可能不希望使用排它鎖

00:27:26.880 --> 00:27:28.549 
在這個點上在分享容器中

00:27:28.715 --> 00:27:31.985 
因爲如果您被暫停了
就沒有保護您的東西了

00:27:33.587 --> 00:27:34.621 
這樣一來

00:27:35.522 --> 00:27:36.857 
您將會被清理

00:27:37.191 --> 00:27:38.792 
並做好暫停的準備

00:27:38.959 --> 00:27:40.827 
您只有幾秒鐘的時間

00:27:40.894 --> 00:27:43.363 
來決定是否徹底清理

00:27:47.868 --> 00:27:48.869 
因此

00:27:48.936 --> 00:27:50.470 
那是一個複雜的話題

00:27:50.537 --> 00:27:51.972 
但是我認爲有三件事

00:27:52.039 --> 00:27:55.309 
您需要搞明白
通過今天講的關於任務斷言的內容

00:27:56.443 --> 00:27:58.745 
第一是它們會被釋放

00:27:58.812 --> 00:28:01.215 
當您的代碼退出調用時

00:28:02.082 --> 00:28:05.485 
一開始我們就執行一個任務斷言
如果一切順利的話

00:28:05.552 --> 00:28:08.288 
我們把過期設爲否
然後

00:28:08.355 --> 00:28:10.390 
我們會爲您保持這個任務斷言

00:28:10.724 --> 00:28:13.327 
直到您的代碼退出版塊範圍

00:28:16.530 --> 00:28:17.998 
第二個需要記住的是

00:28:18.065 --> 00:28:19.299 
您有可能需要

00:28:19.366 --> 00:28:22.336 
重新進入並執行您的調用

00:28:22.402 --> 00:28:25.205 
來通知您關於過期的信息

00:28:25.839 --> 00:28:28.575 
再次我們可以再一次調用您的版塊

00:28:28.642 --> 00:28:31.778 
將其過期設爲是
來給您一個提醒

00:28:31.845 --> 00:28:34.181 
這個任務斷言將要過期

00:28:34.248 --> 00:28:35.682 
您應該去清理

00:28:36.984 --> 00:28:37.818 
最後

00:28:37.918 --> 00:28:41.121 
您的擴展並不總是可以進行任務斷言

00:28:41.522 --> 00:28:44.525 
有時您調用之後 

00:28:44.591 --> 00:28:47.227 
過期會立即被設成是
您調用的版塊將會按那種方式運行

00:28:47.294 --> 00:28:51.665 
而且您沒有機會去執行一些關鍵操作

00:28:51.732 --> 00:28:53.567 
您需要做好準備去處理這些情況

00:28:54.401 --> 00:28:55.402 
因爲它們確實會發生

00:28:57.004 --> 00:28:57.838 
接下來

00:28:58.138 --> 00:28:59.339 
這些任務斷言

00:28:59.406 --> 00:29:01.775 
僅僅保護
版塊範圍內的代碼

00:29:02.109 --> 00:29:04.945 
因此它們一般被用於簡單的事情

00:29:05.012 --> 00:29:06.480 
例如快速序列化

00:29:06.547 --> 00:29:07.681 
和一些同步的內容

00:29:08.382 --> 00:29:11.785 
如果您需要與另一個工作序列協同

00:29:11.852 --> 00:29:13.420 
您該怎麼做？

00:29:13.954 --> 00:29:17.024 
因爲您知道任務斷言

00:29:17.090 --> 00:29:18.325 
是在那個調用版塊範圍內的

00:29:20.894 --> 00:29:23.197 
那麼調用版塊

00:29:23.263 --> 00:29:25.032 
必須與其他序列中受保護的工作同步

00:29:25.365 --> 00:29:26.200 
例如

00:29:26.266 --> 00:29:29.136 
如果在主線程中

00:29:29.703 --> 00:29:32.773 
您想保護一些東西
那麼您需要確定

00:29:32.940 --> 00:29:36.310 
調用版塊沒有退出原始保護範圍

00:29:36.376 --> 00:29:39.112 
在這個工作完成之前

00:29:39.980 --> 00:29:42.683 
這裏我用一個例子展示如何

00:29:43.250 --> 00:29:47.054 
在板塊中通過調用異步到主線程上

00:29:47.621 --> 00:29:50.090 
執行將會從版塊中退出

00:29:50.457 --> 00:29:53.460 
很可能在進行之前
暫停就會生效

00:29:53.994 --> 00:29:55.062 
完成

00:29:55.362 --> 00:29:56.296 
太糟糕了

00:29:56.964 --> 00:29:58.966 
因此在這種情況下
您的版塊

00:29:59.032 --> 00:30:02.803 
需要通過發送同步或信號

00:30:02.870 --> 00:30:06.340 
或者無論哪個您在隊列裏選擇的方法

00:30:06.640 --> 00:30:08.942 
來記住在您分配去另一個隊列裏時

00:30:09.510 --> 00:30:11.578 
它是工作的

00:30:11.645 --> 00:30:14.114 
它不是必須爲主隊列
需要被取消

00:30:14.348 --> 00:30:18.418 
因爲我們可能會同時賦值過期變量
來回調您的模塊

00:30:18.785 --> 00:30:20.521 
在這種時候

00:30:20.587 --> 00:30:24.324 
您需要清理您正在做的事情
跳出回到程序模塊 

00:30:24.591 --> 00:30:26.226 
退出釋放斷言任務

00:30:29.730 --> 00:30:31.732 
實際上您這樣做是安全的

00:30:31.798 --> 00:30:34.401 
因爲這個回調函數

00:30:34.468 --> 00:30:36.003 
正在私有系統隊列裏執行

00:30:36.370 --> 00:30:37.504 
您不會產生死鎖定

00:30:37.571 --> 00:30:39.406 
因爲我們不會往那裏回調

00:30:42.075 --> 00:30:43.810 
現在這已經很多了

00:30:44.645 --> 00:30:45.579 
我明白

00:30:47.614 --> 00:30:48.682 
從這裏繼續

00:30:50.884 --> 00:30:53.287 
在我們新的多任務的世界裏

00:30:53.687 --> 00:30:55.556 
我們現在碰到很多情況

00:30:55.923 --> 00:30:59.092 
在您的擴展和包含的應用程序

00:30:59.159 --> 00:31:00.594 
同時執行的時候

00:31:01.195 --> 00:31:02.029 
這意味着

00:31:02.095 --> 00:31:04.665 
如果什麼事情在您所包含的
應用程序裏發生

00:31:04.965 --> 00:31:06.967 
這件事改變了您數據模型的狀態

00:31:07.701 --> 00:31:10.771 
潛在的是您的擴展可能就

00:31:11.271 --> 00:31:13.373 
不會和模型的狀態同步了
這是不好的

00:31:14.107 --> 00:31:16.977 
因此有一種您可以用來保持

00:31:17.044 --> 00:31:18.879 
每個人在同一個狀態的途徑

00:31:18.946 --> 00:31:21.148 
就是進化Notification
center

00:31:21.348 --> 00:31:22.182 
API和

00:31:22.249 --> 00:31:24.651 
NSNotification
Center非常相像

00:31:25.319 --> 00:31:27.988 
但它更加簡單

00:31:28.055 --> 00:31:30.023 
它適用的用例數量更小

00:31:30.424 --> 00:31:32.759 
對於您的包含的應用和它的擴展來說

00:31:33.794 --> 00:31:35.028 
例如今天

00:31:35.095 --> 00:31:36.129 
我們將向您展示

00:31:36.196 --> 00:31:38.098 
如何用它去暗示您的擴展

00:31:38.398 --> 00:31:39.466 
去重新加載模型

00:31:40.434 --> 00:31:41.435 
以下是您要如何去做

00:31:42.102 --> 00:31:44.004 
第一在那個包含的應用裏面

00:31:44.371 --> 00:31:45.639 
您要取得

00:31:45.706 --> 00:31:46.673 
一個進化

00:31:46.740 --> 00:31:48.909 
Notification 
Center 的實例

00:31:48.976 --> 00:31:50.544 
您將調用CF

00:31:50.611 --> 00:31:52.412 
Notification
Center

00:31:52.479 --> 00:31:54.114 
拿到進化 
notify Center

00:31:54.948 --> 00:31:58.819 
然後您將傳遞這個通知的實例

00:31:59.119 --> 00:32:01.688 
給CFNotification
Center發佈通知

00:32:03.223 --> 00:32:06.260 
下一件您要做的事是挑揀出一個字符串

00:32:06.393 --> 00:32:08.962 
這個字符串將用來代表您的通知

00:32:09.363 --> 00:32:11.565 
您會在您包含的應用裏

00:32:11.932 --> 00:32:15.802 
用它和任何一個擴展去觀察這個通知

00:32:16.770 --> 00:32:17.971 
然後您要傳遞是

00:32:20.641 --> 00:32:21.942 
在您的擴展裏

00:32:22.009 --> 00:32:24.211 
您將再一次用它去得到一個

00:32:24.278 --> 00:32:26.613 
進化Notification
 Center 的實例

00:32:27.648 --> 00:32:28.949 
您將把這個

00:32:29.016 --> 00:32:29.850 
傳遞給

00:32:29.917 --> 00:32:31.818 
CFNotification
Center的觀察者

00:32:31.885 --> 00:32:35.088 
這個準許您去觀察這個通知

00:32:36.290 --> 00:32:38.559 
下一件您想做的事

00:32:38.625 --> 00:32:40.027 
是傳遞一個回調模塊

00:32:40.460 --> 00:32:43.096 
這是回調模塊正在被執行的樣子

00:32:43.463 --> 00:32:45.132 
當系統注意到

00:32:45.265 --> 00:32:47.601 
這個通知被髮送了

00:32:48.802 --> 00:32:50.637 
您想要傳遞那個短字串

00:32:52.573 --> 00:32:54.875 
最後立刻交付

00:32:56.009 --> 00:32:58.912 
這能確定所有事情都始終保持最新

00:32:59.146 --> 00:33:01.849 
並讓您的擴展內部的模型重新加載

00:33:01.982 --> 00:33:04.284 
在包含的應用傳遞這個暗示的時候

00:33:04.852 --> 00:33:08.021 
現在記得我叫它暗示
因此您可能

00:33:08.088 --> 00:33:09.823 
不想用這個去協調

00:33:09.890 --> 00:33:13.126 
您的擴展和您包含的應用之間的鎖

00:33:13.594 --> 00:33:16.830 
因爲它不總是保證

00:33:17.097 --> 00:33:18.565 
您的擴展

00:33:18.632 --> 00:33:20.834 
能收到這些通知

00:33:25.172 --> 00:33:28.075 
這就是如何保持您的模型始終最新

00:33:28.342 --> 00:33:29.376 
如何保持

00:33:29.443 --> 00:33:31.678 
您的小工具的視覺展示最新？

00:33:32.045 --> 00:33:33.680 
下一步我將告訴您

00:33:34.615 --> 00:33:37.150 
我要用的這個叫做後臺刷新

00:33:39.486 --> 00:33:42.122 
後臺刷新是一個系統

00:33:42.189 --> 00:33:44.858 
它和您的小工具一起工作
來保持它最新的途徑

00:33:44.925 --> 00:33:47.594 
去保持視覺展示的最新狀態

00:33:49.730 --> 00:33:50.564 
再一次

00:33:50.631 --> 00:33:52.833 
我們回到Notification
Center

00:33:52.900 --> 00:33:54.835 
在這裏
您能看到我們的股票小工具

00:33:55.169 --> 00:33:58.405 
股票小工具
顯示的是最新的股價

00:34:02.643 --> 00:34:08.649 
在一天裏蘋果的股票變化了
會發生什麼呢？

00:34:09.349 --> 00:34:12.786 
嗯這個通知

00:34:12.853 --> 00:34:17.123 
可能將被髮射到您的手機
同時包含的應用程序

00:34:17.190 --> 00:34:19.293 
可能被希望做一些事情

00:34:20.393 --> 00:34:23.864 
您的小工具視覺上的表現

00:34:23.931 --> 00:34:24.898 
可能改換

00:34:25.899 --> 00:34:26.967 
不幸的是

00:34:27.034 --> 00:34:28.302 
我們會注意到

00:34:28.368 --> 00:34:31.438 
小工具現在和股價不一致了

00:34:31.505 --> 00:34:33.774 
它顯示$130.12

00:34:33.841 --> 00:34:36.243 
而實際應該是$132.12

00:34:36.877 --> 00:34:37.844 
我們如何修補呢？

00:34:37.978 --> 00:34:40.781 
我們如何確定我們的視覺展示

00:34:40.848 --> 00:34:41.681 
總是最新的呢？

00:34:42.516 --> 00:34:44.618 
嗯對初學者 

00:34:44.685 --> 00:34:47.420 
系統將隨機地刷新這個內容

00:34:47.754 --> 00:34:50.123 
它將和小工具對話

00:34:50.190 --> 00:34:51.123 
去看看是否需要更新

00:34:51.190 --> 00:34:52.292 
而不必去下拉

00:34:52.359 --> 00:34:54.161 
Notification
 Center

00:34:55.161 --> 00:34:58.832 
每一個今天小工具的視圖控制器
都符合

00:34:58.899 --> 00:35:00.467 
NC 小工具的提供

00:35:01.235 --> 00:35:04.004 
如果小工具的視圖控制器

00:35:04.438 --> 00:35:05.539 
實現了授權方法更新

00:35:05.606 --> 00:35:08.976 
它將參與到這個系統裏來

00:35:09.076 --> 00:35:10.377 
現在我將向您展示如何來完成

00:35:11.879 --> 00:35:13.780 
我們要做的第一件事

00:35:13.847 --> 00:35:17.150 
是在我們的今天小工具視圖
控制器加小工具

00:35:17.551 --> 00:35:20.521 
來處理程序執行更新

00:35:20.721 --> 00:35:22.456 
以符合NC小工具的提供

00:35:23.991 --> 00:35:26.727 
第一步我們將刷新模型

00:35:27.227 --> 00:35:29.429 
這能爲我們做一件事

00:35:29.496 --> 00:35:30.797 
一件非常重要的事

00:35:31.098 --> 00:35:34.201 
它會告訴我們模型裏是否有變化

00:35:34.268 --> 00:35:35.636 
而這個變化

00:35:35.702 --> 00:35:39.540 
將實質影響小工具的視覺展示

00:35:40.607 --> 00:35:41.975 
如果有變化

00:35:42.042 --> 00:35:43.944 
我們會告訴視圖階層

00:35:44.011 --> 00:35:45.212 
它需要重新畫圖

00:35:46.647 --> 00:35:49.116 
最後我們在裏面

00:35:49.183 --> 00:35:52.052 
會拿到傳遞給我們的完成處理程序

00:35:52.553 --> 00:35:54.955 
如果有視覺上的變化

00:35:55.289 --> 00:35:56.657 
我們就會傳遞新的數據

00:35:57.491 --> 00:35:59.960 
如果沒有實質性的變化

00:36:00.027 --> 00:36:02.496 
影響到我們小工具的視覺展示

00:36:02.563 --> 00:36:04.264 
那麼沒有數據將被傳遞

00:36:04.698 --> 00:36:07.067 
這會讓我們的小工具在

00:36:07.134 --> 00:36:08.936 
Notification 
Center 裏

00:36:09.002 --> 00:36:09.937 
是一個好公民

00:36:10.003 --> 00:36:12.372 
因爲在這一點上
我們暗示操作系統

00:36:12.439 --> 00:36:14.208 
它不需要擴展任何資源

00:36:14.575 --> 00:36:17.344 
去更新我們的今天小工具的

00:36:17.744 --> 00:36:18.879 
視覺展示

00:36:20.380 --> 00:36:23.050 
既然我們已經做了這個
我們的小工具已經被更新了

00:36:23.383 --> 00:36:25.986 
您會注意到股價是正確的

00:36:31.291 --> 00:36:32.993 
下一個

00:36:34.194 --> 00:36:36.897 
網絡擴展是短暫的目標

00:36:37.030 --> 00:36:38.465 
是真正的短暫的過程

00:36:38.532 --> 00:36:39.666 
它們來來去去

00:36:39.733 --> 00:36:41.935 
記住我談的是用戶下拉

00:36:42.002 --> 00:36:43.203 
然後迅速地向上劃回

00:36:43.837 --> 00:36:46.139 
這對於一些花時間的事
可能是場浩劫

00:36:46.206 --> 00:36:48.442 
例如網絡會話

00:36:48.976 --> 00:36:53.146 
小工具可能會調用雲服務

00:36:53.213 --> 00:36:56.316 
還有一些網上其他事情
以便進行處理數據

00:36:56.984 --> 00:36:58.452 
那麼我們如何處理這種情況呢？

00:36:59.419 --> 00:37:00.988 
嗯我建議您

00:37:01.054 --> 00:37:03.524 
嘗試用NSURLsession

00:37:03.590 --> 00:37:04.625 
後臺會話

00:37:05.025 --> 00:37:06.093 
這些是什麼？

00:37:06.760 --> 00:37:10.163 
這些是任務被執行的網絡任務

00:37:10.230 --> 00:37:12.499 
是以您的名義被系統執行的

00:37:14.768 --> 00:37:18.338 
更新和事件會被快遞到您的擴展

00:37:18.405 --> 00:37:20.107 
只要它還保持活躍

00:37:20.774 --> 00:37:23.544 
但是如果您的擴展被暫停或清除了

00:37:23.610 --> 00:37:25.179 
或因爲什麼原因電話被掛掉了

00:37:25.245 --> 00:37:27.781 
用這個關鍵系統

00:37:28.782 --> 00:37:33.453 
或這個系統的部件包含的應用

00:37:33.520 --> 00:37:35.489 
來接管錯誤和處理事件
以它的名義

00:37:36.557 --> 00:37:38.025 
我將展示如何在您的擴展裏設置

00:37:39.092 --> 00:37:40.394 
首先

00:37:40.727 --> 00:37:42.896 
您要創建

00:37:42.963 --> 00:37:45.365 
一個NSURLSession
配置後臺會話

00:37:45.799 --> 00:37:48.836 
用標識符目標配置

00:37:49.570 --> 00:37:50.737 
哦對不起用方法

00:37:51.538 --> 00:37:55.309 
再一次跟隨模式

00:37:55.375 --> 00:37:58.412 
您要創建一個標識符

00:37:58.745 --> 00:38:00.981 
它會被正在參與這個後臺會話的

00:38:01.048 --> 00:38:03.417 
擴展應用和包含應用使用到

00:38:04.218 --> 00:38:05.586 
像我們這種情況
我們在用

00:38:05.719 --> 00:38:07.654 
com.example.my 
下載會話

00:38:08.989 --> 00:38:10.090 
下一件事

00:38:10.157 --> 00:38:13.527 
您要在會話的配置中

00:38:14.027 --> 00:38:15.963 
建立一個分享的容器標識符

00:38:16.463 --> 00:38:18.131 
不然的話您將有很大

00:38:18.198 --> 00:38:21.101 
您的所有會話都可能在我們調試的時候
因爲不合法而被退回

00:38:21.168 --> 00:38:22.369 
如果您是剛開始一個任務

00:38:22.870 --> 00:38:24.171 
至少我知道我就做過這樣的事

00:38:25.372 --> 00:38:26.373 
下一步

00:38:26.907 --> 00:38:29.843 
您要創建一個
NSURLSession

00:38:30.511 --> 00:38:32.412 
傳遞這個會話的配置

00:38:32.846 --> 00:38:33.881 
到初始器

00:38:33.981 --> 00:38:36.250 
現在您注意到
我們正在和初始器用同一個授權表格

00:38:36.316 --> 00:38:39.486 
因爲完成處理程序形式的初始器

00:38:39.553 --> 00:38:42.623 
和後臺URL會話一起用

00:38:42.689 --> 00:38:44.391 
是不合法的

00:38:45.592 --> 00:38:48.095 
下一步
爲了舉例

00:38:48.161 --> 00:38:50.697 
我們要下載Apple.com 網站

00:38:52.132 --> 00:38:55.502 
我們要產生一個任務
並且消費它

00:38:56.103 --> 00:38:57.104 
現在我們的擴展

00:38:57.171 --> 00:38:59.573 
已經成功在後臺創建了
一個NSURLSession

00:38:59.640 --> 00:39:03.177 
並交給了系統

00:39:03.477 --> 00:39:06.380 
系統將用開始快遞事件去擴展

00:39:08.081 --> 00:39:11.218 
下一步在我們的包含應用中
正如我以前講的

00:39:11.285 --> 00:39:15.556 
我們需要準備它對任何情況

00:39:15.756 --> 00:39:19.092 
例如擴展被暫停或清除了

00:39:19.159 --> 00:39:22.596 
或被掛斷而不能處理

00:39:22.896 --> 00:39:25.399 
從系統和網絡部件發來的事件

00:39:25.899 --> 00:39:29.236 
我們用加入應用程序
對我們的UI應用授權

00:39:29.369 --> 00:39:33.273 
來處理後臺URL會話事件的方法來做

00:39:34.441 --> 00:39:35.809 
第一步我要做的

00:39:35.909 --> 00:39:38.745 
舉例來說

00:39:39.079 --> 00:39:41.748 
是確認一個標識符

00:39:41.815 --> 00:39:43.083 
就是一個我們期待的標識符

00:39:43.150 --> 00:39:46.653 
系統將導入
和NSURLSession

00:39:46.854 --> 00:39:51.058 
有關聯的標識符

00:39:51.191 --> 00:39:53.260 
對於您處理的應用授權事件

00:39:54.695 --> 00:39:57.831 
就像和擴展一樣

00:39:57.898 --> 00:40:00.901 
我們將設置一個
NSURLSession 配置項目

00:40:01.168 --> 00:40:03.403 
通過調用後臺會話配置

00:40:03.470 --> 00:40:05.639 
和標識符工廠的方法

00:40:07.140 --> 00:40:10.010 
我們需要再次設置分享容器標識符

00:40:11.578 --> 00:40:14.214 
然後我們需要調用
NSURLSession

00:40:14.481 --> 00:40:17.050 
傳遞這個分享的配置 

00:40:17.150 --> 00:40:19.620 
然後再次用授權形式的初始器

00:40:20.754 --> 00:40:23.690 
最後非常重要的

00:40:23.757 --> 00:40:25.259 
如果您不仔細看就會錯過的

00:40:25.959 --> 00:40:28.829 
是我們將保存這個完成出來程式

00:40:28.962 --> 00:40:31.532 
我們將把它保存回我們的屬性裏

00:40:31.765 --> 00:40:33.166 
當我們完成的時候

00:40:33.233 --> 00:40:37.504 
當我們處理
關於這個URL會話事件的時候

00:40:37.871 --> 00:40:39.006 
您也許會問

00:40:39.072 --> 00:40:41.575 
您如何知道什麼時候事件處理完成了呢
好我來演示給您看

00:40:43.110 --> 00:40:47.214 
在我們的NSURLSession
授權裏我們需要用這個方法

00:40:47.581 --> 00:40:50.617 
URL會話的確會完成
後臺URL會話事件

00:40:50.751 --> 00:40:52.953 
它將被調用到您的容器應用程序

00:40:53.020 --> 00:40:54.755 
或者在這個情況下

00:40:55.622 --> 00:40:59.359 
您的容器應用程序

00:40:59.426 --> 00:41:04.031 
會任命它去管理這些事件
去解決所有的URL會話事件

00:41:04.164 --> 00:41:06.300 
從後臺URL會話裏

00:41:07.134 --> 00:41:08.335 
我們要做的第一件事

00:41:08.402 --> 00:41:10.470 
是拿到這個配置對象

00:41:11.305 --> 00:41:12.706 
然後我們將確認

00:41:12.773 --> 00:41:15.742 
會話配置的標識符

00:41:15.809 --> 00:41:17.244 
是否匹配我們期待的標識符

00:41:18.946 --> 00:41:21.048 
然後我們將調用完成處理程式

00:41:21.114 --> 00:41:22.416 
就是我們早前保存的

00:41:23.851 --> 00:41:25.552 
併發行我們對會話的引用

00:41:26.086 --> 00:41:27.154 
這時我們完成了

00:41:27.621 --> 00:41:32.025 
我們成功地處理了

00:41:32.159 --> 00:41:35.329 
到我們的容器應用程式的任何事件

00:41:35.562 --> 00:41:38.899 
從我們先前
到擴展開始的系統組件

00:41:40.300 --> 00:41:42.636 
現在您能用這個技術

00:41:42.703 --> 00:41:45.439 
應對任何一種擴展類型
不只是今天小工具

00:41:45.506 --> 00:41:47.040 
這真是個偉大的技術

00:41:47.508 --> 00:41:49.977 
但是有一個地方您不能用

00:41:50.043 --> 00:41:52.079 
那是對您的
Watch OS 1 擴展

00:41:52.946 --> 00:41:55.015 
作爲代替

00:41:55.082 --> 00:41:57.417 
我們建議您用後臺任務斷言

00:41:57.618 --> 00:42:01.221 
去保護這些小的任務
您可以發現

00:42:01.288 --> 00:42:04.825 
更多關於WatchKit
的技巧和竅門

00:42:05.459 --> 00:42:08.195 
明天早上10點在Presidio

00:42:08.629 --> 00:42:10.330 
由夾克 貝倫斯主講

00:42:15.002 --> 00:42:18.338 
接下來
在您網絡交易時

00:42:18.405 --> 00:42:21.942 
您會不可避免地要挑戰您的憑證

00:42:22.676 --> 00:42:27.381 
如何能安全可靠地保護
您用戶的隱私

00:42:28.482 --> 00:42:31.218 
從而祕密地分享這些信息

00:42:31.752 --> 00:42:33.053 
在您的容器應用程序和擴展中

00:42:33.654 --> 00:42:36.757 
我們建議您用Keychain訪問組
對於這個

00:42:36.823 --> 00:42:38.425 
就像這裏演示的

00:42:39.359 --> 00:42:43.197 
您在您的擴展

00:42:43.597 --> 00:42:44.932 
和您的容器應用程序中設置

00:42:45.866 --> 00:42:48.535 
然後用這個您設置的標識符

00:42:48.602 --> 00:42:51.271 
就是您在您的容器應用程式中和
它的擴展中設置的

00:42:52.573 --> 00:42:56.543 
您簡單地傳遞這個標識符
作爲一個值

00:42:56.610 --> 00:43:01.248 
無論什麼時候您在Keychain
里加一個項目就可以

00:43:03.984 --> 00:43:04.885 
就像這裏演示的一樣

00:43:06.687 --> 00:43:07.588 
下一件事

00:43:07.821 --> 00:43:11.091 
告訴您這裏有一個自動查詢行爲

00:43:11.291 --> 00:43:14.094 
對採用Keychain 
API的詢問API

00:43:14.628 --> 00:43:16.396 
因此可靠項目的更新

00:43:17.130 --> 00:43:18.365 
可靠項目的刪減

00:43:19.032 --> 00:43:23.203 
可靠項目的複製
都自動做了正確的事情

00:43:23.337 --> 00:43:26.373 
就是通過尋找每一個
關於您的Keychain

00:43:26.440 --> 00:43:29.676 
因此您不用傳遞
Keychain 訪問組標識符

00:43:30.010 --> 00:43:32.412 
到這些API裏
這就是個需要記住的技巧

00:43:33.380 --> 00:43:35.616 
您可以發現更多關於這些API的內容

00:43:35.816 --> 00:43:38.485 
通過觀看安全錄像和
您的應用程式的錄像

00:43:43.857 --> 00:43:47.694 
總結一下
今天索菲婭講述了所有關於

00:43:47.761 --> 00:43:48.829 
動作和分享的擴展

00:43:49.396 --> 00:43:51.431 
關於它們意味着什麼

00:43:51.565 --> 00:43:54.801 
和如何才能更好地
利用它們去分享數據

00:43:54.968 --> 00:43:57.104 
與您的應用程序和網絡

00:43:58.805 --> 00:44:02.142 
她也演示瞭如何
把NS項目提供器

00:44:02.509 --> 00:44:04.845 
使用到它的最大可能

00:44:04.912 --> 00:44:08.849 
這是她
爲您分享數據類型而努力的工作

00:44:10.617 --> 00:44:14.488 
她也演示了
如何讓您的主程序擁有偉大的環境

00:44:14.555 --> 00:44:18.258 
對動作和分享擴展來說
您知道嗎

00:44:18.692 --> 00:44:22.162 
這將提升
您主程序的價值

00:44:23.163 --> 00:44:27.401 
然後我演示瞭如何加強
您的今天小工具

00:44:27.668 --> 00:44:31.738 
通過確定您的模板
和它的視覺展示

00:44:31.805 --> 00:44:33.574 
總是保持到最新狀態

00:44:35.442 --> 00:44:37.511 
然後我們演示了
一些

00:44:37.578 --> 00:44:41.515 
最佳的實踐
比如如何安全地分享祕密

00:44:41.582 --> 00:44:43.150 
和保護您客戶的隱私

00:44:46.153 --> 00:44:48.455 
那裏有一些相關的講座
我早些時候引用的

00:44:48.622 --> 00:44:51.892 
Watchkit的技巧和安全

00:44:51.959 --> 00:44:53.794 
以及您的應用程序

00:44:56.263 --> 00:44:58.966 
明天您能瀏覽關於更多的信息 

00:44:59.032 --> 00:45:01.902 
我建議您去讀App延伸項目導航
或者

00:45:02.002 --> 00:45:04.671 
去和我們的宣傳員科特 羅斯特交談

00:45:07.474 --> 00:45:08.342 
謝謝
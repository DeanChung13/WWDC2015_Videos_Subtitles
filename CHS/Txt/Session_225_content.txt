感谢您的莅临
欢迎进入第225章《NS集合视图的应用更新》
我的名字是特洛伊斯特芬我是来自AppKit团队的一名软件工程师
我很高兴今天可以为你们解答这个问题
有什么更新呢？
让我们来看看
NS集合视图在10.5版本的OS X里
已经存在一段时间了
它提供了一个便捷的方法
来显示格式的项目在用户的界面上
例如
在屏保的偏好设置面板上
我们有着不同格式的项目来代表不同的屏保
集合视图在这方面很擅长它能够显示相似尺寸的项目
假如您给集合视图一个原型
带有您图样树状的子目录
和共同负责管理它的视图控制器
集合视图将复制项目的...
原型
以自我繁殖来代表模型物
集合视图支持选择拖动和放下该项目
动画式重新全面布局格式这是一项非常便利的功能
现在进入iOS的UI集合视图
这和NS集合视图有莫大的关系
而且拥有多功能
我们可以在iPad的时钟App里
看到世界时钟的部分
UI集合视图 顾名思义
它用于显示项目集
其中包括每个项目
都会有一个完全是自己设计的树状子目录为代表
通常它运用UI集合视图来加载nib文件
UI集合视图支持混合种类的项目
您可以拥有不同的nib文件它们原型是不同的项目
所以您不是只有一个选项
UI集合视图支持
标头及注脚的观点
并把它们放在括号里
如果您把它和将项目组和成绩格式的能力一起用
会显得更方便好用
每个区段都可以拥有一个标头及注脚的观点
布局非常有柔性而且可以由客户自己定制
它会有一个处理大概90%的内定流程布局
来满足您的需要而且可以按客户的要求来定制
您可以把它的参数
调到您满意为止
UI集合视图也可以开启于
任意自定义开发的列印格式
UI集合视图可以运用任何
您可以实施的演算法列印格式
来应用在所显示的项目上
最重要的是UI集合视图是可以被调整的
它的智能设计
让它可以规划大量有潜力的项目
而它的智能也能在视图模型对象中让项目实例化
以及回收并重新使用已滑出视线的项目
来呈现进入视线范围的模型对象
这是很简便的
像是在iOS的其他项目
UI集合视图的设计让所有的屏幕
都由一个底层的分层式系统来驱动
这也使整个高帧速率的动画流程很流畅
在全方面地操作集合视图时
这可以给您一个很优良的动画般的效果
有了这些优良的特征
和开发者都已经熟悉的API
还有对iOS Apps广泛的应用和使用
我们觉得UI集合视图将会形成一个
良好的基础
于我们在ElCapitan所介绍的
全新且大大改良的NS集合视图中
这个全新的NS集合视图
承受了所有的UI集合视图
可扩缩性的形态
它将知道如何在需要的时候启动项目
以便只让少数的项目进行着
以便让它们可以重新使用或是再循环
而不是重新启动它们
这可以省下一些附加操作您可以根据组别来规划项目
您也可以为那些组别标上标头及注脚观点
由您所好
为它们标上任何您想要的
列印格式完全是个人化的
所以NS集合视图不再只是硬布线般认为它只是网格
您可以插入任何您想要的布局
我们可以处理不同大小的项目
项目可以以不同的种类出现
您也可以混合搭配流程式布局
尤其是可以把它处理成恰当的
就像先前一样外貌格式也是个人化的
您可以定义出您的子树状视图
为您想要的样貌
集合视图是您的空白画板
它让您可以规划您想要的
当动画在进行的时候
根据时间调制您将拥有绝对的控制权
我们来看看这是怎样做到的
当然我们不会只是把
UI集合视图的功能转移到OS X
我们更想要让全新的NS集合视图更适合
在家里的平台使用
其中一个我们配备在平台的科技是
NS集合视图一直都支持的拖拽及放下功能
但作为把UI集合视图布局API
输送到平台的一部分
我们在API上添加了几个功能
我们在这场讲座会结束之前会再提到这些功能
这些功能基本上能让任何布局
包括您自定义的布局
去...
執行识别候选放置目标的命中测试
我们稍后会再谈谈如何做到这一点
任何您设计的自定义布局都支持...
拖拽及放下的功能
就像是甲级布局一样
您运用Rubber Band拖拽选择
来拖拽各种项目
然后大批量地选择项目群
此选项像之前一样全面地支持这项功能
我们也修改了这个选项
并高亮了系统通知设备和传递设备
以便处理那些
大量...
高亮项目功能的准确性
因为有时候
会有很多想象不到的事情在平台上发生
您将使用全选功能或是取消全选功能
或是大批量选择
我们希望可以有效地把它处理好
API上有些许的调整
就像之前一样
项目还是在平台上通过视图控制器呈现
我们认为这是很好的机会
它让您能整齐地象限化
分割出您的代码
好让您的控制器代码和视图代码分开
以获得更好的代码整理
我们所加入的最后一个小修饰就是
让集合视图
可以自动寻找适合的nibs文件来运用在项目上
如果您只是惯例式地命名
而您所选择的nib文件名字与您所命名的
相似于您所要求的项目种类
从集合视图的角度看来
您根本不需要去帮您的项目在集合视图注册了
这些小小的代码可以为您省下不少时间
所以我们今天的目标就是
我想真正地深入这个话题
我想让你们准备好运用这个全新的集合视图
我们来看看当我们开始使用新的...
API 10.5版本时
是怎么装置其中一些全新的
NS集合视图
我们会学习关于
OS X和在iOS上有什么不同
我想 我们将会有小小的惊喜
给在座的各位
无论您是不是一个有经验的iOS开发者
把这个应用程式带到OS X
您也许曾经用过UI集合视图您对API很熟悉
您将会传递一些知识一些代码
我们会...
给您实用的资料
也可能您是前OS X开发者
您曾经为NS集合视图工作
您想要学习一些新的API模式并学习怎么运用它
在这之前我们将会给出足够的介绍
让您明白什么是UI集合视图API
可是就算您从来都没有接触过任何一个
我们会作充分介绍深入实用的了解
还有代码样本
在今天的话题会提到
您将能快速地学习和认知
以便迅速了解什么是全新的集合视图
在开始之前我们先对今天的概念做一个快速的讲解
我们需要知道关于全新的API的基础概念
然后我们会更深入地了解API是怎么操作的
哪个模式比较重要怎么启动
之后我们会做个总结
现在说说大纲
在运用旧的集合视图 OS X 10.10
NS集合视图或更早的版本时
您会设置您的集合视图的内容
以传递至阵列或是阵列控制部件
从而让您可以参考
怎么设定您的项目
和让您的项目给予原型一个模范
这就是NS集合视图的项目
那是视图控制器的子类
您基本上拥有一个视图控制器
和一个关联视图的子树
这将增加到您的集合视图
最后您的集合视图也许会拥有一个委托
如果您需要拖拽及放下的功能
那就是这个委托的责任了
因此您需要装置一个委托
在全新的API中将会有一些变动
您不像往常般给予内容排列
您现在需要做的
是在El Capitan安装一个数据源
这个集合视图数据源的规程其实很简单
在iOS里只需要两个做法
它将会是又快又简单的
就像是您在集合视图里装置您的模型一样
您还是需要一个委托就像之前一样
但是现在的委托将有机会拥有
参与选项和高亮度选择项目的功能
我们等下会详细地讨论这个话题
现在您需要的是给出一个
拥有的项目的nib文件
而不是只有模范项目
和一个联合视图的子树
您没有局限于一个项目像我所说过的
您可以混搭任何类型的项目
您可以拥有众多的nib文件每种类型的项目里
都可以选一个视图子树可以跟这个完全不同
最后一项最重要的是
我们采取布局功能
并把它分解
好让集合视图不会再硬布线
我们现在拥有像在iOS上的模组化的模型
所以您可以采取您原有的集合视图
分开原本链接住的布局
再把不同的布局附上
然而您的项目
将以不同布局和大小摆列算法
而这些布局是可以被完全切换的
您还可以在布局中
以动画变迁的方式更换布局十分简单
就像我们的代码样本一样
在自定式的布局里
您的布局可以被委托于您的集合视图
您可以实施几个可以被调整的选项
让您进行一对一的调整
如果您需要自定义改变您的布局的话
您也没有必要拥有子类型
让我们快速地看看布局的类别
在 iOS里 它们很相似但并非一模一样
在iOS里的NS集合视图布局
它是一个可以定义所有
API平面布局普遍形式的基本类别
NS集合视图网格布局
对OS X来说不但新颖且独特
而且它的功能其实是囊括了NS集合视图里
本来的资料就像是那种被调整的网格算法
万一您需要用到全新的API
它将被给予被调整的网格
不但可以让所有的项目大小一致
但是因为它们是有大小限制的
而且它们会将面积尽量填满
有时候很有用处
但终究还是个传统的布局
它还没有开始支持分区或标头及注脚视图的功能
然而和流式布局相比还是比较有弹性
我们会建议您先运用流式布局
在 iOS上NS集合视图流式布局其实和
UI集合视图流式布局...比较相似
它是一个强大的布局算法
而这个算法更能让
正文档案或CSS框达到流畅
您可能有面对过这些问题
总体来说您可以有不同大小的项目
而布局算法可以把它处理好
根据您所给的校准
它会把它们以横竖分配排列好
当它被横竖地分配好后
它将会被更新然后继续下一个任务
流式布局支持
有附加标题的分区和注脚视图的功能
概括来说它是很有用的
而且是可自定义的如果您需要子类处理的话
通常您会在流式布局开始
接着通过子类处理去得到您想要的
然而
您始终可以自地在NS集合视图布局里做子类
去得到一个完全自定义的设计
我们今天的代码例子将会做出演示
布局属性对象如果您是第一次看到它们
不是直接就能领会的
这是一个概念和iOS一样的概念
一旦您明白了它是什么一切就都非常简单了
想象您可以用
视图结构
还有其它各种各样的属性
然后它们从视图中封装开来
这就是布局属性的用处
这是一个直接的...结构例子
这个很直白 对吗？
您需要知道一个项目的位置和大小
但是它还带有其它附属的性质例如Alpha值
透明度
即Zindex用于从后到前排列
不管视图是否被隐藏
它可以称为布局状态
当您在使用状态并且给它拍快照时
这会让...
新的API导出那些还没有
实例化的项目
记住我们只是依赖程序去实例化
最终我们创造并分享了
这些布局属性的实例
布局API就负责把它们传播开来
最后他们会被应用到项目中
或者在布局时间的视图中
应用是为了
获得一个动画对象
然后过渡去一个新的境界
这就是它们的用途了
是非常简单地去归类项目
您现在可以试着去归类
每个组可以有...
标题
在上面
和一个页脚在下面
您也可以把它们放在旁边
如果您从这个方向去做
标题页脚和项目一起
组合成一个部分
第一个部分是部分0
这个部分里面的项目被标记为0, 1, 2...
这和iOS是一样的
下一个部分有标题和页脚
和项目放在一起这是部分1
在里面的项目也是被标记为
从0开始1, 2... 数字
很明显我们需要帮项目改名
先开始修改项目就像在iOS里一样
我们不止是需要知道项目索引
还要知道部门索引
这将影响现存的API
您会看到很多API因此发生改变
以Item AtIndex方法为例
它原来仅需要单个整数索引
但现在这么做还不够
我们还需要部分
我们还需要知道部分索引号
所以现在这样的API随我们喜好被修改
以便适应新的参数
NS索引路径
只是一个现存的值形
它让我们可以非常方便地
封装一个部分索引号
以及一个项目索引号它们被一起封装在一个值对象内
我们可以把它传递给一个集合或其它
很多您将遇到的API变化
都属于这种情况
仅仅是为了适应多个索引的变化
您仍可使用原来的API
如果您的集合视图只有一个部分
这是默认的情况
但如果您应用多个部分
我们建议您使用新的API
显然我们要开始进入细节内容了
我们将深入细节
并深入研读我们的示例代码
今天的示例是Cocoa幻灯片集合
它基本上是一个图像浏览器
它用一个集合视图
来展现一个图像文件的文件夹
以便您浏览
对于文件夹里的每个图像
我们将展示它的缩略图
和图像的各种信息
在布局上我们应用流水布局
这是系统自带的布局
并且我们将使用个性化的布局来展示如何应用它
我们认为
我们的每个图像都有一个关联的标签
我们将以此为由
来展示如何实现具有页眉和页脚的部分
我们能够根据每个项目的标签来分组
我们还支持选择
拖动和放下项目
我们将应用今天讨论的API来实现这些功能
为了把内容分成多个组成部分我们要把内容分为六个部分
以便一步一步演示
首先我们当然要把项目显示出来这总是好的
这是一个很大的障碍
只要您能显示出东西
您就可以实现更高级的功能我们将快速实现
然后我们看看如何把项目分组放到各个部分里
然后我们想看看如何处理它
当模型发生变化时图像也会相应增加或减少
我们应如何更新集合视图呢
我们看看如何正确实施
我们先看看如何处理部分并重点看看
如何处理拖放的程序代码
最后非常有趣的是
我们将看看如何实现个性化的布局
首先 为了显示项目
先要回到我们的这个模型
这又是一个新的API
我们还需要提供一个数据源
它将实现那两个必须实现的功能
我们需要提供一个项目尖
这足够简单然后是一个集合视图布局
这两个必需的方法
将赋予集合视图了解此部分...
有多少个项目的能力默认条件下我们只有一个部分
我们将只传递一个0作为部分的索引值
它将返回项目的数量
第二个方法的任务是
把项目
初始化
或者它将...
直接利用回收的项目
通过集合视图幕后的支持
并把它们返回到集合视图
在Cocoa幻灯片集合当中
我们需要理解的基本对象是图像文件
一个图像文件对象本质上是关联一个图像文件的URL
这个图像文件存在于我们扫描的硬盘里的文件夹中
它包含的信息有文件名显示于幻灯片的顶端
文件的类型
我们将以用户可阅读的描述方式
来显示原始图像的尺寸
然后当然是缩略图
您将在代码中
看到它们
一个图像集合拥有一个图像文件数组
一个图像集合还拥有一个标签数组
每个标签数组拥有一组图像
这些图像有同一个标签
还有一个无标签的图像文件数组同时存在
我们先来看看如何显示项目
我们到这台演示机器这儿来看看
让我们先运行它
让我们先打开一个Xcode项目
正如您所知道的东西已经基本齐全了
但我们窗口还没有集合视图
这是一个问题
我们看看...如何获得一个集合视图
进入这个...
资源类型
我们有一个浏览器窗口nib它关联着主窗口
让我们看看这个
我们进入这个库
然后查找集合视图
我们把它拖出来
我们调整它的尺寸使填满我们的窗口
对它运用约束
这将成为窗口内的主体文件视图
好
当我们拖出一个集合视图的时候
我们实际得到了什么呢
这很像是一个表视图
或一个轮廓视图
您实际上得到了一个集合视图
它内嵌在一个滚动视图里不像在iOS里
滚动视图是一个分离的东西
它是一个可滚动的文件视图的组成部分
您不能继承滚动行为
它通过组合来实现
我们有一个滚动视图 我说过
新的集合视图是用于底层运行的
我们将进入我们的检视器
然后我们在滚动视图上设置一曾的属性
来确定图层置底
现在我们深入看看集合视图本身
它是滚动视图的文件视图
在Xcode 7里有一个新的属性检视面板
它支持一些新的功能
我们选择一个我们希望使用的布局 例如流动
同时我们甚至可以设置它的属性
在这个示例程序中
我们实际上将有规划地在不同的布局之间切换
因此我们不需要用我们从nib中反归档的那个
但我们仍可以设置它
您可以...
做一些简单而有趣的东西例如设置背景颜色
一旦我找到了颜色面板
更有趣的事情是
您将关联那个数据源是吗
在此项目中我们的文件拥有者是一个对象实例
它是API浏览器窗口控制器的实例
我们通过一个窗口控制器来管理窗口
它也将成为我们的数据源
和集合视图的委托
我们从集合视图
关联到文件的拥有者
它将成为集合视图的数据源
它也是它的委托这样我们就可以实现拖放
我们把文件拥有者关联回集合视图
我们已定义了一个图像集合视图的出口
以便更容易找到集合视图
这就是我们基本上要对尖端做的事情
我们还创建了一个滑动尖端
它拥有一个容器视图
这个容器被一个滑块引用
我们的滑块类是集合的一个子类
NS集合视图项目类
通过这个子类我们可以添加功能
为我们自己的个性化控制器增加功能
根视图只是一个容器
这个容器的尺寸由集合视图的布局规则决定
然后 我们有控制器
文字字段...
有自动布局约束来设置它们
这与它们的容器相关
此布局将设置项目的框架
及此项目的根视图
余下的将由内置的自动布局来完成
我还使用了绑定
来...
连接...
一些数值
它们由这些文字域显示
他们通过滑块对象...
来显示
请记住一个滑块是一个集合视图项目
因此它也是一个视图控制器
视图控制器有一个可显示的对象
这里是我们连接项目的地方
连接它所显示的模型对象
对图像文件实例而言
我们可以读到这个实例的属性
我们只需要把我们的项目
关联到显示的对象
即它的图像文件随即所有的
这些控制器将自动显示
包括图像视图
因为我们将为新的API
使用一个独立的nib文件
为了使用集合视图我们要删除一些东西
这些东西是Xcode默认放进来的
我们的图像集合视图仍然有一个项目样品
我们需要清除它
让我们分离它
否则这将干扰我们正在做的事情
我们要删除项目样品
我们还要删除与之关联的视图
我们不需要这些
我们可以编译了差不多好了
如果我们看看这个警告我们发现一个提示
我们没有应用必需的数据源方法
只有两个我们很快地完成
我们进入浏览器窗口控制器
看这里就是数据源方法所在的地方
幸亏我提前标注了
我们把它拖进来
对于非部分的集合视图这非常简单
我们实施集合视图
定义这个部分里的项目数量
集合视图默认只有一个部分
我们返回图像文件的数量
它们在我们的图像集合内
我们还需要做的事情是
按需求定义这些东西
集合视图将传递集合视图项目
对于代表对象和索引路径
一个需要澄清的重要事情是
当我们使用集合视图时
也试图根据标示符号来构造项目
这令人费解实际上我们只是想
构造或循环使用现存的索引路径
我们只是把得到的索引路径传入
但它标识了这个项目
正如我所说的我们想关联代表对象的项目
以便找到相应的属性
针对这个项目实例
我们这里有...一个小方法
可以分解出索引目录和图像文件
使我们得以非常容易地
深入我们的数据模型
并找出相应的...
那个图像文件实例
这就是我们需要做的只需要返回该项目
到集合视图
如果我们足够勇敢我们可以试试编译并运行
看看它是否可以运行了
然后 我们将看到就是这个
默认条件下我们有一个窗口
指向并扫描库桌面 图片里的文件
它查找图像文件
并把通过集合视图项目来呈现它们
当我们滚动时那些移出视图范围以外的项目
实际上将按需要被初始化
甚至从那些从顶端移开的项目处回收重用
您可以改变大小使布局重构
然后我们可以免费获得很多东西
在此我把它称为包围布局
这是流式布局的一个简单的子类
我们还有一些已经实现了的个性化布局
我们可以设置布局...这些已经实现
通过导入一个不同的布局对象
到集合视图
我们可以通过标签来分类
但这还没有真正做什么
让我们回到幻灯片
看看需要做些什么来实现它
谢谢
开场的最佳办法是运行第一个示例
现在我们希望按照标签给图像文件分类
而不仅仅满足于在一个部分中显示它们
我们希望看到哪个图与哪个标签有关系
我们将要做的是每个标签
都有一组图像文件
它们按照某种规则排序
我们希望按照这个顺序显示它们
一个图像文件可以有多个标签这意味着
我们将在多个部分显示一个图像文件
这完全没有问题
也可能有些图像文件不会在任何部分显示
因此我们会创建一个无标签的图像部分
作为最后一个额外的部分
在此我们显示所有没有标签的图像文件
我们为每个部分添加了页头和页脚视图
因为我们想演示我们可以这么做
为您演示如何做到这一步
与项目类型相似
实例化页头视图和页脚视图
您会发现这非常容易
一般而言 一个页头或页脚实际是由一个集合视图
调用一个补充视图它不代表一个项目
但它是一种扩增
或一种把项目括入括号的方式
例如 标题和页脚
我们要把数据源设为可选集合视图
补充元素的视图种类
这是一种与众不同的方式
通过索引路径来...
调用页头和页脚
我们将回到演示机器那里
我们将把它们很快地关联起来
我们调用现成的数据源方法
并用更成熟的方法来代替它们
这些方法更适用于处理部分
它们就在这儿
我们将简要地解释一遍
现在我们需要告诉集合视图
有多少部分在它里面
如果标签分组选项
被选中这个属性将被设为开启
我们返回标签的数量
在图像集合里
这里加1因为我们想要一个
额外的无标签图像文件集合部分
对不起排在最后
非常简单
报告一个部分里面有多少个项目
以下两种情况有些不同如果我们以标签分组
基本上我们想说
如果某个部分与集合内的某个标签有关系
我们将返回这个数值
即属于这个标签...
的图像文件的数量
它与该部分相关
如果我们在无标签图像文件部分
最后我们会返回无标签图和其它图的数量
这非常直白
让我们看看它们
对于对象索引路径
这是同样的应用与以前一样它之所以好用
是因为我提取了
图像文件索引路径... 方法
这只是我个人使用的
实际上这并不适用
原因是它只看项目索引
而不是部分索引
让我们替换一个更聪明的版本
它知道我们有时需要通过标签来分类
如果我们以标签分组
假设此部分与我们的其中一个标签相同
我们就能在表里找到属于这个标签的图像文件
根据项目索引和部分索引
它们告诉我们哪个标签是我们正在处理的
让我们试着...建造并使之运行
我们可以根据标签来分组
现在我们已经根据标签来分组了
我拥有跟以前一样的...
布局
如果我们放大能看到
这是...
我们在一个nib里定义的页首视图
它基本上是一个容器
它有浅灰色的背景
并有一个可以让您输入任何东西的文本框
按照您的需要...
在这里
这是我们的页脚视图这是一种更深的灰色
告诉我们
我们已经创建了一个文本框
以告诉我们一个组里面有多少个文件
这就是所有应用部分所需要的东西
这与iOS基本相同
我省去的一方面啊 我省去了两个方面
就是创建附属视图页头和页脚
这里有一点代码
但这是平行的
最重要的是我们是否能调用
makeSupplementaryElementView...
makeSupplementaryViewOfKind
流式布局的种类定义的是
部分页头
和部分页脚
它将是其中之一
我们知道它是部分页头
我们将参考页头nib
我们将寻找页脚nib如果这是页脚
我们传入这个值作为标识
一旦我们拥有了视图我们就有了一个视图
而不是一个视图控制器
我们已找到并建立文本框的值
做我们想做的任何事情并把它返回给集合视图
最后我们需要做的是实现这些委托方法
布局可以定
最适合的尺寸
基本是页头显示的高度
以及页脚显示的高度
我们在每个案例中都有NSI
因为我们有一个垂直滚动的流式布局
只有高度很重要宽度会被自动裁切为
滚动视图的宽度
为了页头和页脚可以显示
我们必须这么做
就是这样
现在我们可以开始学习当我们的模型改变了如何更新
图像文件在文件夹里进进出出
我们需要告诉集合视图
何时我们的模型改变了
以便更新对用户所显示的东西
这与OS X的轮廓视图
被处理的方式很相似
基本上有四种运行模式
项目可以被插入
删除
和移动
从一个地方到另一个地方
或者项目可以被重载
这意味着项目还在那里
但属性被改变了您需要重新显示它
您需要重新收集...
属性信息
这些运行模式可以应用于部分和项目
对于熟悉iOS的人来说这是一样的
也可以插入 删除移动和重载部分
就像我所说的与基于视图的轮廓视图很相似
这意味着任何时候当模型发生改变
您的数据源或您代码的其它部分
凡是与模型有关的
必须去通知集合视图
并准确表述所发生的变化
我在这些索引路径里插入了项目
我把这些项目移除
以使它可以与模型同步
只要您做对了这非常简单
默认条件下任何您通知集合视图的变化
将马上显示 但您可以很容易显示一个动画化的改变
通过集合视图的动画设计
这是视图所拥有的一个通用代理对象
您可以通过它来实现一个动画化的更新
通常情况下当您要设置一个参数
当它通知布局动画那个项目已经被插入
这就我们在示范中所做的也正因为这样我们可以看见
项目动来动去的画面项目被插入 其他项目被迁出
以一种栩栩如生的方式
在我们Cocoa幻灯片集合的示范里
我们将看到影像文件夹的变化
每当出现变化 我们都会通知...
首先 我们立即更新模型然后在我们改变模型后
通知集合视图我们对模型所做的改变
图片档案可能会来来去去
它们可能被我们改变了
这些都是我们要处理的更新类型
我们要使用一个小的特性装置
一个基础的特性装置叫键值对观察
基本上就是提供一个方法去观察其它物件的特性
然后自动给予通知
这样您就可以知道自己该用什么方法来应对
我们的示范从头到尾都是键值对观察
让我们马上回到我们的示范机器
我已经让它开始运作
我们先运作我们的范例看看它可以做些什么
我现在准备开启桌面上度假图片的文件夹
而不是看桌面的图片文件夹
让我们假设我在度假时拍了些照片
去了些很棒的地方
在底下我有一个寻捡器窗口
指向我的桌面照片
我现在要从桌面照片中复制些材料
假装我去过这些地方
我会拖拽一些项目
到文件夹中
Cocoa幻灯片集合正在监督这些档案
它会发现当中的变化
并在它的模型中加入
项目和图片档案的例子
最后它会通知集合视图
现在图片档案已经添加让我们显示更多的项目
这种情况每次都会在动画方式中同步发生
我们可以拉出一个项目
取出档案
然后当它消失的时候
做一个更新的文件系统扫描时要注意变化
更新我们的模型和相应的更新
集合视图
这里的键值对观察技术已经相当不错了
使用运行轧机
最有趣的地方是您如何和集合视图对话
那么我们省略早前的只看最近的
您想看看这些在窗口控制器类底层的方法
处理插入的图片档案
在指数的路径这只是一些我们定义给自己用的
还有这里是我们和图片集合视图对话的地方
并用这些插入项目
在指数路径 API上我们基本上要做的就是弄清楚
好的到底什么项目的指数路径
会受到这个的影响？
哪里我们可以插入项目？
我们传递消息给集合视图
由于我们透过动画制作者通讯我们会收到动画的变化
其中重新布局是需要发生的
它会以平滑的方式出现并非一瞬间
如果您想 也可以让它即时发生可以省略这里
如果您想
要一个动画的回应和动画制作者的通讯
您甚至可以控制持续的时间
只要设定动画内容的持续时间便可
设定成和图片档案运转速度差不多
deleteItemsAtIndexPaths
这样就会有分类档案有插入部分 删除的部分
还有其他关于API的
为了要处理各个分类档案的来来去去
我们甚至有能力去
处理新添加的标签
还有被移除的标签
这大概就是这么一回事
所以分类和高亮显示在要与用户交流时是重要的
我们现在来更加仔细地分析它们
基本上分类和高亮显示都是
可以在视觉上有指示标准的
特別是高亮显示其实是一种过渡的状态
在途中令项目有可能成为被选择的或不被选择的
或用作放置目标
在这里有一个图示我们有一个项目
那里短暂地显示橙色当我不断拉过它们
它们就是分类的候选人
当它们确定被选择而不是高亮显示
我们可以从橙色边框来判断
但是之后它们会变成蓝色
就是说 OS X 是有高亮显示的项目的
这里和iOS是有点分别的
这里只有布尔数学的高亮显示功能
在桌面上我们需要更多的灵活性
从而能够形容不同的状态
高亮显示
有四种可能存在的价值
没有系统默认值意思就是不要高亮突出这些项目
您会想知道这些项目被选择了没
然后决定如何呈现它们
如果它没有被选择或突出
您会正常地显示它
如果项目是被高亮显示的
这意味它现在并没有被选择
但是我们在考虑要不要选择它
这要看使用者想要有什么用途比如 拉过项目
然后您想把它透过
高亮指示来呈现这完全是根据
您想怎样来设计您的UI
我们用橙色门框
围绕边边来显示
将被选择可还没有被选择
项目可以为了被取消选择而被高亮显示出来
这可以以shift拉拖动作来实现
和在搜寻器图标上的概观一样
基本上 这里的窍门是项目被选中
但您要压制展示通常选择的状态
您想要显示一些不一样的
为了要告知使用者
这个项目被选择了但我们在看怎能取消选择它
您想用平常的方法显示
这其实完全是看您想怎样
根据您的新iDesign
最后 一个项目可以被突出显示
并暗示它将是有可能被弃置的目标
虽然以我们今天的例子来说是不合理的
因为一个图像就是一个叶节点
我们真的没有理由
去将图像拉动到另外一个图像上
但是如果我们有一些东西更像是容器
就会合理很多我们会想指明那个容器
就是我要放置东西的容器
如果用户让鼠标指向当前点
这些都是在不同的亮点状态
正如我所说要记住的一样事情
现在所有的都有阶层备份
以全新的集合视图的成就
因此
它给您机会去利用阶层备份功能
一个更简单的方法去改变项目的外貌
无需做重绘
所以
CN阶层功能例如背景颜色 边框颜色
边框宽度 圆角半径您以前应该计算过这些
有了这个会很方便
因此 我们可以设置
一个项目的根源来观察阶层的背景颜色
对一些颜色
然后给它一个圆角半径激增成两行代码
我们已经有了一个快速的亮点指示
或选择指示
又简单又好
您不是必须用这个方法
这只是随意的要记着
我们现在在阶层备份的世界
什么时候要使用亮显？
很简单
任何时候您的亮点状态有所改变
在Swift您能做到这点
一个DidSetObserver条例
同样您也会看到
当选项被选中后布尔计算变为是或者否
您会综合考虑高亮显示状态和选中状态
然后决定如何在视觉上显示选项
根据您的用户界面风格
选中当然是我们要做的
我们希望用户能选中选项
这样他们才能通过拖放操作
或者用命令操作
在集合视图中
选项是组成选择的东西
它们可以被选中
Ns集合视图支持单次或者多次选中
就像以前一样
关键的问题是它是否可以被选中
如果您让它可被选中
您可以允许多次选中
或者强制只能选中一次
您还可以拒绝空选
这样集合视图就可以
始终保持至少有一个选项被选中
这些是比较标准的
它们也是在其它的AppleKitCollection
视图控制里常见的
例如表格视图或大纲视图
选中是由新的选择索引路径属性来追踪
在视图集合里
这是权威 表示在集合视图中的选中
而我们使用索引路径而不是项目 对吧？
因为项目来来去去
但该指数路径固定不变
一个项目如果它恰好被实例化
不知道是否是在选择的一部分
就像我提到过的
项目来来去去
集合视图是永远不变的
所以您总是要看项目索引路径看集合视图
来进行操作并且可以在索引路径选中选项
还可以取消选中或可以使用这些方法
您也可以直接设定选择索引路径
当您在iOS索引路径中选择项目时
您也可以让集合视图
以特定的对齐方式滚动显示选项
如果您想的话
我们经常要处理的是用户的选择
在iOS里委托代表有机会
来批准选中与取消选中
我们让API有点不同
再次因为我们希望
能够在处理大量操作时更有效率
现在我们有集合视图应该可以选中项目在索引路径
并且集合视图应该可以在索引路径取消选中
每一步都要使用一套索引路径作为参数
这些是计划的索引路径
就是我们要选中和取消选中
注意到这点是它们返回一套索引路径
而不是一个布尔
所以如果您想说随便做什么
集合视图会只发回我们已给您的一套索引路径
但是您在这里也有机会
返回一套不同的索引路径
您也可以做一条线如果您想的话
您也可以根据您想要的标准
您可以把细颗粒控制用于您选中的
或者某些情况下取消选中的选项
也有DidSelect和DeDeselect
选中委托方法
这样您就在对选择做过改变之后 找出事实
同样 对亮显委托有办法
批准并对这些改变作出反映
所以在索引路径对突出显示的状态做出改变
您可以返回一套索引路径
您可以控制细颗粒程度
用在委托的突出强调上
我们再来快速看一边演示机
幸运的是 时间关系
我已经写好了所有的代码并运行
我们现在只要到nib文件里去看
然后仔细来看集合视图
我们将确保它被标记为...
可选择的
我们将让空选择
而且我们会允许多重性选择
实施的其余部分是相当直接简单的
基于我们现在的理解
我们将停止构建和运行
现在我们可以点击项目和选择它们
我们因为想去展示说明的用途而选择
它们是可被选择的候选人
它们在被选择前以橙色去突出显示
当我松开触控板时
它变成蓝色就代表已被选择
而不再被突出
我们可以点击背景
清除选择
我可以单击并拖动整个项目
再来我们展示项目作为突出显示而成为被选择的
它们还没有被选择
但当我松开触控板時
它们已不再被突出
现在它们已被选定
正如我提到的在搜寻器的图案
如果您按住Shift键然后拖动选择
那便会变成反转的选择
这里是一个项目中选定的一个例子
然后这成为突出的取消选择
所以 尽管它们是被选择的
我们仍在亮点状态覆盖它
及我们如何在视觉上呈现出来
以及我们只是...
把它们以一般形式地呈现出来
与它们无边框
然后 当我松手该选择已被待发
现在 因为我可以选择我可以拖放东西
重新排序
这个很棒
一旦您有选中
就有很多...
整洁的事情可以做
由于这是所有实施一个非常普遍的方式
所以是不可知的不同的布局
大家可以去看看我们的自定义布局
因为它们执行所需的方法
我们也可以在我们的自定义布局里拖选整个项目
单击选择
并自动发生
因为它们符合在标准
NS系列视图布局API
这是一种很好的免费东西
甚至当我们在此节模式
流式布局让我们跨节地...
拖选
如此类推
这还挺整洁
这个可行
还有两样事情
我们将快速谈论拖拉及放置
这是很重要的支持点
由于老而被弃用的API
它并没有从根本上改变
但也有一些新的东西要了解
现在我们可以拖动选择的项目
然后如果您有一个集群项的选择或只是一个单一的项
您可以拖动它并移动它
集合视图因为您在拖动
计算候选目标在哪里放下
在此种情况下我们不允许放置在物品上
因为它们不代表容器
但我们允许项目之间的放置
这是我们要关注的新的东西
在OS X而不是在iOS上
所以拖放和放置和以前一样
由NS集合视图委托处理
它负责为您拖放和放置反应
该模型是很明显地类似NS大纲视图的API
它并没有基本原因让它变得很不一样
如果您看过拖放及放置大纲视图的例子
您会看到很多的实现有相同的概念
它基本与NSCollectionView的概念是一样的
如果您希望您的集合视图成为拖动源
这意味着项目可以被拖出来
您的基本职责是项目放在粘贴板上时
能请求集合视图
如果您想做一个拖放的终点
如果您想接受拖放您需要能够
估量所计划的拖放集合视图会呼叫您
说：我想... 我打算在这里
放置这些东西从粘贴板到目标位置
这是一个索引路径暗示一个空白
这个空白在选项之间在已命名的选项
前或者一个位置这个位置在已有的选项之上
如果您允许它作为一个容器
有一种操作
它们是标准的拖放操作
例如拷贝 移动等
您可以看这个计划您可以选择重写
这些参数比如我自己计划的
您其实打算用这个位置来放置
或者拒绝放置
您需要能够安排接受放置
这很相似但是用户已经执行了放置
而您需要完成
并且来相应地更改您的模型
并且来相应地更新集合视图
这个运作方式
归结于这些API您需要
像其他NS视图一样
您想注册
您渴望能被接受的拖放类型
因为集合视图一般不能分辨
您处理类型的对象
就您的模组而言
集合视图拥有拖放原始动作掩饰
对于本地和非本地拖放
这仅仅是基本的让您预先设定的
我支援复制和移动但不包括化名或类似的东西
您想预先设置
我们会在范例里示范
然后所需要的授权方法对应于
我在上一个幻灯片提到的责任
同样 您需要能够在纸板上编写物件
在现代的API上您能提供一个纸板编辑器
给在索引路径的物件
这允许您更得体地
处理多项目拖放
某些数据类型是纸板作者
在这个例子中
NS路径如果是绝对路径
您只需要退回路径作为纸板作者
它会自已在纸板上编辑
您或者可以在索引路径
实行编写项目
向纸板二选一
您也能完成目标
现在 再次选择拖放目的地
这里有一个验证授权放置方法
和接受...
授权放置方法来进一步简化它们
您会在代码示例看到那些被实践的
我们没有时间详细地去介绍那些代码示例
因为拖放在这是相当地涉及了
它的设计是.̆..
使您可以拖动项目
从一个应用程式到另一个有很多需要再做的
但有很多需要明白的基本技巧一旦您明白了这些概念
剩下的只是运作方式
您就可以明白今天的例子的全部
被多次讨论的编码内容
需要记住的一个重要的事情是
我们要弄清楚
并且处理好 
要在哪里进行拖放使用您的集合视图
当您开始得到
拖放目的地的委托信息时
值得说的是 嘿
我知道这是我自己发起的拖放
我知道哪个选项哪个索引路径会被拖放
这样我就可以更容易地处理相对于一般的情况
这个拖放可能来自这个系统任何地方的情况
我必须从粘贴板取出东西诸如此类
使用集合视图这让您可以告诉集合视图
您只是在从索引路径挪动东西
到这些新的索引路径中并且给您一个很好的动画
作为附加的好处
这样更好 更精致
相比与挪动那些选项然后 哦
我还得到别处重新插入一样的东西
然后重建这些东西
在集合视图中一个好用之处
就是拖放期开始于项目
在指引路径委托方法时
这是个可选的方法但是个好的地方
来获取那些索引路径隐藏它们到私立的属性
在您的... 数据源中
这样您将来可以找到它们并且说 哈
我可以更简单地处理这个并且您会发现
示例程序在那里也这么做
我想花点时间
向你们展示自定制界面这个改变更加有趣
我们来看一下
这是我们最后的任务
我们会考虑您需要做什么去调整现有的布局
比方说流式几乎满足了您所有的需求
但您想稍微调整一下让一切看起来都很完美
我之前就听过这种做法
或者
您想采用一个全新的自定义布局类型
就像我们现在
通过不同的
幻灯片布局一样
我们来看看要完成这个任务需要什么条件
调整现有的布局相对比较轻松
我们先看看这个变化
比方说您想列入流程布局级别
将项目的位置
稍微调整一下
把东西从这里拉到那里
您通过一个指令就可以做到但我们假设
您希望做一些您在现有的API基础上
做不到的事
这就是主要的方法
需要大家去了解
目前为止它跟iOS是一样的
矩形元素布局属性是非常普遍的API
集合视图的到来
为您提供一个矩形那是个矩形
在集合视图的内部坐标系统中
从基本上来说
这个矩形里面是什么
您必须返回
布局属性对象的排列
记住那是我们的
项目描述的包装
不依赖于真正的实例化项目
您可以返回项目的信息
如果您有... 页眉和页脚视图
或者其他附属视图适用于该领域
您必须了解那是什么
并返回那些描述
这显然
高度独立于您的布局算法
它可以是任何东西 对吧？
所以您穿梭于您自己的内部数据结构中
您想要发现如何真正高效地做到这个布局
那就是这种方法的责任所在
返回矩形中所有数据的描述
当集合视图第一次列出您定义的所有项目时
那就是核心部分
那就是它的来由
会出现这个说明项目的布局属性
在索引路径中似乎有些多余
但集合视图需要询问某一项目时
比方说向我描述该项目
那就是需要您做的地方
如果那个索引路径中没有项目您就没有返回
通常都会有如果它询问的话
这个功能会启动在您把东西从一个地方
移到另一个地方时
所以您也想要实现那个目标
结果需要跟第一种方法保持一致
然后会出现上下文的无效布局这是一种
普通的无效方法是由集合视图在上下文中触发的
如果您查看它的属性
检查它它跟iOS的情况一样
它描述改变了的项目
插入或删除的项目
可能集合视图在调整大小任何一种情况都可能发生
检查上下文属性让您有机会
尝试变得聪明和高效
这是一种先进的优化
正如您希望的
您把布局按照自己的想法
设置好以后使用
这是您的机会清除在布局记录的
内部状态中的无效数据
以及有调整时
您自己对它的描述
所以我们刚刚看到了流式布局
接下来我们一起实施
前面两种方法
布局属性返回方法
使用先进的方法
看看NS集合视图流式布局的提议
我们可以检查布局属性成品的状态
或者它们的排列
然后进行任何一种我们希望的改变
返回一组新的布局属性排列
或者单一的布局属性排列
那就是关于这个东西的介绍
只要您做出的改变不改变布局需要的空间
要是您想进行全新的自定义布局
就像我们所做的那样？
您可以直接将NS集合视图布局归为子集
将所有东西重新开始
比方说 如果您的类型和流式相似
您采用同样的方法就像我们刚
在上一张幻灯片中提到的那样
此外 您要能够
回答一下基本的问题比如
您需要的大小 宽度和高度去排列项目
是不是集合视图能够提供的？
基本上您只需要告诉集合视图
我的文件视图大小
这决定了您的滚动区域
要是边界改变的无效布局返回一个布尔值
在调整大小的过程中
集合视图将会触发这个功能
通常您会观察我的布局算法是什么？
我的布局是否受到重新调整大小的影响？
如果您是流式布局比方说 垂直界面
将所有东西排成行
或许您并不是非常在意
如果集合视图的高度发生改变 对吧？
那只是为您提供了空间而已
但是如果宽度发生改变您必须重新排列
比方说您可能在那种情况下返回是对的
这就是那种方法的作用
如果您修改流式布局
来获得您需要修改的空间
您真正需要进行那两项修改
即使是细微的自定义排列
然而这些方法在OS X上是全新的
我刚刚提到我们有能力去进行测试
拥有一个...
抽象的布局
去进行...
目标放置的测试
这是个很强大的新特性
您可以在任何一种自定义布局中进行设置
点击目标放置的布局属性是第一种方法
如果目标是一个项目那就非常直接
您将会返回一个属性布局属性实例
其代表的元素类型是项目
您在对一个项目进行放置
您插入所发现的
需要放置的项目的索引路径
然后您想
返回该项目的边界框
作为布局属性的框架
那非常简单
现在更有趣的情况是我们无需去处理
iOS中项目之间的间隙
如果您决定这个点应该进行测试
但它却在项目之间可您以通过
项目的序列号码去辨别间隙的位置 好的
这个介于索引6和索引7
您想返回项目间隙
那样用户可以在布局中在项目之间放置目标
您返回的元素类型是项目间隙
属性的索引路径是
间隙后的项目所在的索引路径
如果您还是在6和7之间您返回的索引路径是
该部分项目7的位置
其次 您返回的属性框架
间隙的边界框
集合视图将使用该边界框
去定义如何在那个矩形中规划
标准的指标
接下来的一种方法叫做索引路径前
项目间隙的布局属性
集合视图有时也需要这种方法
它也会询问特定的位置
要求您描述该间隙
所以这里我们返回一种
元素类型的属性项目间隙
它代表的元素类型是项目间隙指标
所以我们利用这个建立一个补充视图
那就是项目间隙指标的应用
您只需插入您所给予的索引路径
返回的是属性框架
作为该间隙的矩形
综合这两种方法
集合视图支持...
项目之间目标放置的指示
即使是任意的自定义布局
您自己的设计也可以做到相当整齐
我们简单看一下我们的自定义布局
以及它们如何实施
请看我们最后一个短片
请看这里左侧边栏
我们将代码进行分类
我们有一个代码组您可能想看一下
今天我们看一个例子
圆形布局
它很简单
我们在索引路径采用项目布局属性
在这里我们会询问某一特定的项目
这些是我们理论上能做的事我们将项目索引
从索引路径提取出来
那将定义我们距离圆圈有多远
我们利用那个想法去计算

那样我们计算出一个幻灯片理应的走向框架
那么最重要的一部分是这里
API是一个敏感的部分
您如何举例说明布局属性对象
获得一个与索引路径相关的
正确索引
您想小心用这种方式进行
我们会谈及...
布局的层次
获得相应的布局属性层次
基本上拥有这个API
可以让布局属性
NS集合视图布局属性层次
得以归类和延伸
或许您有一些真正的在iOS的自定义布局
需要与其它属性一起使用
或者记住其它信息关于已经陈列的项目内容
您可以通过归类增加那些属性
您推翻布局属性层次
返回您自己的分类
通过这个方法去确定举例说明这个分类
如果有需要的话
适合的那一个
我们启动这个出厂模式
有索引路径的项目的
布局模式我们往那个路径传输获得的东西
一旦我们获得一个布局属性对象
我们按照自己的想法设置我们设置框架
前后颠倒的Z索引层中的序号
然后我们返回那个特性对象至集合视图
我们拥有一个超级层
所有的自定义布局我们都采用
矩形方法
矩形元素布局属性
我们可以做到那一点因为在这种情况下
特别的是这些所有的布局
在这种情况下不单单是可以滚动的布局还能扩大至
它们需要的大小
去展示它们的项目
这些都选择在可视化区域
展示集合视图的所有项目
所以采用这种方法
基本上是一样的
我们看到一个矩形我们会看到
我们所有的项目
我们返回这些描述至集合视图
所以我们实际上利用了索引路径项目的
布局属性方法
我们在分类中采用这个方法
集合视图内容大小是一样的
这些幻灯片的布局我们看到
省略视图的大小
我们拥有的内容
是否让用户可见呢？
我们计划陈列出所有的东西
因为我们在做那一点
我们努力在边界改变时让布局失效
无论如何改变我们想重新布局
这样才能合理地使用可用的空间
在iOS准备布局这只是个轻而易举的事
当布局参数发生改变时您就处于
新布局周期的开端
您可以做任何提前计算您可以做任何事情
触发功能在周期的开端
我们可以看一下这里活动的布局
在调整大小中遇到的圆形布局
布局每次都会失效
因为我们想
获得最大的圆形
在可用空间内预留边界
通过采用那些相对要求少的方法
我们获得一个完全自定义的布局
另外 跟以往一样
它支持交叉筛选
在这里点击筛选
它很通用
所以无需太多就可以定义布局
在NS集合视图内的使用布局
事实上布局层次以及您找到的API
除了特殊情况
我们增加了这些功能去支持放置目标测试
API基本上跟iOS一样
所以如果您有在iOS使用的布局
您会发现迁移到OS X其实很简单
今天我们讲了许多话题
我们现在推出测试版
您可以获得完整的源代码
我鼓励您去研究它
它应该能帮助您开始
在El Capitan使用全新的NS集合视图
最后 我们拥有极大提升了的
NS集合视图我希望您会喜欢El Capitan
它现已在市场推出能够处理大量的项目
能灵活进行随意布局
所有您希望看的最艰难的项目
我们鼓励您这样做
让我们知道细节让我们知道您碰到的难处
如果您需要任何的帮助或指导
我们有一个专门的集合视图实验室专注于未来发明
叫做Foundation实验室BFrameworks实验室B不好意思
在这栋建筑的底层
明早9:00我到时会和团队中的其他工程师一起
他们都很了解集合视图
不要只看文件还要看应用套装发布笔记
我会以个人名义将关于集合视图的使用笔记放到那里
里面关于如何建立的信息
而且您能看到关于在10.11的AppKit中的
所有其它伟大发明的信息
如果您错过了Cocoa有什么新内容
这是找寻其他新添的特性的好地方
信息量很大一个演讲无法涵盖所有内容
我鼓励您去看一看会议视频
最后我们有两大自动布局会议在今天早些时候
如果您正在使用自动布局限制
来在项目中定位您的控制
对自动布局的仔细了解是很有帮助的
谢谢你们的出席我很期待看到你们会创造出什么
享受WWDC的冲击吧！我们明天实验室见